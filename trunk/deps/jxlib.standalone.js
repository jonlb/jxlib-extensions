/******************************************************************************
 * MooTools 1.2.2
 * Copyright (c) 2006-2007 [Valerio Proietti](http://mad4milk.net/).
 * MooTools is distributed under an MIT-style license.
 ******************************************************************************
 * reset.css - Copyright (c) 2006, Yahoo! Inc. All rights reserved.
 * Code licensed under the BSD License: http://developer.yahoo.net/yui/license.txt
 ******************************************************************************
 * Jx UI Library, 3.0alpha
 * Copyright (c) 2006-2008, DM Solutions Group Inc. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 *****************************************************************************/
function $jx(B){B=document.id(B);if(B){var A=B.retrieve("jxWidget");if(!A&&B!=document.body){return $jx(B.getParent())}else{return A}}return null}window.addEvent("load",function(){if(!("console" in window)){var B=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var A=0;A<B.length;++A){window.console[B[A]]=function(){}}}});Class.Mutators.Family=function(A,B){if($defined(B)){A.jxFamily=B;return A}else{if(!$defined(this.prototype.jxFamily)){this.implement({jxFamily:A})}}};function $unlink(C){if(C&&C.jxFamily){return C}var B;switch($type(C)){case"object":B={};for(var E in C){B[E]=$unlink(C[E])}break;case"hash":B=new Hash(C);break;case"array":B=[];for(var D=0,A=C.length;D<A;D++){B[D]=$unlink(C[D])}break;default:return C}return B}if(typeof Jx==="undefined"){var Jx={}}if(!$defined(Jx.baseURL)){(function(){var D=document.getElementsByTagName("SCRIPT");for(var B=0;B<D.length;B++){var C=D[B].src;var E=C.lastIndexOf("/");var A=C.slice(E+1,C.length-1);if(A.contains("jxlib")){Jx.baseURL=C.slice(0,E);break}}})()}if(!$defined(Jx.aPixel)){Jx.aPixel=new Element("img",{alt:"",title:"",src:Jx.baseURL+"/a_pixel.png"})}if(!$defined(Jx.isAir)){(function(){var A=document.getElementsByTagName("SCRIPT");var B=A[0].src;if(B.contains("app:")){Jx.isAir=true}else{Jx.isAir=false}})()}Jx.setLanguage=function(A){Jx.lang=A;MooTools.lang.setLanguage(Jx.lang)};if(!$defined(Jx.lang)){Jx.lang="en-US"}Jx.setLanguage(Jx.lang);Jx.applyPNGFilter=function(C){var A=Jx.aPixel.src;if(C.src!=A){var B=C.src;C.src=A;C.runtimeStyle.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+B+"',sizingMethod='scale')"}};Jx.imgQueue=[];Jx.imgLoaded={};Jx.imagesLoading=0;Jx.addToImgQueue=function(A){if(Jx.imgLoaded[A.src]){A.element.src=A.src}else{Jx.imgQueue.push(A);Jx.imgLoaded[A.src]=true}Jx.checkImgQueue()};Jx.checkImgQueue=function(){while(Jx.imagesLoading<2&&Jx.imgQueue.length>0){Jx.loadNextImg()}};Jx.loadNextImg=function(){var A=Jx.imgQueue.shift();if(A){++Jx.imagesLoading;A.element.onload=function(){--Jx.imagesLoading;Jx.checkImgQueue()};A.element.onerror=function(){--Jx.imagesLoading;Jx.checkImgQueue()};A.element.src=A.src}};Jx.getNumber=function(C,B){var A=C===null||isNaN(parseInt(C,10))?(B||0):parseInt(C,10);return A};Jx.getPageDimensions=function(){return{width:window.getWidth(),height:window.getHeight()}};Jx.type=function(A){if(typeof A=="undefined"){return false}return A.jxFamily||$type(A)};(function(A){Element.implement({getBoxSizing:function(){var C="content-box";if(Browser.Engine.trident||Browser.Engine.presto){var B=document.compatMode;if(B=="BackCompat"||B=="QuirksMode"){C="border-box"}else{C="content-box"}}else{if(arguments.length===0){node=document.documentElement}var D=this.getStyle("-moz-box-sizing");if(!D){D=this.getStyle("box-sizing")}C=(D?D:"content-box")}return C},getContentBoxSize:function(){var B=this.offsetWidth;var D=this.offsetHeight;var C=this.getSizes(["padding","border"]);B=B-C.padding.left-C.padding.right-C.border.left-C.border.right;D=D-C.padding.bottom-C.padding.top-C.border.bottom-C.border.top;return{width:B,height:D}},getBorderBoxSize:function(){var B=this.offsetWidth;var C=this.offsetHeight;return{width:B,height:C}},getMarginBoxSize:function(){var D=this.getSizes(["margin"]);var B=this.offsetWidth+D.margin.left+D.margin.right;var C=this.offsetHeight+D.margin.top+D.margin.bottom;return{width:B,height:C}},getSizes:function(D,C){D=D||["padding","border","margin"];C=C||["left","top","right","bottom"];var B={};D.each(function(E){B[E]={};C.each(function(F){var G=(E=="border")?F+"-width":F;var H=this.getStyle(E+"-"+G);B[E][F]=H===null||isNaN(parseInt(H,10))?0:parseInt(H,10)},this)},this);return B},setContentBoxSize:function(D){if(this.getBoxSizing()=="border-box"){var C=this.measure(function(){return this.getSizes(["padding","border"])});if($defined(D.width)){var E=D.width+C.padding.left+C.padding.right+C.border.left+C.border.right;if(E<0){E=0}this.style.width=E+"px"}if($defined(D.height)){var B=D.height+C.padding.top+C.padding.bottom+C.border.top+C.border.bottom;if(B<0){B=0}this.style.height=B+"px"}}else{if($defined(D.width)&&D.width>=0){this.style.width=D.width+"px"}if($defined(D.height)&&D.height>=0){this.style.height=D.height+"px"}}},setBorderBoxSize:function(D){if(this.getBoxSizing()=="content-box"){var C=this.measure(function(){return this.getSizes()});if($defined(D.width)){var E=D.width-C.padding.left-C.padding.right-C.border.left-C.border.right-C.margin.left-C.margin.right;if(E<0){E=0}this.style.width=E+"px"}if($defined(D.height)){var B=D.height-C.padding.top-C.padding.bottom-C.border.top-C.border.bottom-C.margin.top-C.margin.bottom;if(B<0){B=0}this.style.height=B+"px"}}else{if($defined(D.width)&&D.width>=0){this.style.width=D.width+"px"}if($defined(D.height)&&D.height>=0){this.style.height=D.height+"px"}}},descendantOf:function(C){var B=document.id(this.parentNode);while(B!=C&&B&&B.parentNode&&B.parentNode!=B){B=document.id(B.parentNode)}return B==C},findElement:function(C){var D=this;var B=D.tagName;while(D.tagName!=C&&D&&D.parentNode&&D.parentNode!=D){D=document.id(D.parentNode)}return D.tagName==C?D:false}});Array.implement({swap:function(C,B){var D=this[C];this[C]=this[B];this[B]=D}})})(document.id||$);Jx.Styles=new (new Class({dynamicStyleMap:new Hash(),getCssRule:function(B,A){var D=this.getDynamicStyleSheet(A);var E=null;if(D.indicies){var C=D.indicies.indexOf(B);if(C==-1){E=this.insertCssRule(B,"",A)}else{if(Browser.Engine.name==="trident"){E=D.sheet.rules[C]}else{E=D.sheet.cssRules[C]}}}return E},insertCssRule:function(B,G,A){var D=this.getDynamicStyleSheet(A);var E;var F=B+" {"+G+"}";if(Browser.Engine.name==="trident"){if(G==""){G="{}"}var C=D.styleSheet.addRule(B,G);E=D.styleSheet.rules[C]}else{D.sheet.insertRule(F,D.indicies.length);E=D.sheet.cssRules[D.indicies.length]}D.indicies.push(B);return E},removeCssRule:function(B,A){var D=this.getDynamicStyleSheet(A);var C=D.indicies.indexOf(B);D.indicies.splice(C,1);if(Browser.Engine.name==="trident"){D.removeRule(C);return true}else{D.sheet.deleteRule(C);return true}return false},getDynamicStyleSheet:function(A){A=(A)?A:"default";if(!this.dynamicStyleMap.has(A)){var B=new Element("style").set("type","text/css").inject(document.head);B.indicies=[];this.dynamicStyleMap.set(A,B)}return this.dynamicStyleMap.get(A)},enableStyleSheet:function(A){this.getDynamicStyleSheet(A).disabled=false},disableStyleSheet:function(A){this.getDynamicStyleSheet(A).disabled=true},removeStyleSheet:function(A){this.disableStyleSheet(A);this.getDynamicStyleSheet(A).dispose();this.dynamicStyleMap.erase(A)},isStyleSheetDefined:function(A){return this.dynamicStyleMap.has(A)}}))();Jx.Object=new Class({Family:"Jx.Object",Implements:[Options,Events],Binds:["changeText"],plugins:new Hash(),pluginNamespace:"Other",parameters:["options"],options:{useLang:true,plugins:null},initialize:function(){var E=arguments.length;var C={};if(E>0){if(E===1&&(Jx.type(arguments[0])==="object"||Jx.type(arguments[0])==="Hash")&&this.parameters.length===1&&this.parameters[0]==="options"){C=arguments[0]}else{var F=this.parameters.length;var B;if(F<=E){B=F}else{B=E}C={};for(var D=0;D<B;D++){if(this.parameters[D]==="options"){C=$merge(C,arguments[D])}else{C[this.parameters[D]]=arguments[D]}}}}this.setOptions(C);if(this.options.useLang){var A=this;MooTools.lang.addEvent("langChange",function(G){A.changeText()})}this.fireEvent("preInit");this.init();this.fireEvent("postInit");this.fireEvent("prePluginInit");this.initPlugins();this.fireEvent("postPluginInit");this.fireEvent("initializeDone")},initPlugins:function(){if($defined(this.pluginNamespace)){if($defined(this.options.plugins)&&Jx.type(this.options.plugins)==="array"){this.options.plugins.each(function(A){if(A instanceof Jx.Plugin){A.attach(this);this.plugins.set(A.name,A)}else{if(Jx.type(A)==="object"){var B;if($defined(Jx.Plugin[this.pluginNamespace][A.name.capitalize()])){B=new Jx.Plugin[this.pluginNamespace][A.name.capitalize()](A.options)}else{B=new Jx.Adaptor[this.pluginNamespace][A.name.capitalize()](A.options)}B.attach(this)}else{if(Jx.type(A)==="string"){var B;if($defined(Jx.Plugin[this.pluginNamespace][A.capitalize()])){B=new Jx.Plugin[this.pluginNamespace][A.capitalize()]()}else{B=new Jx.Adaptor[this.pluginNamespace][A.capitalize()]()}B.attach(this)}}}},this)}}},destroy:function(){this.fireEvent("preDestroy");this.cleanup();this.fireEvent("postDestroy")},cleanup:function(){if(this.plugins.getLength>0){this.plugins.each(function(A){A.detach();A.destroy()},this)}},init:$empty,registerPlugin:function(A){if(!this.plugins.has(A.name)){this.plugins.set(A.name,A)}},deregisterPlugin:function(A){if(this.plugins.has(A.name)){this.plugins.erase(A.name)}},getPlugin:function(A){if(this.plugins.has(A)){return this.plugins.get(A)}},getText:function(A){if(Jx.type(A)=="string"){return A}else{if(Jx.type(A)=="function"){return A()}else{if(Jx.type(A)=="object"&&$defined(A.set)&&$defined(A.key)){this.i18n=A;if($defined(A.value)){return MooTools.lang.get(A.set,A.key)[A.value]}else{return MooTools.lang.get(A.set,A.key)}}}}return""},changeText:$empty});MooTools.lang.set("en-US","Jx",{widget:{busyMessage:"Working ..."},colorpalette:{alphaLabel:"alpha (%)"},notice:{closeTip:"close this notice"},progressbar:{messageText:"Loading...",progressText:"{progress} of {total}"},field:{requiredText:"*"},file:{browseLabel:"Browse..."},"formatter.boolean":{"true":"Yes","false":"No"},"formatter.currency":{sign:"$"},"formatter.number":{decimalSeparator:".",thousandsSeparator:","},splitter:{barToolTip:"drag this bar to resize"},panel:{collapseTooltip:"Collapse/Expand Panel",collapseLabel:"Collapse",expandLabel:"Expand",maximizeTooltip:"Maximize Panel",maximizeLabel:"Maximize",restoreTooltip:"Restore Panel",restoreLabel:"Restore",closeTooltip:"Close Panel",closeLabel:"Close"},confirm:{affirmitiveLabel:"Yes",negativeLabel:"No"},dialog:{resizeToolTip:"Resize dialog"},message:{okButton:"Ok"},panelset:{barTooltip:"drag this bar to resize"},prompt:{okButton:"Ok",cancelButton:"Cancel"},upload:{buttonText:"Upload Files"},"plugin.resize":{tooltip:"Drag to resize, double click to auto-size."},"plugin.editor":{submitButton:"Save",cancelButton:"Cancel"}});Jx.Widget=new Class({Family:"Jx.Widget",Extends:Jx.Object,options:{id:null,content:null,contentURL:null,loadOnDemand:false,cacheContent:true,template:'<div class="jxWidget"></div>',busyClass:"jxBusy",busyMask:{"class":"jxSpinner jxSpinnerLarge",img:{"class":"jxSpinnerImage"},content:{"class":"jxSpinnerContent"},messageContainer:{"class":"jxSpinnerMessage"},useIframeShim:true,iframeShimOptions:{className:"jxIframeShim"},fx:true}},classes:new Hash({domObj:"jxWidget"}),busy:false,domObj:null,contentIsLoaded:false,chrome:null,init:function(){if(!this.options.deferRender){this.fireEvent("preRender");this.render();this.fireEvent("postRender")}else{this.fireEvent("deferRender")}},loadContent:function(A){A=document.id(A);if(this.options.content){var C;if(this.options.content.domObj){C=document.id(this.options.content.domObj)}else{C=document.id(this.options.content)}if(C){if(this.options.content.addTo){this.options.content.addTo(A)}else{A.appendChild(C)}this.contentIsLoaded=true}else{A.innerHTML=this.options.content;this.contentIsLoaded=true}}else{if(this.options.contentURL){this.contentIsLoaded=false;this.req=new Request({url:this.options.contentURL,method:"get",evalScripts:true,onRequest:(function(){if(this.options.loadOnDemand){this.setBusy(true)}}).bind(this),onSuccess:(function(D){A.innerHTML=D;this.contentIsLoaded=true;if(Jx.isAir){$clear(this.reqTimeout)}this.setBusy(false);this.fireEvent("contentLoaded",this)}).bind(this),onFailure:(function(){this.contentIsLoaded=true;this.fireEvent("contentLoadFailed",this)}).bind(this),headers:{"If-Modified-Since":"Sat, 1 Jan 2000 00:00:00 GMT"}});this.req.send();if(Jx.isAir){var B=$defined(this.options.timeout)?this.options.timeout:10000;this.reqTimeout=this.checkRequest.delay(B,this)}}else{this.contentIsLoaded=true}}if(this.options.contentId){A.id=this.options.contentId}if(this.contentIsLoaded){this.fireEvent("contentLoaded",this)}},position:function(G,C,P){G=document.id(G);C=document.id(C);var B=$splat(P.horizontal||["center center"]);var H=$splat(P.vertical||["center center"]);var F=$merge({top:0,right:0,bottom:0,left:0},P.offsets||{});var M=C.getCoordinates();var J,L;if(!document.id(G.parentNode)||G.parentNode==document.body){J=Jx.getPageDimensions();L=document.id(document.body).getScroll()}else{J=document.id(G.parentNode).getContentBoxSize();L=document.id(G.parentNode).getScroll()}if(C==document.body){M.left+=L.x;M.top+=L.y}else{if(G.parentNode==C){M.left=0;M.top=0}}var O=G.getMarginBoxSize();var E,N,K,A,D;if(!B.some(function(Q){var R=Q.split(" ");if(R.length!=2){return false}if(!isNaN(parseInt(R[0],10))){D=parseInt(R[0],10);if(D>=0){E=D}else{E=M.left+M.width+D}}else{switch(R[0]){case"right":E=M.left+M.width;break;case"center":E=M.left+Math.round(M.width/2);break;case"left":default:E=M.left;break}}if(!isNaN(parseInt(R[1],10))){D=parseInt(R[1],10);if(D<0){N=E+D;E=N-O.width}else{E+=D;N=E+O.width}N=M.left+M.width+parseInt(R[1],10);E=N-O.width}else{switch(R[1]){case"left":E-=F.left;N=E+O.width;break;case"right":E+=F.right;N=E;E=E-O.width;break;case"center":default:E=E-Math.round(O.width/2);N=E+O.width;break}}return(E>=L.x&&N<=L.x+J.width)})){if(N>J.width){E=L.x+J.width-O.width}if(E<0){E=0}}G.setStyle("left",E);if(!H.some(function(Q){var R=Q.split(" ");if(R.length!=2){return false}if(!isNaN(parseInt(R[0],10))){K=parseInt(R[0],10)}else{switch(R[0]){case"bottom":K=M.top+M.height;break;case"center":K=M.top+Math.round(M.height/2);break;case"top":default:K=M.top;break}}if(!isNaN(parseInt(R[1],10))){var S=parseInt(R[1],10);if(S>=0){K+=S;A=K+O.height}else{A=K+S;K=A-O.height}}else{switch(R[1]){case"top":K-=F.top;A=K+O.height;break;case"bottom":K+=F.bottom;A=K;K=K-O.height;break;case"center":default:K=K-Math.round(O.height/2);A=K+O.height;break}}return(K>=L.y&&A<=L.y+J.height)})){if(A>J.height){K=L.y+J.height-O.height}if(K<0){K=0}}G.setStyle("top",K);var I=G.retrieve("jxLayout");if(I){I.options.left=E;I.options.top=K}},makeChrome:function(A){var C=new Element("div",{"class":"jxChrome",events:{contextmenu:function(D){D.stop()}}});A.adopt(C);this.chromeOffsets=C.measure(function(){return this.getSizes(["padding"]).padding});C.setStyle("padding",0);var B=C.getStyle("backgroundImage");if(B!=null){if(!(B.contains("http://")||B.contains("https://")||B.contains("file://")||B.contains("app:/"))){B=null}else{B=B.slice(4,-1);if(B.charAt(0)=='"'){B=B.slice(1,-1)}C.setStyle("backgroundImage","none");["TR","TL","BL","BR"].each(function(D){C.adopt(new Element("div",{"class":"jxChrome"+D}).adopt(new Element("img",{"class":"png24",src:B,alt:"",title:""})))},this)}}if($defined(window.IframeShim)){this.shim=new IframeShim(C,{className:"jxIframeShim"})}C.dispose();this.chrome=C},showChrome:function(A){A=document.id(A)||document.id(this);if(A){if(!this.chrome){this.makeChrome(A);A.addClass("jxHasChrome")}this.resizeChrome(A);if(this.shim){this.shim.show()}if(A&&this.chrome.parentNode!==A){A.adopt(this.chrome);this.chrome.setStyle("z-index",-1)}}},hideChrome:function(){if(this.chrome){if(this.shim){this.shim.hide()}this.chrome.parentNode.removeClass("jxHasChrome");this.chrome.dispose()}},resizeChrome:function(A){if(this.chrome&&Browser.Engine.trident4){this.chrome.setContentBoxSize(document.id(A).getBorderBoxSize());if(this.shim){this.shim.position()}}},addTo:function(A,B){var C=document.id(this.addable)||document.id(this.domObj);if(C){if(A instanceof Jx.Widget&&$defined(A.add)){A.add(C)}else{ref=document.id(A);C.inject(ref,B)}this.fireEvent("addTo",this)}return this},toElement:function(){return this.domObj},processTemplate:function(E,C,A){var D=new Hash();var B;if($defined(A)){B=A.set("html",E)}else{B=new Element("div",{html:E})}C.each(function(F){var G=B.getElement("."+F);if($defined(G)){D.set(F,G)}});return D},generateId:function(B){B=(B)?B:"jx-";var A=$uid(this);delete this.uid;return B+A},dispose:function(){var A=document.id(this.addable)||document.id(this.domObj);if(A){A.dispose()}},cleanup:function(){if($defined(this.domObj)){this.domObj.eliminate("jxWidget");this.domObj.destroy()}if($defined(this.addable)){this.addable.destroy()}if($defined(this.domA)){this.domA.destroy()}this.parent()},render:function(){this.elements=this.processElements(this.options.template,this.classes);if($defined(this.domObj)){if($defined(this.options.id)){this.domObj.set("id",this.options.id)}this.domObj.store("jxWidget",this)}},elements:null,processElements:function(B,A){var C=A.getValues();elements=this.processTemplate(B,C);A.each(function(E,D){if(D!="elements"&&elements.get(E)){this[D]=elements.get(E)}},this);return elements},isBusy:function(){return this.busy},setBusy:function(C){if(this.busy==C){return }this.busy=C;this.fireEvent("busy",this.busy);if(this.busy){if(this.options.busyClass){this.domObj.addClass(this.options.busyClass)}if(this.options.busyMask&&this.domObj.spin){var D=Jx.getNumber(this.domObj.getStyle("z-index"));var B={style:{"z-index":D+1}};var A=this.domObj.getBorderBoxSize();if(A.height<60){B["class"]="jxSpinner jxSpinnerSmall";B.img=null;B.message=new Element("p",{"class":"jxSpinnerMessage",html:'<span class="jxSpinnerImage"></span>'+MooTools.lang.get("Jx","widget").busyMessage})}B=$merge(this.options.busyMask,B);this.domObj.get("spinner",B).show(!this.options.busyMask.fx)}}else{if(this.options.busyClass){this.domObj.removeClass(this.options.busyClass)}if(this.options.busyMask&&this.domObj.unspin){this.domObj.get("spinner").hide(!this.options.busyMask.fx)}}},changeText:function(A){if(this.busy){this.setBusy(false);this.setBusy(true)}},stack:function(A){A=A||document.id(this);Jx.Stack.stack(A)},unstack:function(A){A=A||document.id(this);Jx.Stack.unstack(A)}});if(Jx.isAir){Jx.Widget.implement({checkRequest:function(){if(this.req.xhr.readyState===1){$clear(this.reqTimeout);this.req.cancel();this.contentIsLoaded=true;this.fireEvent("contentLoadFailed",this)}}})}Jx.Selection=new Class({Family:"Jx.Selection",Extends:Jx.Object,options:{eventToFire:{select:"select",unselect:"unselect"},selectClass:"jxSelected",selectMode:"single",selectToggle:true,minimumSelection:0},selection:null,init:function(){this.selection=[]},defaultSelect:function(A){if(this.selection.length<this.options.minimumSelection){this.select(A)}},select:function(A){A=document.id(A);if(this.options.selectMode==="multiple"){if(this.selection.contains(A)){this.unselect(A)}else{document.id(A).addClass(this.options.selectClass);this.selection.push(A);this.fireEvent(this.options.eventToFire.select,A)}}else{if(this.options.selectMode=="single"){if(!this.selection.contains(A)){document.id(A).addClass(this.options.selectClass);this.selection.push(A);if(this.selection.length>1){this.unselect(this.selection[0])}this.fireEvent(this.options.eventToFire.select,A)}else{this.unselect(A)}}}},unselect:function(A){if(this.selection.contains(A)&&this.selection.length>this.options.minimumSelection){document.id(A).removeClass(this.options.selectClass);this.selection.erase(A);this.fireEvent(this.options.eventToFire.unselect,[A,this])}},selected:function(){return this.selection},isSelected:function(A){return this.selection.contains(A)}});Jx.List=new Class({Family:"Jx.List",Extends:Jx.Object,parameters:["container","options","selection"],ownsSelection:false,container:null,selection:null,options:{items:null,hover:false,hoverClass:"jxHover",press:false,pressClass:"jxPressed",select:false},init:function(){this.container=document.id(this.options.container);this.container.store("jxList",this);var C=this;var B=function(D){var E=D.retrieve("jxListTargetItem")||D;return !E.hasClass("jxDisabled")};var A=function(D){var E=D.retrieve("jxListTargetItem")||D;return !E.hasClass("jxUnselectable")};this.bound={mousedown:function(){if(B(this)){this.addClass(C.options.pressClass);C.fireEvent("mousedown",this,C)}},mouseup:function(){if(B(this)){this.removeClass(C.options.pressClass);C.fireEvent("mouseup",this,C)}},mouseenter:function(){if(B(this)){this.addClass(C.options.hoverClass);C.fireEvent("mouseenter",this,C)}},mouseleave:function(){if(B(this)){this.removeClass(C.options.hoverClass);C.fireEvent("mouseleave",this,C)}},keydown:function(D){if(D.key=="enter"&&B(this)){this.addClass("jxPressed")}},keyup:function(D){if(D.key=="enter"&&B(this)){this.removeClass("jxPressed")}},click:function(D){if(C.selection&&B(this)&&A(this)){C.selection.select(this,C)}},select:function(D){if(B(D)){var E=D.retrieve("jxListTargetItem")||D;C.fireEvent("select",E)}},unselect:function(D){if(B(D)){var E=D.retrieve("jxListTargetItem")||D;C.fireEvent("unselect",E)}},contextmenu:function(E){var D=this.retrieve("jxContextMenu");if(D){D.show(E);this.removeClass(C.options.pressClass)}E.stop()}};if(this.options.selection){this.selection=this.options.selection;this.options.select=true}else{if(this.options.select){this.selection=new Jx.Selection(this.options);this.ownsSelection=true}}this.setSelection(this.selection);if($defined(this.options.items)){this.add(this.options.items)}},cleanup:function(){this.container.getChildren().each(function(A){this.remove(A)},this);this.setSelection(null);this.bound=null;this.container.eliminate("jxList")},add:function(C,A){if(Jx.type(C)=="array"){C.each(function(E){this.add(E,A)}.bind(this));return }var B=document.id(C);var D=B.retrieve("jxListTarget")||B;if(D){D.store("jxListTargetItem",B);D.addEvents({contextmenu:this.bound.contextmenu});if(this.options.press&&this.options.pressClass){D.addEvents({mousedown:this.bound.mousedown,mouseup:this.bound.mouseup,keyup:this.bound.keyup,keydown:this.bound.keydown})}if(this.options.hover&&this.options.hoverClass){D.addEvents({mouseenter:this.bound.mouseenter,mouseleave:this.bound.mouseleave})}if(this.selection){D.addEvents({click:this.bound.click})}if($defined(A)){if($type(A)=="number"){if(A<this.container.childNodes.length){B.inject(this.container.childNodes[A],"before")}else{B.inject(this.container,"bottom")}}else{if(this.container.hasChild(A)){B.inject(A,"after")}}this.fireEvent("add",C,this)}else{B.inject(this.container,"bottom");this.fireEvent("add",C,this)}if(this.selection){this.selection.defaultSelect(B)}}},remove:function(B){var A=document.id(B);if(A&&this.container.hasChild(A)){this.unselect(A,true);A.dispose();var C=A.retrieve("jxListTarget")||A;C.removeEvents(this.bound);this.fireEvent("remove",B,this);return B}return null},replace:function(B,A){if(this.container.hasChild(B)){this.add(A,B);this.remove(B)}},indexOf:function(A){return $A(this.container.childNodes).indexOf(A)},count:function(){return this.container.childNodes.length},items:function(){return $A(this.container.childNodes)},each:function(B,A){$A(this.container.childNodes).each(B,A)},select:function(A){if(this.selection){this.selection.select(A)}},unselect:function(A,B){if(this.selection){this.selection.unselect(A)}},selected:function(){return this.selection?this.selection.selected:[]},empty:function(){this.container.getChildren().each(function(A){this.remove(A)},this)},setSelection:function(A){if(this.selection){this.selection.removeEvents(this.bound);if(this.ownsSelection){this.selection.destroy();this.ownsSelection=false}}this.selection=A;if(this.selection){this.selection.addEvents({select:this.bound.select,unselect:this.bound.unselect})}}});Jx.Stack=new (new Class({els:[],base:1000,increment:100,stack:function(A){this.unstack(A);this.els.push(A);this.setZIndex(A,this.els.length-1)},unstack:function(C){if(this.els.contains(C)){C.setStyle("z-index","");var A=this.els.indexOf(C);this.els.erase(C);for(var B=A;B<this.els.length;B++){this.setZIndex(this.els[B],B)}}},setZIndex:function(B,A){A=A||this.els.indexOf(B);if(A!==false){document.id(B).setStyle("z-index",this.base+(A*this.increment))}}}))();Jx.Record=new Class({Extends:Jx.Object,Family:"Jx.Record",options:{separator:".",primaryKey:null},data:null,state:null,columns:null,parameters:["store","columns","data","options"],init:function(){this.parent();if($defined(this.options.columns)){this.columns=this.options.columns}if($defined(this.options.data)){this.processData(this.options.data)}else{this.data=new Hash()}if($defined(this.options.store)){this.store=this.options.store}},get:function(B){var A=Jx.type(B);if(A!=="object"){if(B==="primaryKey"){B=this.resolveCol(this.options.primaryKey)}else{B=this.resolveCol(B)}}if(this.data.has(B.name)){return this.data.get(B.name)}else{return null}},set:function(C,D){var B=Jx.type(C);if(B!=="object"){C=this.resolveCol(C)}if(!$defined(this.data)){this.data=new Hash()}var A=this.get(C);this.data.set(C.name,D);this.state=Jx.Record.UPDATE;return[C.name,A,D]},equals:function(B,C){if(B==="primaryKey"){B=this.resolveCol(this.options.primaryKey)}else{B=this.resolveCol(B)}if(!this.data.has(B.name)){return null}else{if(!$defined(this.comparator)){this.comparator=new Jx.Compare({separator:this.options.separator})}var A=this.comparator[B.type].bind(this.comparator);return(A(this.get(B),C)===0)}},processData:function(A){this.data=$H(A)},resolveCol:function(A){var B=Jx.type(A);if(B==="number"){A=this.columns[A]}else{if(B==="string"){this.columns.each(function(C){if(C.name===A){A=C}},this)}}return A},asHash:function(){return this.data}});Jx.Record.UPDATE=1;Jx.Record.DELETE=2;Jx.Record.INSERT=3;Jx.Store=new Class({Family:"Jx.Store",Extends:Jx.Object,options:{id:null,columns:[],protocol:null,strategies:null,record:null,recordOptions:{primaryKey:null}},data:null,index:0,id:null,loaded:false,ready:false,init:function(){this.parent();if($defined(this.options.id)){this.id=this.options.id}if(!$defined(this.options.protocol)){this.ready=false;return }else{this.protocol=this.options.protocol}this.strategies=new Hash();if($defined(this.options.strategies)){this.options.strategies.each(function(B){this.addStrategy(B)},this)}else{var A=new Jx.Store.Strategy.Full();this.addStrategy(A)}if($defined(this.options.record)){this.record=this.options.record}else{this.record=Jx.Record}},cleanup:function(){this.strategies.each(function(A){A.destroy()},this);this.strategies=null;this.protocol.destroy();this.protocol=null;this.record=null},getStrategy:function(A){if(this.strategies.has(A)){return this.strategies.get(A)}return null},addStrategy:function(A){this.strategies.set(A.name,A);A.setStore(this);A.activate()},load:function(A){this.fireEvent("storeLoad",A)},empty:function(){if($defined(this.data)){this.data.empty()}},hasNext:function(){if($defined(this.data)){return this.index<this.data.length-1}return null},hasPrevious:function(){if($defined(this.data)){return this.index>0}return null},valid:function(){return($defined(this.data[this.index]))},next:function(){if($defined(this.data)){this.index++;if(this.index===this.data.length){this.index=this.data.length-1}this.fireEvent("storeMove",this);return true}else{return null}},previous:function(){if($defined(this.data)){this.index--;if(this.index<0){this.index=0}this.fireEvent("storeMove",this);return true}else{return null}},first:function(){if($defined(this.data)){this.index=0;this.fireEvent("storeMove",this);return true}else{return null}},last:function(){if($defined(this.data)){this.index=this.data.length-1;this.fireEvent("storeMove",this);return true}else{return null}},count:function(){if($defined(this.data)){return this.data.length}return null},getPosition:function(){if($defined(this.data)){return this.index}return null},moveTo:function(A){if($defined(this.data)&&A>=0&&A<this.data.length){this.index=A;this.fireEvent("storeMove",this);return true}else{if(!$defined(this.data)){return null}else{return false}}},each:function(A,D,C){var B;if(C){B=this.data.filter(function(E){return E.state!==Jx.Record.DELETE},this)}else{B=this.data}B.each(A,D)},get:function(B,A){if(!$defined(A)){A=this.index}return this.data[A].get(B)},set:function(C,D,B){if(!$defined(B)){B=this.index}var A=this.data[B].set(C,D);A.reverse();A.push(B);A.reverse();this.fireEvent("storeColumnChanged",A)},refresh:function(){this.fireEvent("storeRefresh",this)},addRecord:function(D,A,C){if(!$defined(this.data)){this.data=[]}A=$defined(A)?A:"bottom";var B;if(D instanceof Jx.Record){B=D}else{B=new (this.record)(this,this.options.columns,D,this.options.recordOptions)}if(C){B.state=Jx.Record.INSERT}if(A==="top"){this.data.reverse();this.data.push(B);this.data.reverse()}else{this.data.push(B)}this.fireEvent("storeRecordAdded",[this,B,A])},addRecords:function(D,A){var C=$defined(D);var B=Jx.type(D);if(C&&B==="array"){this.fireEvent("storeBeginAddRecords",this);if(A==="top"){D.reverse()}D.each(function(E){this.addRecord(E,A)},this);this.fireEvent("storeEndAddRecords",this);return true}return false},getRecord:function(A){if(!$defined(A)){A=this.index}if(Jx.type(A)==="number"){if($defined(this.data)&&$defined(this.data[A])){return this.data[A]}}else{var B;this.data.each(function(C){if(C===A){B=C}},this);return B}return null},replace:function(D,C){if($defined(D)){if(!$defined(C)){C=this.index}var B=new this.record(this.options.columns,D);var A=this.data[C];this.data[C]=B;this.fireEvent("storeRecordReplaced",[A,B]);return true}return false},deleteRecord:function(B){if(!$defined(B)){B=this.index}var A=this.data[B];A.state=Jx.Record.DELETE;this.data.splice(B,1);if(!$defined(this.deleted)){this.deleted=[]}this.deleted.push(A);this.fireEvent("storeRecordDeleted",[A,this])},insertRecord:function(B,A){this.addRecord(B,A,true)},getColumns:function(){return this.options.columns},findByColumn:function(C,D){if(typeof StopIteration==="undefined"){StopIteration=new Error("StopIteration")}var B;try{this.data.each(function(F,E){if(F.equals(C,D)){B=E;throw StopIteration}},this)}catch(A){if(A!==StopIteration){throw A}return B}return null},removeRecord:function(A){if(!$defined(A)){A=this.index}this.data.splice(A,1);this.fireEvent("storeRecordRemoved",[this,A])},removeRecords:function(C,B){for(var A=C;A<=B;A++){this.removeRecord(C)}this.fireEvent("storeMultipleRecordsRemoved",[this,C,B])},parseTemplate:function(B){var A=[];this.options.columns.each(function(C){var D="{"+C.name+"}";if(B.contains(D)){A.push(C.name)}},this);return A},fillTemplate:function(C,D,E){var A=null;if($defined(C)){if(C instanceof Jx.Record){A=C}else{A=this.getRecord(C)}}else{A=this.getRecord(this.index)}var B={};E.each(function(F){B[F]=A.get(F)},this);return D.substitute(B)}});Jx.Compare=new Class({Family:"Jx.Compare",Extends:Jx.Object,options:{separator:"."},alphanumeric:function(B,A){return(B===A)?0:(B<A)?-1:1},numeric:function(B,A){return this.alphanumeric(this.convert(B),this.convert(A))},convert:function(A){if(Jx.type(A)==="string"){var B=false;if(A.substr(0,1)=="-"){B=true}A=parseFloat(A.replace(/^[^\d\.]*([\d., ]+).*/g,"$1").replace(new RegExp("[^\\\d"+this.options.separator+"]","g"),"").replace(/,/,"."))||0;if(B){A=A*-1}}return A||0},ignorecase:function(B,A){return this.alphanumeric((""+B).toLowerCase(),(""+A).toLowerCase())},currency:function(B,A){return this.numeric(B,A)},date:function(C,B){var A=new Date().parse(C);var D=new Date().parse(B);return(A<D)?-1:(A>D)?1:0},"boolean":function(B,A){return(B===true&&A===false)?-1:(B===A)?0:1}});Jx.Sort=new Class({Family:"Jx.Sort",Extends:Jx.Object,options:{timeIt:false,onStart:$empty,onEnd:$empty},timer:null,data:null,comparator:$empty,col:null,parameters:["data","fn","col","options"],init:function(){this.parent();if(this.options.timeIt){this.addEvent("start",this.startTimer.bind(this));this.addEvent("stop",this.stopTimer.bind(this))}this.data=this.options.data;this.comparator=this.options.fn;this.col=this.options.col},sort:$empty,startTimer:function(){this.timer=new Date()},stopTimer:function(){this.end=new Date();this.dif=this.timer.diff(this.end,"ms")},setData:function(A){if($defined(A)){this.data=A}},setColumn:function(A){if($defined(A)){this.col=A}},setComparator:function(A){this.comparator=A}});Jx.Sort.Mergesort=new Class({Family:"Jx.Sort.Mergesort",Extends:Jx.Sort,name:"mergesort",sort:function(){this.fireEvent("start");var A=this.mergeSort(this.data);this.fireEvent("stop");return A},mergeSort:function(B){if(B.length<=1){return B}var C=(B.length)/2;var E=B.slice(0,C);var D=B.slice(C);E=this.mergeSort(E);D=this.mergeSort(D);var A=this.merge(E,D);return A},merge:function(C,B){var A=[];while(C.length>0&&B.length>0){if(this.comparator((C[0]).get(this.col),(B[0]).get(this.col))<=0){A.push(C[0]);C=C.slice(1)}else{A.push(B[0]);B=B.slice(1)}}while(C.length>0){A.push(C[0]);C=C.slice(1)}while(B.length>0){A.push(B[0]);B=B.slice(1)}return A}});Jx.Sort.Heapsort=new Class({Family:"Jx.Sort.Heapsort",Extends:Jx.Sort,name:"heapsort",sort:function(){this.fireEvent("start");var B=this.data.length;if(B===1){return this.data}if(B>2){this.heapify(B);var A=B-1;while(A>1){this.data.swap(A,0);A=A-1;this.siftDown(0,A)}}else{if((this.comparator((this.data[0]).get(this.col),(this.data[1]).get(this.col))>0)){this.data.swap(0,1)}}this.fireEvent("stop");return this.data},heapify:function(A){var B=Math.round((A-2)/2);while(B>=0){this.siftDown(B,A-1);B=B-1}},siftDown:function(D,B){var A=D;while(A*2<=B){var C=A*2;if((C+1<B)&&(this.comparator((this.data[C]).get(this.col),(this.data[C+1]).get(this.col))<0)){C=C+1}if((this.comparator((this.data[A]).get(this.col),(this.data[C]).get(this.col))<0)){this.data.swap(A,C);A=C}else{return }}}});Jx.Sort.Quicksort=new Class({Family:"Jx.Sort.Quicksort",Extends:Jx.Sort,name:"quicksort",sort:function(B,A){this.fireEvent("start");if(!$defined(B)){B=0}if(!$defined(A)){A=this.data.length-1}this.quicksort(B,A);this.fireEvent("stop");return this.data},quicksort:function(C,B){if(C>=B){return }var A=this.partition(C,B);this.quicksort(C,A-1);this.quicksort(A+1,B)},partition:function(F,D){this.findMedianOfMedians(F,D);var E=F;var A=(this.data[E]).get(this.col);var B=F;var C;this.data.swap(E,D);for(C=F;C<D;C++){if(this.comparator((this.data[C]).get(this.col),A)<0){this.data.swap(C,B);B=B+1}}this.data.swap(D,B);return B},findMedianOfMedians:function(F,C){if(F===C){return this.data[F]}var B;var A=1;while(A<=(C-F)){for(B=F;B<=C;B+=A*5){var E=(B+A*5-1<C)?B+A*5-1:C;var D=this.findMedianIndex(B,E,A);this.data.swap(B,D)}A*=5}return this.data[F]},findMedianIndex:function(C,I,A){var B=Math.round((I-C)/A+1);var D=Math.round(C+B/2*A);if(D>this.data.length-1){D=this.data.length-1}for(var F=C;F<D;F+=A){var G=F;var J=this.data[G];var H=J.get(this.col);for(var E=F;E<=I;E+=A){if(this.comparator((this.data[E]).get(this.col),H)<0){G=E;H=(this.data[G]).get(this.col)}}this.data.swap(F,G)}return D}});Jx.Sort.Nativesort=new Class({Family:"Jx.Sort.Nativesort",Extends:Jx.Sort,name:"nativesort",sort:function(){this.fireEvent("start");var A=function(C,B){return this.comparator((this.data[C]).get(this.col),(this.data[B]).get(this.col))};this.data.sort(A);this.fireEvent("stop");return this.data}});Jx.Store.Response=new Class({Extends:Jx.Object,Family:"Jx.Store.Response",code:null,data:null,meta:null,requestType:null,requestParams:null,request:null,success:function(){return this.code>0}});Jx.Store.Response.WAITING=2;Jx.Store.Response.SUCCESS=1;Jx.Store.Response.FAILURE=0;Jx.Store.Protocol=new Class({Extends:Jx.Object,Family:"Jx.Store.Protocol",parser:null,options:{},init:function(){this.parent();if($defined(this.options.parser)){this.parser=this.options.parser}},cleanup:function(){this.parser=null;this.parent()},read:$empty,insert:$empty,update:$empty,"delete":$empty,abort:$empty});Jx.Store.Protocol.Local=new Class({Extends:Jx.Store.Protocol,parameters:["data","options"],data:null,init:function(){this.parent();if($defined(this.options.data)){this.data=this.parser.parse(this.options.data)}},read:function(B){var E=new Jx.Store.Response();E.requestType="read";E.requestParams=arguments;var D=B.data.page;var C=B.data.itemsPerPage;if($defined(this.data)){if(D<=1&&C===-1){E.data=this.data;E.meta={count:this.data.length}}else{var F=(D-1)*C;var A=F+C;E.data=this.data.slice(F,A);E.meta={page:D,itemsPerPage:C,totalItems:this.data.length,totalPages:Math.ceil(this.data.length/C)}}E.code=Jx.Store.Response.SUCCESS;this.fireEvent("dataLoaded",E)}else{E.code=Jx.Store.Response.SUCCESS;this.fireEvent("dataLoaded",E)}}});Jx.Store.Protocol.Ajax=new Class({Extends:Jx.Store.Protocol,options:{requestOptions:{method:"get"},rest:false,urls:{rest:null,insert:null,read:null,update:null,"delete":null}},init:function(){this.parent()},read:function(B){var E=new Jx.Store.Response();E.requestType="read";E.requestParams=arguments;var D=new Request({onSuccess:this.handleResponse.bind(this,E)});E.request=D;var A={};if(this.options.rest){A.url=this.options.urls.rest}else{A.url=this.options.urls.read}var C=$merge(this.options.requestOptions,A,B);D.send(C);E.code=Jx.Store.Response.WAITING;return E},handleResponse:function(A){var B=A.request;var D=B.xhr.responseText;var C=this.parser.parse(D);if($defined(C)){if($defined(C.data)){A.data=C.data}if($defined(C.meta)){A.meta=C.meta}A.code=Jx.Store.Response.SUCCESS}else{A.code=Jx.Store.Response.FAILURE}this.fireEvent("dataLoaded",A)},insert:function(A,B){if(!this.options.rest){B=$merge({url:this.options.urls.rest},B)}else{B=$merge({url:this.options.urls.insert},B)}this.options.requestOptions.method="POST";return this.run(A,B,"insert")},update:function(A,B){if(this.options.rest){B=$merge({url:this.options.urls.rest},B);this.options.requestOptions.method="PUT"}else{B=$merge({url:this.options.urls.update},B);this.options.requestOptions.method="POST"}return this.run(A,B,"update")},"delete":function(A,B){if(this.options.rest){B=$merge({url:this.options.urls.rest},B);this.options.requestOptions.method="DELETE"}else{B=$merge({url:this.options.urls["delete"]},B);this.options.requestOptions.method="POST"}return this.run(A,B,"delete")},abort:function(A){A.request.cancel()},run:function(A,B,F){this.options.requestOptions.data={data:this.parser.encode(A)};var E=new Jx.Store.Response();E.requestType=F;E.requestParams=[A,B,F];var D=new Request({onSuccess:this.handleResponse.bind(this,E)});var C=$merge(this.options.requestOptions,B);D.send(C);E.code=Jx.Store.Response.WAITING;E.request=D;return E}});Jx.Store.Strategy=new Class({Extends:Jx.Object,Family:"Jx.Store.Strategy",store:null,active:null,init:function(){this.parent();this.active=false},setStore:function(A){if(A instanceof Jx.Store){this.store=A;return true}return false},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false}});Jx.Store.Strategy.Full=new Class({Extends:Jx.Store.Strategy,name:"full",options:{},init:function(){this.parent();this.bound={load:this.load.bind(this),loadStore:this.loadStore.bind(this)}},activate:function(){this.parent();this.store.addEvent("storeLoad",this.bound.load)},deactivate:function(){this.parent();this.store.removeEvent("storeLoad",this.bound.load)},load:function(B){this.store.fireEvent("storeBeginDataLoad",this.store);this.store.protocol.addEvent("dataLoaded",this.bound.loadStore);var A={};if($defined(B)){A.data=B}else{A.data={}}A.data.page=0;A.data.itemsPerPage=-1;this.store.protocol.read(A)},loadStore:function(A){this.store.protocol.removeEvent("dataLoaded",this.bound.loadStore);if(A.success()){this.store.empty();if($defined(A.meta)){this.parseMetaData(A.meta)}this.store.addRecords(A.data);this.store.loaded=true;this.store.fireEvent("storeDataLoaded",this.store)}else{this.store.loaded=false;this.store.fireEvent("storeDataLoadFailed",[this.store,A])}},parseMetaData:function(A){if($defined(A.columns)){this.store.options.columns=A.columns}if($defined(A.primaryKey)){this.store.options.recordOptions.primaryKey=A.primaryKey}}});Jx.Store.Strategy.Paginate=new Class({Extends:Jx.Store.Strategy,name:"paginate",options:{getPaginationParams:function(){return{page:this.page,itemsPerPage:this.itemsPerPage}},startingItemsPerPage:25,startingPage:1,expirationInterval:(1000*60*5),ignoreExpiration:false},data:new Hash(),cacheTimer:new Hash(),page:null,itemsPerPage:null,init:function(){this.parent();this.bound={load:this.load.bind(this),loadStore:this.loadStore.bind(this)};this.itemsPerPage=this.options.startingItemsPerPage;this.page=this.options.startingPage},activate:function(){this.parent();this.store.addEvent("storeLoad",this.bound.load)},deactivate:function(){this.parent();this.store.removeEvent("storeLoad",this.bound.load)},load:function(B){this.store.fireEvent("storeBeginDataLoad",this.store);this.store.protocol.addEvent("dataLoaded",this.bound.loadStore);this.params=B;var A={data:$merge(B,this.options.getPaginationParams.apply(this))};this.store.protocol.read(A)},loadStore:function(A){this.store.protocol.removeEvent("dataLoaded",this.bound.loadStore);if(A.success()){if($defined(A.meta)){this.parseMetaData(A.meta)}this.data.set(this.page,A.data);this.loadData(A.data)}else{this.store.fireEvent("storeDataLoadFailed",this.store)}},loadData:function(A){this.store.empty();this.store.loaded=false;if(!this.options.ignoreExpiration){var B=this.expirePage.delay(this.options.expirationInterval,this,this.page);this.cacheTimer.set(this.page,B)}this.store.addRecords(A);this.store.loaded=true;this.store.fireEvent("storeDataLoaded",this.store)},parseMetaData:function(A){if($defined(A.columns)){this.store.options.columns=A.columns}if($defined(A.totalItems)){this.totalItems=A.totalItems}if($defined(A.totalPages)){this.totalPages=A.totalPages}if($defined(A.primaryKey)){this.store.options.recordOptions.primaryKey=A.primaryKey}},expirePage:function(A){this.data.erase(A);this.cacheTimer.erase(A)},setPage:function(A){if(Jx.type(A)==="string"){switch(A){case"first":this.page=1;break;case"last":this.page=this.totalPages;break;case"next":this.page++;break;case"previous":this.page--;break;default:this.page=this.page+Jx.getNumber(A);break}}else{this.page=A}if(this.cacheTimer.has(this.page)){$clear(this.cacheTimer.get(this.page));this.cacheTimer.erase(this.page)}if(this.data.has(this.page)){this.loadData(this.data.get(this.page))}else{this.load(this.params)}},getPage:function(){return this.page},getNumberOfPages:function(){return this.totalPages},setPageSize:function(A){this.itemsPerPage=A;this.cacheTimer.each(function(B){$clear(B)},this);this.cacheTimer.empty();this.data.empty();this.load()},getPageSize:function(){return this.itemsPerPage},getTotalCount:function(){return this.totalItems}});Jx.Store.Strategy.Progressive=new Class({Extends:Jx.Store.Strategy.Paginate,name:"progressive",options:{maxRecords:1000,dropRecords:true},startingPage:0,maxPages:null,loadedPages:0,loadAt:"bottom",init:function(){this.parent();if(this.options.dropPages){this.maxPages=Math.ceil(this.options.maxRecords/this.itemsPerPage)}},loadStore:function(A){this.store.protocol.removeEvent("dataLoaded",this.bound.loadStore);if(A.success()){if($defined(A.meta)){this.parseMetaData(A.meta)}this.loadData(A.data)}else{this.store.fireEvent("storeDataLoadFailed",this.store)}},loadData:function(A){this.store.loaded=false;this.store.addRecords(A,this.loadAt);this.store.loaded=true;this.loadedPages++;this.store.fireEvent("storeDataLoaded",this.store)},nextPage:function(A){if(!$defined(A)){A={}}if(this.options.dropRecords&&this.totalPages>this.startingPage+this.loadedPages){this.loadAt="bottom";if(this.loadedPages>=this.maxPages){this.startingPage++;this.store.removeRecords(0,this.itemsPerPage-1);this.loadedPages--}}this.page=this.startingPage+this.loadedPages+1;this.load($merge(this.params,A))},previousPage:function(A){if(!this.options.dropRecords){return }if(!$defined(A)){A={}}if(this.startingPage>0){this.loadAt="top";if(this.loadedPages>=this.maxPages){this.startingPage--;this.store.removeRecords(this.options.maxRecords-this.itemsPerPage,this.options.maxRecords);this.loadedPages--}this.page=this.startingPage;this.load($merge(this.params,A))}}});Jx.Store.Strategy.Save=new Class({Extends:Jx.Store.Strategy,name:"save",options:{autoSave:false},failedChanges:[],successfulChanges:[],totalChanges:0,init:function(){this.parent();this.bound={save:this.saveRecord.bind(this),completed:this.onComplete.bind(this)}},activate:function(){this.parent();if(Jx.type(this.options.autoSave)==="number"){this.periodicalId=this.save.periodical(this.options.autoSave,this)}else{if(this.options.autoSave){this.store.addEvent("storeRecordAdded",this.bound.save);this.store.addEvent("storeColumnChanged",this.bound.save);this.store.addEvent("storeRecordDeleted",this.bound.save)}}},deactivate:function(){this.parent();if($defined(this.periodicalId)){$clear(this.periodicalId)}else{if(this.options.autoSave){this.store.removeEvent("storeRecordAdded",this.bound.save);this.store.removeEvent("storeColumnChanged",this.bound.save);this.store.removeEvent("storeRecordDeleted",this.bound.save)}}},saveRecord:function(A,B){if(!this.updating&&$defined(A.state)){if(this.totalChanges===0){this.store.protocol.addEvent("dataLoaded",this.bound.completed)}this.totalChanges++;var C;switch(A.state){case Jx.Record.UPDATE:C=this.store.protocol.update(A);break;case Jx.Record.DELETE:C=this.store.protocol["delete"](A);break;case Jx.Record.INSERT:C=this.store.protocol.insert(A);break}return C}},save:function(){if(this.store.loaded){var A=[];A[Jx.Record.UPDATE]=[];A[Jx.Record.INSERT]=[];this.store.data.each(function(B){if($defined(B)&&$defined(B.state)){A[B.state].push(B)}},this);A[Jx.Record.DELETE]=this.store.deleted;A.flatten().each(function(B){this.saveRecord(B)},this)}},onComplete:function(B){if(!B.success()||($defined(B.meta)&&!B.meta.success)){this.failedChanges.push(B)}else{var A=B.requestParams[0];if(B.requestType==="delete"){this.store.deleted.erase(A)}else{if(B.requestType==="insert"){if($defined(B.data)){this.updating=true;$H(B.data).each(function(D,C){A.set(C,D)},this);this.updating=false}}A.state=null}this.successfulChanges.push(B)}this.totalChanges--;if(this.totalChanges===0){this.store.protocol.removeEvent("dataLoaded",this.bound.completed);this.store.fireEvent("storeChangesCompleted",{successful:this.successfulChanges,failed:this.failedChanges})}}});Jx.Store.Strategy.Sort=new Class({Extends:Jx.Store.Strategy,name:"sort",options:{sortOnStoreEvents:["storeColumnChanged","storeDataLoaded"],defaultSort:"merge",separator:".",sortCols:[]},sorters:{quick:"Quicksort",merge:"Mergesort",heap:"Heapsort","native":"Nativesort"},init:function(){this.parent();this.bound={sort:this.sort.bind(this)}},activate:function(){if($defined(this.options.sortOnStoreEvents)){this.options.sortOnStoreEvents.each(function(A){this.store.addEvent(A,this.bound.sort)},this)}},deactivate:function(){if($defined(this.options.sortOnStoreEvents)){this.options.sortOnStoreEvents.each(function(A){this.store.removeEvent(A,this.bound.sort)},this)}},sort:function(C,B,A){if(this.store.count()){this.store.fireEvent("sortStart",this);var D;if($defined(C)&&Jx.type(C)==="array"){D=this.options.sortCols=C}else{if($defined(C)&&Jx.type(C)==="string"){this.options.sortCols=[];this.options.sortCols.push(C);D=this.options.sortCols}else{if($defined(this.options.sortCols)){D=this.options.sortCols}else{return null}}}this.sortType=B;this.store.data=this.doSort(D[0],B,this.store.data,true);if(D.length>1){this.store.data=this.subSort(this.store.data,0,1)}if($defined(A)&&A==="desc"){this.store.data.reverse()}this.store.fireEvent("storeSortFinished",this)}},subSort:function(E,F,B){if(B>=this.options.sortCols.length){return E}var I=[];var A=[];var C=this.options.sortCols[F];var G=this.options.sortCols[B];var H=E[0].get(C);this.sorter.setColumn(G);for(var D=0;D<E.length;D++){if(H===(E[D]).get(C)){A.push(E[D])}else{if(A.length>1){I=I.concat(this.subSort(this.doSort(G,this.sortType,A,true),F+1,B+1))}else{I=I.concat(A)}H=(E[D]).get(C);A.empty();A.push(E[D])}}if(A.length>1){this.sorter.setData(A);I=I.concat(this.subSort(this.doSort(G,this.sortType,A,true),F+1,B+1))}else{I=I.concat(A)}return I},doSort:function(C,D,F,B,A){A={}||A;D=(D)?this.sorters[D]:this.sorters[this.options.defaultSort];F=F?F:this.data;B=B?true:false;if(!$defined(this.comparator)){this.comparator=new Jx.Compare({separator:this.options.separator})}this.col=C=this.resolveCol(C);var E=this.comparator[C.type].bind(this.comparator);if(!$defined(this.sorter)){this.sorter=new Jx.Sort[D](F,E,C.name,A)}else{this.sorter.setComparator(E);this.sorter.setColumn(C.name);this.sorter.setData(F)}var G=this.sorter.sort();if(B){return G}else{this.data=G}},resolveCol:function(A){var B=Jx.type(A);if(B==="number"){A=this.store.options.columns[A]}else{if(B==="string"){this.store.options.columns.each(function(C){if(C.name===A){A=C}},this)}}return A}});Jx.Store.Parser=new Class({Extends:Jx.Object,Family:"Jx.Store.Parser",parse:$empty,encode:$empty});Jx.Store.Parser.JSON=new Class({Extends:Jx.Store.Parser,options:{secure:false},parse:function(B){var A=Jx.type(B);if(A==="string"){return JSON.decode(B,this.options.secure)}return B},encode:function(A){var B;if(A instanceof Jx.Record){B=A.asHash()}else{B=A}return JSON.encode(B)}});Jx.Button=new Class({Family:"Jx.Button",Extends:Jx.Widget,options:{image:"",tooltip:"",label:"",toggle:false,toggleClass:"jxButtonToggle",pressedClass:"jxButtonPressed",activeClass:"jxButtonActive",active:false,enabled:true,href:"javascript:void(0);",template:'<span class="jxButtonContainer"><a class="jxButton"><span class="jxButtonContent"><img class="jxButtonIcon" src="'+Jx.aPixel.src+'"><span class="jxButtonLabel"></span></span></a></span>'},classes:new Hash({domObj:"jxButtonContainer",domA:"jxButton",domImg:"jxButtonIcon",domLabel:"jxButtonLabel"}),render:function(){this.parent();if(this.options.toggle){this.domObj.addClass(this.options.toggleClass)}if(this.domA){var B;var A;this.domA.set({href:this.options.href,title:this.options.tooltip,alt:this.options.tooltip});this.domA.addEvents({click:this.clicked.bindWithEvent(this),drag:(function(C){C.stop()}).bindWithEvent(this),mousedown:(function(C){this.domA.addClass(this.options.pressedClass);B=true;A=true;this.focus()}).bindWithEvent(this),mouseup:(function(C){this.domA.removeClass(this.options.pressedClass);A=false}).bindWithEvent(this),mouseleave:(function(C){this.domA.removeClass(this.options.pressedClass)}).bindWithEvent(this),mouseenter:(function(C){if(B&&A){this.domA.addClass(this.options.pressedClass)}}).bindWithEvent(this),keydown:(function(C){if(C.key=="enter"){this.domA.addClass(this.options.pressedClass)}}).bindWithEvent(this),keyup:(function(C){if(C.key=="enter"){this.domA.removeClass(this.options.pressedClass)}}).bindWithEvent(this),blur:function(){B=false}});if(typeof Drag!="undefined"){new Drag(this.domA,{onStart:function(){this.stop()}})}}if(this.domImg){if(this.options.image||!this.options.label){this.domImg.set({title:this.options.tooltip,alt:this.options.tooltip});if(this.options.image&&this.options.image.indexOf(Jx.aPixel.src)==-1){this.domImg.setStyle("backgroundImage","url("+this.options.image+")")}if(this.options.imageClass){this.domImg.addClass(this.options.imageClass)}}else{this.domImg.setStyle("display","none")}}if(this.domLabel){if(this.options.label||this.domA.hasClass("jxDiscloser")){this.setLabel(this.options.label)}else{this.domLabel.setStyle("display","none")}}if(this.options.id){this.domObj.set("id",this.options.id)}this.setEnabled(this.options.enabled);if(this.options.active){this.options.active=false;this.setActive(true)}},clicked:function(A){if(this.options.enabled&&!this.isBusy()){if(this.options.toggle){this.setActive(!this.options.active)}else{this.fireEvent("click",{obj:this,event:A})}}},isEnabled:function(){return this.options.enabled},setEnabled:function(A){this.options.enabled=A;if(this.options.enabled){this.domObj.removeClass("jxDisabled")}else{this.domObj.addClass("jxDisabled")}},isActive:function(){return this.options.active},setActive:function(A){if(this.options.enabled&&!this.isBusy()){if(this.options.active==A){return }this.options.active=A;if(this.domA){if(this.options.active){this.domA.addClass(this.options.activeClass)}else{this.domA.removeClass(this.options.activeClass)}}this.fireEvent(A?"down":"up",this)}},setImage:function(A){this.options.image=A;if(this.domImg){this.domImg.setStyle("backgroundImage","url("+this.options.image+")");this.domImg.setStyle("display",A?null:"none")}},setLabel:function(A){this.options.label=A;if(this.domLabel){this.domLabel.set("html",this.getText(A));this.domLabel.setStyle("display",A||this.domA.hasClass("jxDiscloser")?null:"none")}},getLabel:function(){return this.options.label},setTooltip:function(B){if(this.domA){this.domA.set({title:B,alt:B})}if(this.domImg){var A=this.domImg.get("title");if($defined(A)){this.domImg.set({title:B,alt:B})}}},focus:function(){if(this.domA){this.domA.focus()}},blur:function(){if(this.domA){this.domA.blur()}},changeText:function(A){this.parent();this.setLabel(this.options.label)}});Jx.Button.Flyout=new Class({Family:"Jx.Button.Flyout",Extends:Jx.Button,Binds:["keypressHandler","clickHandler"],options:{template:'<span class="jxButtonContainer"><a class="jxButton jxButtonFlyout jxDiscloser"><span class="jxButtonContent"><img class="jxButtonIcon" src="'+Jx.aPixel.src+'"><span class="jxButtonLabel "></span></a></span>',contentTemplate:'<div class="jxFlyout"><div class="jxFlyoutContent"></div></div>'},contentClasses:new Hash({contentContainer:"jxFlyout",content:"jxFlyoutContent"}),content:null,render:function(){if(!Jx.Button.Flyout.Stack){Jx.Button.Flyout.Stack=[]}this.parent();this.processElements(this.options.contentTemplate,this.contentClasses);if(this.options.contentClass){this.content.addClass(this.options.contentClass)}this.content.store("jxFlyout",this);this.loadContent(this.content)},clicked:function(C){if(!this.options.enabled){return }if(!this.owner){this.owner=document.body;var B=document.id(this.domObj.parentNode);while(B!=document.body&&this.owner==document.body){var A=B.retrieve("jxFlyout");if(A){this.owner=A;break}else{B=document.id(B.parentNode)}}}if(Jx.Button.Flyout.Stack[Jx.Button.Flyout.Stack.length-1]==this){this.hide();return }else{if(this.owner!=document.body){if(this.owner.currentFlyout==this){this.hide();return }else{if(this.owner.currentFlyout){this.owner.currentFlyout.hide()}}this.owner.currentFlyout=this}else{while(Jx.Button.Flyout.Stack.length){Jx.Button.Flyout.Stack[Jx.Button.Flyout.Stack.length-1].hide()}}}Jx.Button.Flyout.Stack.push(this);this.fireEvent("beforeOpen");this.options.active=true;this.domA.addClass(this.options.activeClass);this.contentContainer.setStyle("visibility","hidden");document.id(document.body).adopt(this.contentContainer);this.content.getChildren().each(function(D){if(D.resize){D.resize()}});this.showChrome(this.contentContainer);this.position(this.contentContainer,this.domObj,{horizontal:["left left","right right"],vertical:["bottom top","top bottom"],offsets:this.chromeOffsets});this.contentContainer.setContentBoxSize(document.id(this.content).getMarginBoxSize());this.stack(this.contentContainer);this.contentContainer.setStyle("visibility","");document.addEvent("keydown",this.keypressHandler);document.addEvent("click",this.clickHandler);this.fireEvent("open",this)},hide:function(){if(this.owner!=document.body){this.owner.currentFlyout=null}Jx.Button.Flyout.Stack.pop();this.setActive(false);this.contentContainer.dispose();this.unstack(this.contentContainer);document.removeEvent("keydown",this.keypressHandler);document.removeEvent("click",this.clickHandler);this.fireEvent("close",this)},clickHandler:function(B){B=new Event(B);var C=document.id(B.target);var A=Jx.Button.Flyout.Stack[Jx.Button.Flyout.Stack.length-1];if(!C.descendantOf(A.content)&&!C.descendantOf(A.domObj)){A.hide()}},keypressHandler:function(A){A=new Event(A);if(A.key=="esc"){Jx.Button.Flyout.Stack[Jx.Button.Flyout.Stack.length-1].hide()}}});Jx.ColorPalette=new Class({Family:"Jx.ColorPalette",Extends:Jx.Widget,domObj:null,options:{parent:null,color:"#000000",alpha:1,hexColors:["00","33","66","99","CC","FF"]},render:function(){this.domObj=new Element("div",{id:this.options.id,"class":"jxColorPalette"});var G=new Element("div",{"class":"jxColorBar"});var P=new Element("div",{"class":"jxColorPreview"});this.selectedSwatch=new Element("div",{"class":"jxColorSelected"});this.previewSwatch=new Element("div",{"class":"jxColorHover"});P.adopt(this.selectedSwatch);P.adopt(this.previewSwatch);G.adopt(P);this.colorInputLabel=new Element("label",{"class":"jxColorLabel",html:"#"});G.adopt(this.colorInputLabel);var J=this.changed.bind(this);this.colorInput=new Element("input",{"class":"jxHexInput",type:"text",maxLength:6,events:{keyup:J,blur:J,change:J}});G.adopt(this.colorInput);this.alphaLabel=new Element("label",{"class":"jxAlphaLabel",html:MooTools.lang.get("Jx","colorpalette").alphaLabel});G.adopt(this.alphaLabel);this.alphaInput=new Element("input",{"class":"jxAlphaInput",type:"text",maxLength:3,events:{keyup:this.alphaChanged.bind(this)}});G.adopt(this.alphaInput);this.domObj.adopt(G);var H=this.swatchClick.bindWithEvent(this);var F=this.swatchOver.bindWithEvent(this);var O=new Element("table",{"class":"jxColorGrid"});var A=new Element("tbody");O.adopt(A);for(var M=0;M<12;M++){var B=new Element("tr");for(var K=-3;K<18;K++){var E=false;var I,N,Q;if(K<0){if(K==-3||K==-1){I=N=Q=0;E=true}else{if(M<6){I=N=Q=M}else{if(M==6){I=5;N=0;Q=0}else{if(M==7){I=0;N=5;Q=0}else{if(M==8){I=0;N=0;Q=5}else{if(M==9){I=5;N=5;Q=0}else{if(M==10){I=0;N=5;Q=5}else{if(M==11){I=5;N=0;Q=5}}}}}}}}}else{I=parseInt(M/6,10)*3+parseInt(K/6,10);N=K%6;Q=M%6}var C="#"+this.options.hexColors[I]+this.options.hexColors[N]+this.options.hexColors[Q];var D=new Element("td");if(!E){D.setStyle("backgroundColor",C);var R=new Element("a",{"class":"colorSwatch "+(((I>2&&N>2)||(I>2&&Q>2)||(N>2&&Q>2))?"borderBlack":"borderWhite"),href:"javascript:void(0)",title:C,alt:C,events:{mouseover:F,click:H}});R.store("swatchColor",C);D.adopt(R)}else{var L=new Element("span",{"class":"emptyCell"});D.adopt(L)}B.adopt(D)}A.adopt(B)}this.domObj.adopt(O);this.updateSelected();if(this.options.parent){this.addTo(this.options.parent)}},swatchOver:function(B){var A=B.target;this.previewSwatch.setStyle("backgroundColor",A.retrieve("swatchColor"))},swatchClick:function(B){var A=B.target;this.options.color=A.retrieve("swatchColor");this.updateSelected();this.fireEvent("click",this)},changed:function(){var A=this.colorInput.value;if(A.substring(0,1)=="#"){A=A.substring(1)}if(A.toLowerCase().match(/^[0-9a-f]{6}$/)){this.options.color="#"+A.toUpperCase();this.updateSelected()}},alphaChanged:function(){var A=this.alphaInput.value;if(A.match(/^[0-9]{1,3}$/)){this.options.alpha=parseFloat(A/100);this.updateSelected()}},setColor:function(A){this.colorInput.value=A;this.changed()},setAlpha:function(A){this.alphaInput.value=A;this.alphaChanged()},updateSelected:function(){var A={backgroundColor:this.options.color};this.colorInput.value=this.options.color.substring(1);this.alphaInput.value=parseInt(this.options.alpha*100,10);if(this.options.alpha<1){A.opacity=this.options.alpha;A.filter="Alpha(opacity="+(this.options.alpha*100)+")"}else{A.opacity=1;A.filter=""}this.selectedSwatch.setStyles(A);this.previewSwatch.setStyles(A);this.fireEvent("change",this)},changeText:function(A){this.parent();if($defined(this.alphaLabel)){this.alphaLabel.set("html",MooTools.lang.get("Jx","colorpalette").alphaLabel)}}});Jx.Button.Color=new Class({Family:"Jx.Button.Color",Extends:Jx.Button.Flyout,swatch:null,options:{color:"#000000",alpha:100,template:'<span class="jxButtonContainer"><a class="jxButton jxButtonFlyout jxDiscloser"><span class="jxButtonContent"><span class="jxButtonSwatch"><span class="jxButtonSwatchColor"></span></span><span class="jxButtonLabel"></span></span></a></span>'},classes:new Hash({domObj:"jxButtonContainer",domA:"jxButton",swatch:"jxButtonSwatchColor",domLabel:"jxButtonLabel"}),render:function(){if(!Jx.Button.Color.ColorPalette){Jx.Button.Color.ColorPalette=new Jx.ColorPalette(this.options)}this.options.image=Jx.aPixel.src;this.parent();this.updateSwatch();this.bound={changed:this.changed.bind(this),hide:this.hide.bind(this)}},clicked:function(){if(Jx.Button.Color.ColorPalette.currentButton){Jx.Button.Color.ColorPalette.currentButton.hide()}Jx.Button.Color.ColorPalette.currentButton=this;Jx.Button.Color.ColorPalette.addEvent("change",this.bound.changed);Jx.Button.Color.ColorPalette.addEvent("click",this.bound.hide);this.content.appendChild(Jx.Button.Color.ColorPalette.domObj);Jx.Button.Color.ColorPalette.domObj.setStyle("display","block");Jx.Button.Flyout.prototype.clicked.apply(this,arguments);Jx.Button.Color.ColorPalette.options.color=this.options.color;Jx.Button.Color.ColorPalette.options.alpha=this.options.alpha/100;Jx.Button.Color.ColorPalette.updateSelected()},hide:function(){this.setActive(false);Jx.Button.Color.ColorPalette.removeEvent("change",this.bound.changed);Jx.Button.Color.ColorPalette.removeEvent("click",this.bound.hide);Jx.Button.Flyout.prototype.hide.apply(this,arguments);Jx.Button.Color.ColorPalette.currentButton=null},setColor:function(A){this.options.color=A;this.updateSwatch()},setAlpha:function(A){this.options.alpha=A;this.updateSwatch()},changed:function(A){var B=false;if(this.options.color!=A.options.color){this.options.color=A.options.color;B=true}if(this.options.alpha!=A.options.alpha*100){this.options.alpha=A.options.alpha*100;B=true}if(B){this.updateSwatch();this.fireEvent("change",this)}},updateSwatch:function(){var A={backgroundColor:this.options.color};if(this.options.alpha<100){A.filter="Alpha(opacity="+(this.options.alpha)+")";A.opacity=this.options.alpha/100}else{A.opacity=1;A.filter=""}this.swatch.setStyles(A)}});Jx.Menu=new Class({Family:"Jx.Menu",Extends:Jx.Widget,Binds:["onMouseEnter","onMouseLeave","hide","keypressHandler"],button:null,subDomObj:null,list:null,parameters:["buttonOptions","options"],options:{exposeOnHover:false,hideDelay:0,template:"<div class='jxMenuContainer'><ul class='jxMenu'></ul></div>",buttonTemplate:'<span class="jxButtonContainer"><a class="jxButton jxButtonMenu jxDiscloser"><span class="jxButtonContent"><img class="jxButtonIcon" src="'+Jx.aPixel.src+'"><span class="jxButtonLabel"></span></span></a></span>',position:{horizontal:["left left"],vertical:["bottom top","top bottom"]}},classes:new Hash({contentContainer:"jxMenuContainer",subDomObj:"jxMenu"}),render:function(){this.parent();if(!Jx.Menu.Menus){Jx.Menu.Menus=[]}this.contentContainer.addEvent("onContextmenu",function(A){A.stop()});this.list=new Jx.List(this.subDomObj,{onRemove:function(A){A.setOwner(null)}.bind(this)});if(this.options.buttonOptions){this.button=new Jx.Button($merge(this.options.buttonOptions,{template:this.options.buttonTemplate,onClick:this.show.bind(this)}));this.button.domA.addEvent("mouseenter",this.onMouseEnter);this.button.domA.addEvent("mouseleave",this.onMouseLeave);this.domObj=this.button.domObj;this.domObj.store("jxMenu",this)}this.subDomObj.addEvent("mouseenter",this.onMouseEnter);this.subDomObj.addEvent("mouseleave",this.onMouseLeave);if(this.options.parent){this.addTo(this.options.parent)}},add:function(C,B,A){if(Jx.type(C)=="array"){C.each(function(D){D.setOwner(A||this)},this)}else{C.setOwner(A||this)}this.list.add(C,B);return this},remove:function(A){this.list.remove(A);return this},replace:function(B,A){this.list.replace(B,A);return this},empty:function(){this.list.each(function(A){if(A.empty){A.empty()}},this);this.list.empty()},deactivate:function(){this.hide()},onMouseEnter:function(A){if(this.hideTimer){$clear(this.hideTimer);this.hideTimer=null}if(Jx.Menu.Menus[0]&&Jx.Menu.Menus[0]!=this){this.show({event:A})}else{if(this.options.exposeOnHover){if(Jx.Menu.Menus[0]&&Jx.Menu.Menus[0]==this){Jx.Menu.Menus[0]=null}this.show({event:A})}}},onMouseLeave:function(A){if(this.options.hideDelay>0){this.hideTimer=(function(){this.deactivate()}).delay(this.options.hideDelay,this)}},eventInMenu:function(D){var C=document.id(D.target);if(!C){return false}if(C.descendantOf(this.domObj)||C.descendantOf(this.subDomObj)){return true}else{var B=C.findElement("ul");if(B){var E=B.retrieve("jxSubMenu");if(E){var A=E.owner;while(A){if(A==this){return true}A=A.owner}}}return false}},hide:function(A){if(A){if(this.visibleItem&&this.visibleItem.eventInMenu){if(this.visibleItem.eventInMenu(A)){return }}else{if(this.eventInMenu(A)){return }}}if(Jx.Menu.Menus[0]&&Jx.Menu.Menus[0]==this){Jx.Menu.Menus[0]=null}if(this.button&&this.button.domA){this.button.domA.removeClass(this.button.options.activeClass)}this.list.each(function(B){B.retrieve("jxMenuItem").hide(A)});document.removeEvent("mousedown",this.hide);document.removeEvent("keydown",this.keypressHandler);this.unstack(this.contentContainer);this.contentContainer.dispose();this.visibleItem=null;this.fireEvent("hide",this)},show:function(){if(this.button){if(Jx.Menu.Menus[0]){if(Jx.Menu.Menus[0]!=this){Jx.Menu.Menus[0].button.blur();Jx.Menu.Menus[0].hide()}else{this.hide();return }}Jx.Menu.Menus[0]=this;this.button.focus();if(this.list.count()==0){return }}this.contentContainer.setStyle("display","none");document.id(document.body).adopt(this.contentContainer);this.contentContainer.setStyles({visibility:"hidden",display:"block"});this.contentContainer.setContentBoxSize(this.subDomObj.getMarginBoxSize());this.showChrome(this.contentContainer);this.position(this.contentContainer,this.domObj,$merge({offsets:this.chromeOffsets},this.options.position));this.stack(this.contentContainer);this.contentContainer.setStyle("visibility","visible");if(this.button&&this.button.domA){this.button.domA.addClass(this.button.options.activeClass)}document.addEvent("mousedown",this.hide);document.addEvent("keydown",this.keypressHandler);this.fireEvent("show",this)},setVisibleItem:function(A){if(this.visibleItem!=A){if(this.visibleItem&&this.visibleItem.hide){this.visibleItem.hide()}this.visibleItem=A;this.visibleItem.show()}},keypressHandler:function(A){A=new Event(A);if(A.key=="esc"){this.hide()}},isEnabled:function(){return this.button.isEnabled},setEnabled:function(A){return this.button.setEnabled(A)},isActive:function(){return this.button.isActive()},setActive:function(A){this.button.setActive(A)},setImage:function(A){this.button.setImage(A)},setLabel:function(A){this.button.setLabel(A)},getLabel:function(){return this.button.getLabel()},setTooltip:function(A){this.button.setTooltip(A)},focus:function(){this.button.focus()},blur:function(){this.button.blur()}});Jx.ButtonSet=new Class({Family:"Jx.ButtonSet",Extends:Jx.Object,Binds:["buttonChanged"],buttons:[],add:function(){$A(arguments).each(function(A){if(A.domObj.hasClass(A.options.toggleClass)){A.domObj.removeClass(A.options.toggleClass);A.domObj.addClass(A.options.toggleClass+"Set")}A.addEvent("down",this.buttonChanged);A.setActive=function(B){if(A.options.active&&this.activeButton==A){return }else{Jx.Button.prototype.setActive.apply(A,[B])}}.bind(this);if(!this.activeButton||A.options.active){A.options.active=false;A.setActive(true)}this.buttons.push(A)},this);return this},remove:function(A){this.buttons.erase(A);if(this.activeButton==A){if(this.buttons.length){this.buttons[0].setActive(true)}A.removeEvent("down",this.buttonChanged);A.setActive=Jx.Button.prototype.setActive}},empty:function(){this.buttons=[];this.activeButton=null},setActiveButton:function(B){var A=this.activeButton;this.activeButton=B;if(A&&A!=B){A.setActive(false)}},buttonChanged:function(A){this.setActiveButton(A);this.fireEvent("change",this)}});Jx.Button.Multi=new Class({Family:"Jx.Button.Multi",Extends:Jx.Button,activeButton:null,buttons:null,options:{template:'<span class="jxButtonContainer"><a class="jxButton jxButtonMulti jxDiscloser"><span class="jxButtonContent"><img src="'+Jx.aPixel.src+'" class="jxButtonIcon"><span class="jxButtonLabel"></span></span></a><a class="jxButtonDisclose" href="javascript:void(0)"><img src="'+Jx.aPixel.src+'"></a></span>'},classes:new Hash({domObj:"jxButtonContainer",domA:"jxButton",domImg:"jxButtonIcon",domLabel:"jxButtonLabel",domDisclose:"jxButtonDisclose"}),render:function(){this.parent();this.buttons=[];this.menu=new Jx.Menu();this.menu.button=this;this.buttonSet=new Jx.ButtonSet();this.clickHandler=this.clicked.bind(this);if(this.domDisclose){var A=this;var B;this.domDisclose.addEvents({click:(function(C){if(this.list.count()===0){return }if(!A.options.enabled){return }this.contentContainer.setStyle("visibility","hidden");this.contentContainer.setStyle("display","block");document.id(document.body).adopt(this.contentContainer);this.contentContainer.setContentBoxSize(this.subDomObj.getMarginBoxSize());this.showChrome(this.contentContainer);this.position(this.contentContainer,this.button.domObj,{horizontal:["right right"],vertical:["bottom top","top bottom"],offsets:this.chromeOffsets});this.contentContainer.setStyle("visibility","");document.addEvent("mousedown",this.hide);document.addEvent("keyup",this.keypressHandler);this.fireEvent("show",this)}).bindWithEvent(this.menu),mouseenter:(function(){document.id(this.domObj.firstChild).addClass("jxButtonHover");if(B){this.domDisclose.addClass(this.options.pressedClass)}}).bind(this),mouseleave:(function(){document.id(this.domObj.firstChild).removeClass("jxButtonHover");this.domDisclose.removeClass(this.options.pressedClass)}).bind(this),mousedown:(function(C){this.domDisclose.addClass(this.options.pressedClass);B=true;this.focus()}).bindWithEvent(this),mouseup:(function(C){this.domDisclose.removeClass(this.options.pressedClass)}).bindWithEvent(this),keydown:(function(C){if(C.key=="enter"){this.domDisclose.addClass(this.options.pressedClass)}}).bindWithEvent(this),keyup:(function(C){if(C.key=="enter"){this.domDisclose.removeClass(this.options.pressedClass)}}).bindWithEvent(this),blur:function(){B=false}});if(typeof Drag!="undefined"){new Drag(this.domDisclose,{onStart:function(){this.stop()}})}}this.menu.addEvents({show:(function(){this.domA.addClass(this.options.activeClass)}).bind(this),hide:(function(){if(this.options.active){this.domA.addClass(this.options.activeClass)}}).bind(this)});if(this.options.items){this.add(this.options.items)}},add:function(){$A(arguments).flatten().each(function(B){if(!B instanceof Jx.Button){return }B.domA.addClass("jxDiscloser");B.setLabel(B.options.label);this.buttons.push(B);var D=this.setButton.bind(this,B);var C={image:B.options.image,imageClass:B.options.imageClass,label:B.options.label||"&nbsp;",enabled:B.options.enabled,tooltip:B.options.tooltip,toggle:true,onClick:D};if(!C.image||C.image.indexOf("a_pixel")!=-1){delete C.image}var A=new Jx.Menu.Item(C);this.buttonSet.add(A);this.menu.add(A);B.multiButton=A;B.domA.addClass("jxButtonMulti");if(!this.activeButton){this.domA.dispose();this.setActiveButton(B)}},this)},remove:function(A){if(!A||!A.multiButton){return }if(this.menu.remove(A.multiButton)){A.multiButton=null;if(this.activeButton==A){if(!this.buttons.some(function(B){if(B!=A){this.setActiveButton(B);return true}else{return false}},this)){this.setActiveButton(null)}}this.buttons.erase(A)}},empty:function(){this.buttons.each(function(A){this.remove(A)},this)},setActiveButton:function(A){if(this.activeButton){this.activeButton.domA.dispose();this.activeButton.domA.removeEvent("click",this.clickHandler)}if(A&&A.domA){this.domObj.grab(A.domA,"top");this.domA=A.domA;this.domA.addEvent("click",this.clickHandler);if(this.options.toggle){this.options.active=false;this.setActive(true)}}this.activeButton=A},setButton:function(A){this.setActiveButton(A);A.clicked()}});Jx.Menu.Item=new Class({Family:"Jx.Menu.Item",Extends:Jx.Button,owner:null,options:{label:"&nbsp;",toggleClass:"jxMenuItemToggle",pressedClass:"jxMenuItemPressed",activeClass:"jxMenuItemActive",template:'<li class="jxMenuItemContainer"><a class="jxMenuItem"><span class="jxMenuItemContent"><img class="jxMenuItemIcon" src="'+Jx.aPixel.src+'"><span class="jxMenuItemLabel"></span></span></a></li>'},classes:new Hash({domObj:"jxMenuItemContainer",domA:"jxMenuItem",domImg:"jxMenuItemIcon",domLabel:"jxMenuItemLabel"}),render:function(){if(!this.options.image){this.options.image=Jx.aPixel.src}this.parent();if(this.options.image&&this.options.image!=Jx.aPixel.src){this.domObj.removeClass(this.options.toggleClass)}this.domObj.addEvent("mouseover",this.onMouseOver.bind(this));this.domObj.store("jxMenuItem",this)},setOwner:function(A){this.owner=A},hide:function(){this.blur()},show:$empty,clicked:function(A){if(this.options.enabled){if(this.options.toggle){this.setActive(!this.options.active)}this.fireEvent("click",this);if(this.owner&&this.owner.deactivate){this.owner.deactivate(A.event)}}},onMouseOver:function(){if(this.owner&&this.owner.setVisibleItem){this.owner.setVisibleItem(this)}}});Jx.Layout=new Class({Family:"Jx.Layout",Extends:Jx.Object,options:{resizeWithWindow:false,propagate:true,position:"absolute",left:0,right:0,top:0,bottom:0,width:null,height:null,minWidth:0,minHeight:0,maxWidth:-1,maxHeight:-1},parameters:["domObj","options"],init:function(){this.domObj=document.id(this.options.domObj);this.domObj.resize=this.resize.bind(this);this.domObj.setStyle("position",this.options.position);this.domObj.store("jxLayout",this);if(this.options.resizeWithWindow||document.body==this.domObj.parentNode){window.addEvent("resize",this.windowResize.bindWithEvent(this));window.addEvent("load",this.windowResize.bind(this))}},windowResize:function(){this.resize();if(this.resizeTimer){$clear(this.resizeTimer);this.resizeTimer=null}this.resizeTimer=this.resize.delay(50,this)},resize:function(K){this.resizeTimer=null;var B=false;if(K){for(var G in K){if(G=="forceResize"){continue}if(this.options[G]!=K[G]){B=true;this.options[G]=K[G]}}if(K.forceResize){B=true}}if(!document.id(this.domObj.parentNode)){return }var C;if(this.domObj.parentNode.tagName=="BODY"){C=Jx.getPageDimensions()}else{C=document.id(this.domObj.parentNode).getContentBoxSize()}if(this.lastParentSize&&!B){B=(this.lastParentSize.width!=C.width||this.lastParentSize.height!=C.height)}else{B=true}this.lastParentSize=C;if(!B){return }var E,J,I,H;if(this.options.left!=null){E=this.options.left;if(this.options.right==null){if(this.options.width==null){I=C.width-E;if(I<this.options.minWidth){I=this.options.minWidth}if(this.options.maxWidth>=0&&I>this.options.maxWidth){I=this.options.maxWidth}}else{I=this.options.width}}else{if(this.options.width==null){I=C.width-E-this.options.right;if(I<this.options.minWidth){I=this.options.minWidth}if(this.options.maxWidth>=0&&I>this.options.maxWidth){I=this.options.maxWidth}}else{I=this.options.width}}}else{if(this.options.right==null){if(this.options.width==null){E=0;I=C.width;if(this.options.maxWidth>=0&&I>this.options.maxWidth){E=E+parseInt(I-this.options.maxWidth,10)/2;I=this.options.maxWidth}}else{I=this.options.width;E=parseInt((C.width-I)/2,10);if(E<0){E=0}}}else{if(this.options.width!=null){I=this.options.width;E=C.width-I-this.options.right;if(E<0){E=0}}else{E=0;I=C.width-this.options.right;if(I<this.options.minWidth){I=this.options.minWidth}if(this.options.maxWidth>=0&&I>this.options.maxWidth){E=I-this.options.maxWidth-this.options.right;I=this.options.maxWidth}}}}if(this.options.top!=null){J=this.options.top;if(this.options.bottom==null){if(this.options.height==null){H=C.height-J;if(H<this.options.minHeight){H=this.options.minHeight}if(this.options.maxHeight>=0&&H>this.options.maxHeight){H=this.options.maxHeight}}else{H=this.options.height;if(this.options.maxHeight>=0&&H>this.options.maxHeight){J=H-this.options.maxHeight;H=this.options.maxHeight}}}else{if(this.options.height==null){H=C.height-J-this.options.bottom;if(H<this.options.minHeight){H=this.options.minHeight}if(this.options.maxHeight>=0&&H>this.options.maxHeight){H=this.options.maxHeight}}else{H=this.options.height}}}else{if(this.options.bottom==null){if(this.options.height==null){J=0;H=C.height;if(H<this.options.minHeight){H=this.options.minHeight}if(this.options.maxHeight>=0&&H>this.options.maxHeight){J=parseInt((C.height-this.options.maxHeight)/2,10);H=this.options.maxHeight}}else{H=this.options.height;J=parseInt((C.height-H)/2,10);if(J<0){J=0}}}else{if(this.options.height!=null){H=this.options.height;J=C.height-H-this.options.bottom;if(J<0){J=0}}else{J=0;H=C.height-this.options.bottom;if(H<this.options.minHeight){H=this.options.minHeight}if(this.options.maxHeight>=0&&H>this.options.maxHeight){J=C.height-this.options.maxHeight-this.options.bottom;H=this.options.maxHeight}}}}var F={width:I};if(this.options.position=="absolute"){var D=document.id(this.domObj.parentNode).measure(function(){return this.getSizes(["padding"],["left","top"]).padding});this.domObj.setStyles({position:this.options.position,left:E+D.left,top:J+D.top});F.height=H}else{if(this.options.height){F.height=this.options.height}}this.domObj.setBorderBoxSize(F);if(this.options.propagate){var A={forceResize:K?K.forceResize:false};$A(this.domObj.childNodes).each(function(L){if(L.resize&&L.getStyle("display")!="none"){L.resize.delay(0,L,A)}})}this.fireEvent("sizeChange",this)}});Jx.Toolbar=new Class({Family:"Jx.Toolbar",Extends:Jx.Widget,list:null,domObj:null,isActive:false,options:{position:"top",parent:null,autoSize:false,align:"left",scroll:true,template:'<ul class="jxToolbar"></ul>'},classes:new Hash({domObj:"jxToolbar"}),render:function(){this.parent();this.domObj.store("jxToolbar",this);if($defined(this.options.id)){this.domObj.id=this.options.id}this.list=new Jx.List(this.domObj,{onAdd:function(A){this.fireEvent("add",this)}.bind(this),onRemove:function(A){this.fireEvent("remove",this)}.bind(this)});if(this.options.parent){this.addTo(this.options.parent)}this.deactivateWatcher=this.deactivate.bindWithEvent(this);if(this.options.items){this.add(this.options.items)}},addTo:function(A){var B=document.id(A).retrieve("jxBarContainer");if(!B){B=new Jx.Toolbar.Container({parent:A,position:this.options.position,autoSize:this.options.autoSize,align:this.options.align,scroll:this.options.scroll})}B.add(this);return this},add:function(){$A(arguments).flatten().each(function(A){var B=A;if(B.domObj){B=B.domObj}if(B.tagName=="LI"){if(!B.hasClass("jxToolItem")){B.addClass("jxToolItem")}}else{B=new Jx.Toolbar.Item(A)}this.list.add(B)},this);this.update();return this},remove:function(B){if(B.domObj){B=B.domObj}var A=B.findElement("LI");this.list.remove(A);this.update();return this},empty:function(){this.list.each(function(A){this.remove(A)},this)},deactivate:function(){this.list.each(function(A){if(A.retrieve("jxMenu")){A.retrieve("jxMenu").hide()}});this.setActive(false)},isActive:function(){return this.isActive},setActive:function(A){this.isActive=A;if(this.isActive){document.addEvent("click",this.deactivateWatcher)}else{document.removeEvent("click",this.deactivateWatcher)}},setVisibleItem:function(A){if(this.visibleItem&&this.visibleItem.hide&&this.visibleItem!=A){this.visibleItem.hide()}this.visibleItem=A;if(this.isActive()){this.visibleItem.show()}},showItem:function(A){this.fireEvent("show",A)},update:function(){this.fireEvent("update")},changeText:function(A){this.update()}});Jx.Toolbar.Container=new Class({Family:"Jx.Toolbar.Container",Extends:Jx.Widget,Binds:["update"],pluginNamespace:"ToolbarContainer",domObj:null,options:{parent:null,position:"top",autoSize:false,scroll:true,align:"left",template:"<div class='jxBarContainer'><div class='jxBarControls'></div></div>",scrollerTemplate:"<div class='jxBarScroller'><div class='jxBarWrapper'></div></div>"},classes:new Hash({domObj:"jxBarContainer",scroller:"jxBarScroller",wrapper:"jxBarWrapper",controls:"jxBarControls"}),updating:false,render:function(){this.parent();if(document.id(this.options.parent)){this.domObj=document.id(this.options.parent);this.elements=new Hash({jxBarContainer:this.domObj});this.domObj.addClass("jxBarContainer");this.domObj.grab(this.controls);this.domObj.addEvent("sizeChange",this.update)}if(this.options.scroll){this.processElements(this.options.scrollerTemplate,this.classes);this.domObj.grab(this.scroller,"top")}else{this.domObj.addClass("jxToolbarAlign"+this.options.align.capitalize())}this.domObj.store("jxBarContainer",this);if(["top","right","bottom","left"].contains(this.options.position)){this.domObj.addClass("jxBar"+this.options.position.capitalize())}else{this.domObj.addClass("jxBarTop");this.options.position="top"}if(this.options.scroll&&["top","bottom"].contains(this.options.position)){this.addEvent("addTo",function(){this.domObj.getParent().addEvent("sizeChange",this.update);this.update()});this.scrollLeft=new Jx.Button({image:Jx.aPixel.src}).addTo(this.controls,"bottom");document.id(this.scrollLeft).addClass("jxBarScrollLeft");this.scrollLeft.addEvents({click:this.scroll.bind(this,"left")});this.scrollRight=new Jx.Button({image:Jx.aPixel.src}).addTo(this.controls,"bottom");document.id(this.scrollRight).addClass("jxBarScrollRight");this.scrollRight.addEvents({click:this.scroll.bind(this,"right")})}else{if(this.options.scroll&&["left","right"].contains(this.options.position)){this.options.scroll=false}else{this.options.scroll=false}}this.addEvent("add",this.update);if(this.options.toolbars){this.add(this.options.toolbars)}},update:function(){if(this.options.scroll){if(["top","bottom"].contains(this.options.position)){var A=this.domObj.getContentBoxSize().width;var D=0;var B=this.wrapper.getChildren();if(B.length>0){B.each(function(F){D+=F.getMarginBoxSize().width},this);var E=A;if(D===0){this.scrollLeft.setEnabled(false);this.scrollRight.setEnabled(false)}else{var C=this.wrapper.getStyle("margin-left").toInt();E-=this.controls.getMarginBoxSize().width;if(C<0){this.scrollLeft.setEnabled(true)}else{this.scrollLeft.setEnabled(false)}if(D+C>E){this.scrollRight.setEnabled(true)}else{this.scrollRight.setEnabled(false)}}}else{this.scrollRight.setEnabled(false);this.scrollLeft.setEnabled(false)}this.scroller.setStyle("width",E);this.findFirstVisible();this.updating=false}}},findFirstVisible:function(){if($defined(this.scroller.retrieve("buttonPointer"))){return }var A=this.wrapper.getChildren();if(A.length>0){A.each(function(C){var B=C.getChildren();if(B.length>1){B.each(function(D){var E=D.getCoordinates(this.scroller);if(E.left>=0&&!$defined(this.scroller.retrieve("buttonPointer"))){this.scroller.store("buttonPointer",D)}},this)}},this)}},add:function(){$A(arguments).flatten().each(function(A){if(this.options.scroll){A.addEvent("update",this.update.bind(this));A.addEvent("show",this.scrollIntoView.bind(this))}if(this.wrapper){this.wrapper.adopt(A.domObj)}else{this.domObj.adopt(A.domObj)}this.domObj.addClass("jxBar"+this.options.position.capitalize())},this);if(arguments.length>0){this.fireEvent("add",this)}return this},scroll:function(D){if(this.updating){return }this.updating=true;var C=this.scroller.retrieve("buttonPointer");if(D==="left"){var A=this.scroller.retrieve("previousPointer");if(!A){A=this.getPreviousButton(C)}if(A){var B=A.getMarginBoxSize().width;var E=this.wrapper.getStyle("margin-left").toInt();E+=B;if(typeof Fx!="undefined"&&typeof Fx.Tween!="undefined"){this.wrapper.get("tween",{property:"margin-left",onComplete:this.afterTweenLeft.bind(this,A)}).start(E)}else{this.wrapper.setStyle("margin-left",E);this.afterTweenLeft(A)}}else{this.update()}}else{var B=C.getMarginBoxSize().width;var E=this.wrapper.getStyle("margin-left").toInt();E-=B;if(typeof Fx!="undefined"&&typeof Fx.Tween!="undefined"){this.wrapper.get("tween",{property:"margin-left",onComplete:this.afterTweenRight.bind(this,C)}).start(E)}else{this.wrapper.setStyle("margin-left",E);this.afterTweenRight(C)}}},afterTweenRight:function(A){var B=this.getNextButton(A);if(!B){B=A}this.scroller.store("buttonPointer",B);if(B!==A){this.scroller.store("previousPointer",A)}this.update()},afterTweenLeft:function(A){this.scroller.store("buttonPointer",A);var B=this.getPreviousButton(A);if($defined(B)){this.scroller.store("previousPointer",B)}else{this.scroller.eliminate("previousPointer")}this.update()},remove:function(A){if(A instanceof Jx.Widget){A.dispose()}else{document.id(A).dispose()}this.update()},scrollIntoView:function(C){var B=this.scroller.retrieve("buttonPointer");if(C instanceof Jx.Widget){C=C.domObj;while(!C.hasClass("jxToolItem")){C=C.getParent()}}var H=C.getCoordinates(this.scroller);var F=this.scroller.getStyle("width").toInt();if(H.right>0&&H.right<=F&&H.left>0&&H.left<=F){return }if(H.right>F){var E=H.right-F;var G=this.wrapper.getStyle("margin-left").toInt();var A=B.getMarginBoxSize().width;var D;while(A<E&&$defined(B)){D=this.getNextButton(B);if(D){A+=D.getMarginBoxSize().width}else{break}B=D}G-=A;if(typeof Fx!="undefined"&&typeof Fx.Tween!="undefined"){this.wrapper.get("tween",{property:"margin-left",onComplete:this.afterTweenRight.bind(this,B)}).start(G)}else{this.wrapper.setStyle("margin-left",G);this.afterTweenRight(B)}}else{var G=this.wrapper.getStyle("margin-left").toInt();G-=H.left;if(typeof Fx!="undefined"&&typeof Fx.Tween!="undefined"){this.wrapper.get("tween",{property:"margin-left",onComplete:this.afterTweenLeft.bind(this,C)}).start(G)}else{this.wrapper.setStyle("margin-left",G);this.afterTweenLeft(C)}}},getPreviousButton:function(A){pp=A.getPrevious();if(!$defined(pp)){pp=A.getParent().getPrevious();if(pp){pp=pp.getLast()}}return pp},getNextButton:function(A){np=A.getNext();if(!np){np=A.getParent().getNext();if(np){np=np.getFirst()}}return np}});Jx.Toolbar.Item=new Class({Family:"Jx.Toolbar.Item",Extends:Jx.Widget,options:{active:true,template:'<li class="jxToolItem"></li>'},classes:new Hash({domObj:"jxToolItem"}),parameters:["jxThing"],render:function(){this.parent();var A=document.id(this.options.jxThing);if(A){this.domObj.adopt(A)}}});Jx.Panel=new Class({Family:"Jx.Panel",Extends:Jx.Widget,toolbarContainers:{top:null,right:null,bottom:null,left:null},options:{position:null,collapsedClass:"jxPanelMin",collapseClass:"jxPanelCollapse",menuClass:"jxPanelMenu",maximizeClass:"jxPanelMaximize",closeClass:"jxPanelClose",label:"&nbsp;",height:null,collapse:true,close:false,closed:false,hideTitle:false,toolbars:[],type:"panel",template:'<div class="jxPanel"><div class="jxPanelTitle"><img class="jxPanelIcon" src="'+Jx.aPixel.src+'" alt="" title=""/><span class="jxPanelLabel"></span><div class="jxPanelControls"></div></div><div class="jxPanelContentContainer"><div class="jxPanelContent"></div></div></div>',controlButtonTemplate:'<a class="jxButtonContainer jxButton"><img class="jxButtonIcon" src="'+Jx.aPixel.src+'"></a>'},classes:new Hash({domObj:"jxPanel",title:"jxPanelTitle",domImg:"jxPanelIcon",domLabel:"jxPanelLabel",domControls:"jxPanelControls",contentContainer:"jxPanelContentContainer",content:"jxPanelContent"}),render:function(){this.parent();this.toolbars=this.options?this.options.toolbars||[]:[];this.options.position=($defined(this.options.height)&&!$defined(this.options.position))?"relative":"absolute";if(this.options.image&&this.domImg){this.domImg.setStyle("backgroundImage","url("+this.options.image+")")}if(this.options.label&&this.domLabel){this.setLabel(this.options.label)}var A=new Element("div");this.domControls.adopt(A);this.toolbar=new Jx.Toolbar({parent:A,scroll:false});var E=this;if(this.options.menu){this.menu=new Jx.Menu({image:Jx.aPixel.src},{buttonTemplate:this.options.controlButtonTemplate});this.menu.domObj.addClass(this.options.menuClass);this.menu.domObj.addClass("jxButtonContentLeft");this.toolbar.add(this.menu)}if(this.options.collapse){this.colB=new Jx.Button({template:this.options.controlButtonTemplate,image:Jx.aPixel.src,tooltip:MooTools.lang.get("Jx","panel").collapseTooltip,onClick:function(){E.toggleCollapse()}});this.colB.domObj.addClass(this.options.collapseClass);this.addEvents({collapse:function(){this.colB.setTooltip(MooTools.lang.get("Jx","panel").expandTooltip)}.bind(this),expand:function(){this.colB.setTooltip(MooTools.lang.get("Jx","panel").collapseTooltip)}.bind(this)});this.toolbar.add(this.colB);if(this.menu){this.colM=new Jx.Menu.Item({label:this.options.collapseLabel,onClick:function(){E.toggleCollapse()}});var D=this.colM;this.addEvents({collapse:function(){this.colM.setLabel(MooTools.lang.get("Jx","panel").expandLabel)}.bind(this),expand:function(){this.colM.setLabel(MooTools.lang.get("Jx","panel").collapseLabel)}.bind(this)});this.menu.add(D)}}if(this.options.maximize){this.maxB=new Jx.Button({template:this.options.controlButtonTemplate,image:Jx.aPixel.src,tooltip:MooTools.lang.get("Jx","panel").maximizeTooltip,onClick:function(){E.maximize()}});this.maxB.domObj.addClass(this.options.maximizeClass);this.addEvents({maximize:function(){this.maxB.setTooltip(MooTools.lang.get("Jx","panel").restoreTooltip)}.bind(this),restore:function(){this.maxB.setTooltip(MooTools.lang.get("Jx","panel").maximizeTooltip)}.bind(this)});this.toolbar.add(this.maxB);if(this.menu){this.maxM=new Jx.Menu.Item({label:this.options.maximizeLabel,onClick:function(){E.maximize()}});this.addEvents({maximize:function(){this.maxM.setLabel(MooTools.lang.get("Jx","panel").restoreLabel)}.bind(this),restore:function(){this.maxM.setLabel(MooTools.lang.get("Jx","panel").maximizeLabel)}.bind(this)});this.menu.add(this.maxM)}}if(this.options.close){this.closeB=new Jx.Button({template:this.options.controlButtonTemplate,image:Jx.aPixel.src,tooltip:MooTools.lang.get("Jx","panel").closeTooltip,onClick:function(){E.close()}});this.closeB.domObj.addClass(this.options.closeClass);this.toolbar.add(this.closeB);if(this.menu){this.closeM=new Jx.Menu.Item({label:MooTools.lang.get("Jx","panel").closeLabel,onClick:function(){E.close()}});this.menu.add(D)}}this.title.addEvent("dblclick",function(){E.toggleCollapse()});if(this.options.id){this.domObj.id=this.options.id}var C=new Jx.Layout(this.domObj,$merge(this.options,{propagate:false}));var B=this.layoutContent.bind(this);C.addEvent("sizeChange",B);if(this.options.hideTitle){this.title.dispose()}if(Jx.type(this.options.toolbars)=="array"){this.options.toolbars.each(function(G){var F=G.options.position;var H=this.toolbarContainers[F];if(!H){H=new Element("div");new Jx.Layout(H);this.contentContainer.adopt(H);this.toolbarContainers[F]=H}G.addTo(H)},this)}new Jx.Layout(this.contentContainer);new Jx.Layout(this.content);this.loadContent(this.content);this.toggleCollapse(this.options.closed);this.addEvent("addTo",function(){this.domObj.resize()});if(this.options.parent){this.addTo(this.options.parent)}},layoutContent:function(){var F=0;var G=0;var A=0;var C=0;var I=0;var H;var D;var E;if(!this.options.hideTitle&&this.title.parentNode==this.domObj){F=this.title.getMarginBoxSize().height}var B=this.domObj.getContentBoxSize();if(B.height>F){this.contentContainer.setStyle("display","block");this.options.closed=false;this.contentContainer.resize({top:F,height:null,bottom:0});["left","right"].each(function(J){if(this.toolbarContainers[J]){this.toolbarContainers[J].style.width="auto"}},this);["top","bottom"].each(function(J){if(this.toolbarContainers[J]){this.toolbarContainers[J].style.height=""}},this);if(Jx.type(this.options.toolbars)=="array"){this.options.toolbars.each(function(J){J.update();E=J.options.position;H=this.toolbarContainers[E];if(Browser.Engine.trident4){var L=document.id(H.parentNode);H.style.visibility="hidden";document.id(document.body).adopt(H)}var K=H.getBorderBoxSize();if(Browser.Engine.trident4){L.adopt(H);H.style.visibility=""}switch(E){case"bottom":A=K.height;break;case"left":C=K.width;break;case"right":I=K.width;break;case"top":default:G=K.height;break}},this)}H=this.toolbarContainers.top;if(H){H.resize({top:0,left:C,right:I,bottom:null,height:G,width:null})}H=this.toolbarContainers.bottom;if(H){H.resize({top:null,left:C,right:I,bottom:0,height:A,width:null})}H=this.toolbarContainers.left;if(H){H.resize({top:G,left:0,right:null,bottom:A,height:null,width:C})}H=this.toolbarContainers.right;if(H){H.resize({top:G,left:null,right:0,bottom:A,height:null,width:I})}this.content.resize({top:G,bottom:A,left:C,right:I})}else{this.contentContainer.setStyle("display","none");this.options.closed=true}this.fireEvent("sizeChange",this)},setLabel:function(A){this.domLabel.set("html",this.getText(A))},getLabel:function(){return this.domLabel.get("html")},finalize:function(){this.domObj=null;this.deregisterIds()},maximize:function(){if(this.manager){this.manager.maximizePanel(this)}},setContent:function(A){this.content.innerHTML=A;this.bContentReady=true},setContentURL:function(B){this.bContentReady=false;this.setBusy(true);if(arguments[1]){this.onContentReady=arguments[1]}if(B.indexOf("?")==-1){B=B+"?"}var A=new Request({url:B,method:"get",evalScripts:true,onSuccess:this.panelContentLoaded.bind(this),requestHeaders:["If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"]}).send()},panelContentLoaded:function(A){this.content.innerHTML=A;this.bContentReady=true;this.setBusy(false);if(this.onContentReady){window.setTimeout(this.onContentReady.bind(this),1)}},toggleCollapse:function(C){if($defined(C)){this.options.closed=C}else{this.options.closed=!this.options.closed}if(this.options.closed){if(!this.domObj.hasClass(this.options.collapsedClass)){this.domObj.addClass(this.options.collapsedClass);this.contentContainer.setStyle("display","none");var B=this.domObj.measure(function(){return this.getSizes(["margin"],["top","bottom"]).margin});var A=B.top+B.bottom;if(this.title.parentNode==this.domObj){A+=this.title.getMarginBoxSize().height}this.domObj.resize({height:A});this.fireEvent("collapse",this)}}else{if(this.domObj.hasClass(this.options.collapsedClass)){this.domObj.removeClass(this.options.collapsedClass);this.contentContainer.setStyle("display","block");this.domObj.resize({height:this.options.height});this.fireEvent("expand",this)}}},close:function(){this.domObj.dispose();this.fireEvent("close",this)},changeText:function(A){this.parent();if($defined(this.closeB)){this.closeB.setTooltip(MooTools.lang.get("Jx","panel").closeTooltip)}if($defined(this.closeM)){this.closeM.setLabel(MooTools.lang.get("Jx","panel").closeLabel)}if($defined(this.maxB)){this.maxB.setTooltip(MooTools.lang.get("Jx","panel").maximizeTooltip)}if($defined(this.colB)){this.colB.setTooltip(MooTools.lang.get("Jx","panel").collapseTooltip)}if($defined(this.colM)){if(this.options.closed==true){this.colM.setLabel(MooTools.lang.get("Jx","panel").expandLabel)}else{this.colM.setLabel(MooTools.lang.get("Jx","panel").collapseLabel)}}if(this.options.label&&this.domLabel){this.setLabel(this.options.label)}this.layoutContent()}});Jx.Dialog=new Class({Family:"Jx.Dialog",Extends:Jx.Panel,options:{modal:true,maskOptions:{"class":"jxModalMask",maskMargins:true,useIframeShim:true,iframeShimOptions:{className:"jxIframeShim"}},eventMaskOptions:{"class":"jxEventMask",maskMargins:false,useIframeShim:false,destroyOnHide:true},position:"absolute",width:250,height:250,horizontal:"center center",vertical:"center center",label:"",resize:false,move:true,close:true,useKeyboard:false,keys:{esc:"close"},keyboardMethods:{},collapsedClass:"jxDialogMin",collapseClass:"jxDialogCollapse",menuClass:"jxDialogMenu",maximizeClass:"jxDialogMaximize",closeClass:"jxDialogClose",type:"dialog",template:'<div class="jxDialog"><div class="jxDialogTitle"><img class="jxDialogIcon" src="'+Jx.aPixel.src+'" alt="" title=""/><span class="jxDialogLabel"></span><div class="jxDialogControls"></div></div><div class="jxDialogContentContainer"><div class="jxDialogContent"></div></div></div>',},classes:new Hash({domObj:"jxDialog",title:"jxDialogTitle",domImg:"jxDialogIcon",domLabel:"jxDialogLabel",domControls:"jxDialogControls",contentContainer:"jxDialogContentContainer",content:"jxDialogContent"}),keyboard:null,render:function(){this.isOpening=false;this.firstShow=true;this.options=$merge({parent:document.body},this.options,{position:"absolute"});this.parent();this.openOnLoaded=this.open.bind(this);this.options.parent=document.id(this.options.parent);this.domObj.setStyle("display","none");this.options.parent.adopt(this.domObj);if(this.options.move&&typeof Drag!="undefined"){this.title.addClass("jxDialogMoveable");new Drag(this.domObj,{handle:this.title,onBeforeStart:(function(){this.stack()}).bind(this),onStart:(function(){if(!this.options.modal&&this.options.parent.mask){this.options.parent.mask(this.options.eventMaskOptions)}this.contentContainer.setStyle("visibility","hidden");this.chrome.addClass("jxChromeDrag")}).bind(this),onComplete:(function(){if(!this.options.modal&&this.options.parent.unmask){this.options.parent.unmask()}this.chrome.removeClass("jxChromeDrag");this.contentContainer.setStyle("visibility","");var B=Math.max(this.chromeOffsets.left,parseInt(this.domObj.style.left,10));var A=Math.max(this.chromeOffsets.top,parseInt(this.domObj.style.top,10));this.options.horizontal=B+" left";this.options.vertical=A+" top";this.position(this.domObj,this.options.parent,this.options);this.options.left=parseInt(this.domObj.style.left,10);this.options.top=parseInt(this.domObj.style.top,10);if(!this.options.closed){this.domObj.resize(this.options)}}).bind(this)})}if(this.options.resize&&typeof Drag!="undefined"){this.resizeHandle=new Element("div",{"class":"jxDialogResize",title:MooTools.lang.get("Jx","panel").resizeTooltip,styles:{display:this.options.closed?"none":"block"}});this.domObj.appendChild(this.resizeHandle);this.resizeHandleSize=this.resizeHandle.getSize();this.resizeHandle.setStyles({bottom:this.resizeHandleSize.height,right:this.resizeHandleSize.width});this.domObj.makeResizable({handle:this.resizeHandle,onStart:(function(){if(!this.options.modal&&this.options.parent.mask){this.options.parent.mask(this.options.eventMaskOptions)}this.contentContainer.setStyle("visibility","hidden");this.chrome.addClass("jxChromeDrag")}).bind(this),onDrag:(function(){this.resizeChrome(this.domObj)}).bind(this),onComplete:(function(){if(!this.options.modal&&this.options.parent.unmask){this.options.parent.unmask()}this.chrome.removeClass("jxChromeDrag");var A=this.domObj.getMarginBoxSize();this.options.width=A.width;this.options.height=A.height;this.layoutContent();this.domObj.resize(this.options);this.contentContainer.setStyle("visibility","");this.fireEvent("resize");this.resizeChrome(this.domObj)}).bind(this)})}this.domObj.addEvent("mousedown",(function(){this.stack()}).bind(this));this.initializeKeyboard()},resize:function(B,A,C){this.options.width=B;this.options.height=A;if(this.domObj.getStyle("display")!="none"){this.layoutContent();this.domObj.resize(this.options);this.fireEvent("resize");this.resizeChrome(this.domObj);if(C){this.position(this.domObj,this.options.parent,this.options)}}else{this.firstShow=false}},sizeChanged:function(){if(!this.options.closed){this.layoutContent()}},toggleCollapse:function(C){if($defined(C)){this.options.closed=C}else{this.options.closed=!this.options.closed}if(this.options.closed){if(!this.domObj.hasClass(this.options.collapsedClass)){this.domObj.addClass(this.options.collapsedClass)}this.contentContainer.setStyle("display","none");if(this.resizeHandle){this.resizeHandle.setStyle("display","none")}}else{if(this.domObj.hasClass(this.options.collapsedClass)){this.domObj.removeClass(this.options.collapsedClass)}this.contentContainer.setStyle("display","block");if(this.resizeHandle){this.resizeHandle.setStyle("display","block")}}if(this.options.closed){var A=this.domObj.measure(function(){return this.getSizes(["margin"],["top","bottom"]).margin});var B=this.title.getMarginBoxSize();this.domObj.resize({height:A.top+B.height+A.bottom});this.fireEvent("collapse")}else{this.domObj.resize(this.options);this.fireEvent("expand")}this.showChrome(this.domObj)},maximize:function(){if(!this.maximized){var B=this.options.parent;var A;if(B===document.body){A=Jx.getPageDimensions()}else{A=B.getBorderBoxSize()}this.previousSettings={width:this.options.width,height:this.options.height,horizontal:this.options.horizontal,vertical:this.options.vertical,left:this.options.left,right:this.options.right,top:this.options.top,bottom:this.options.bottom};this.options.width=A.width;this.options.height=A.height;this.options.vertical="0 top";this.options.horizontal="0 left";this.options.right=0;this.options.left=0;this.options.top=0;this.options.bottom=0;this.domObj.resize(this.options);this.fireEvent("resize");this.resizeChrome(this.domObj);this.maximized=true;this.domObj.addClass("jxDialogMaximized");this.fireEvent("maximize")}else{this.options=$merge(this.options,this.previousSettings);this.domObj.resize(this.options);this.fireEvent("resize");this.resizeChrome(this.domObj);this.maximized=false;if(this.domObj.hasClass("jxDialogMaximized")){this.domObj.removeClass("jxDialogMaximized")}this.fireEvent("restore")}},show:function(){this.domObj.setStyles({display:"block",visibility:"hidden"});this.toolbar.update();if(this.options.modal&&this.options.parent.mask){var C=$merge(this.options.maskOptions||{},{style:{"z-index":Jx.getNumber(this.domObj.getStyle("z-index"))-1}});this.options.parent.mask(C);Jx.Stack.stack(this.options.parent.get("mask").element)}this.stack();if(this.options.closed){var A=this.domObj.measure(function(){return this.getSizes(["margin"],["top","bottom"]).margin});var B=this.title.getMarginBoxSize();this.domObj.resize({height:A.top+B.height+A.bottom})}else{this.domObj.resize(this.options)}if(this.firstShow){this.contentContainer.resize({forceResize:true});this.layoutContent();this.firstShow=false;if(this.chrome){this.chrome.dispose();this.chrome=null}}this.showChrome(this.domObj);this.position(this.domObj,this.options.parent,this.options);this.domObj.setStyle("visibility","visible")},hide:function(){this.domObj.setStyle("display","none");this.unstack();if(this.options.modal&&this.options.parent.unmask){Jx.Stack.unstack(this.options.parent.get("mask").element);this.options.parent.unmask()}if(this.options.useKeyboard&&this.keyboard!=null){this.keyboard.deactivate()}},openURL:function(A){if(A){this.options.contentURL=A;this.options.content=null;this.loadContent(this.content);this.addEvent("contentLoaded",this.openOnLoaded)}else{this.open()}},open:function(){if(!this.isOpening){this.isOpening=true}if(this.contentIsLoaded){this.removeEvent("contentLoaded",this.openOnLoaded);this.show();this.fireEvent("open",this);this.isOpening=false}else{this.addEvent("contentLoaded",this.openOnLoaded)}if(this.options.useKeyboard&&this.keyboard!=null){this.keyboard.activate()}},close:function(){this.isOpening=false;this.hide();this.fireEvent("close")},cleanup:function(){},isOpen:function(){return !((this.domObj.getStyle("display")==="none")||(this.domObj.getStyle("visibility")==="hidden"))},createText:function(A){this.parent();if($defined(this.maxM)){if(this.maximize){this.maxM.setLabel(MooTools.lang.get("Jx","panel").restoreLabel)}else{this.maxM.setLabel(MooTools.lang.get("Jx","panel").maximizeLabel)}}if($defined(this.resizeHandle)){this.resizeHandle.set("title",MooTools.lang.get("Jx","dialog").resizeTooltip)}},changeText:function(A){this.parent();this.toggleCollapse(false)},initializeKeyboard:function(){if(this.options.useKeyboard){var A=this;this.keyboardEvents={};this.keyboardMethods={close:function(B){B.preventDefault();A.close()}};this.keyboard=new Keyboard({events:this.getKeyboardEvents()})}},getKeyboardEvents:function(){var A=this;for(var B in this.options.keys){if(!$defined(this.keyboardEvents[B])){if($defined(this.keyboardMethods[this.options.keys[B]])){this.keyboardEvents[B]=this.keyboardMethods[this.options.keys[B]]}else{if($defined(this.options.keyboardMethods[this.options.keys[B]])){this.keyboardEvents[B]=this.options.keyboardMethods[this.options.keys[B]].bind(A)}else{if(Jx.type(this.options.keys[B])=="function"){this.keyboardEvents[B]=this.options.keys[B].bind(A)}else{if(this.options.keyboardMethods[this.options.keys[B]]!=false){$defined(console)?console.warn("keyboard method %o not defined for %o",this.options.keys[B],this):false}}}}}}return this.keyboardEvents}});Jx.Splitter=new Class({Family:"Jx.Splitter",Extends:Jx.Object,domObj:null,elements:null,bars:null,firstUpdate:true,options:{useChildren:false,splitInto:2,elements:null,containerOptions:[],barOptions:[],layout:"horizontal",snaps:[],onStart:null,onFinish:null},parameters:["domObj","options"],init:function(){this.domObj=document.id(this.options.domObj);this.domObj.addClass("jxSplitContainer");var J=this.domObj.retrieve("jxLayout");if(J){J.addEvent("sizeChange",this.sizeChanged.bind(this))}this.elements=[];this.bars=[];var E;var I=2;if(this.options.useChildren){this.elements=this.domObj.getChildren();I=this.elements.length}else{I=this.options.elements?this.options.elements.length:this.options.splitInto;for(E=0;E<I;E++){var C;if(this.options.elements&&this.options.elements[E]){if(this.options.elements[E].domObj){C=this.options.elements[E].domObj}else{C=document.id(this.options.elements[E])}if(!C){C=this.prepareElement();C.id=this.options.elements[E]}}else{C=this.prepareElement()}this.elements[E]=C;this.domObj.adopt(this.elements[E])}}this.elements.each(function(K){K.addClass("jxSplitArea")});for(E=0;E<I;E++){var H=this.elements[E].retrieve("jxLayout");if(!H){new Jx.Layout(this.elements[E],this.options.containerOptions[E])}else{if(this.options.containerOptions[E]){H.resize($merge(this.options.containerOptions[E],{position:"absolute"}))}else{H.resize({position:"absolute"})}}}for(E=1;E<I;E++){var G;if(this.options.prepareBar){G=this.options.prepareBar(E-1)}else{G=this.prepareBar()}G.store("splitterObj",this);G.store("leftSide",this.elements[E-1]);G.store("rightSide",this.elements[E]);this.elements[E-1].store("rightBar",G);this.elements[E].store("leftBar",G);this.domObj.adopt(G);this.bars[E-1]=G}if($defined(Drag)){this.establishConstraints()}for(E=0;E<this.options.barOptions.length;E++){if(!this.bars[E]){continue}var A=this.options.barOptions[E];if(A&&A.snap&&(A.snap=="before"||A.snap=="after")){var F;if(A.snap=="before"){F=this.bars[E].retrieve("leftSide")}else{if(A.snap=="after"){F=this.bars[E].retrieve("rightSide")}}var D;var B;if(A.snapElement){D=A.snapElement;B=A.snapEvents||["click","dblclick"]}else{D=this.bars[E];B=A.snapEvents||["dblclick"]}if(!D.parentNode){this.bars[E].adopt(D)}new Jx.Splitter.Snap(D,F,this,B)}}for(E=0;E<this.options.snaps.length;E++){if(this.options.snaps[E]){new Jx.Splitter.Snap(this.options.snaps[E],this.elements[E],this)}}this.sizeChanged()},prepareElement:function(){var A=new Element("div",{styles:{position:"absolute"}});return A},prepareBar:function(){var A=new Element("div",{"class":"jxSplitBar"+this.options.layout.capitalize(),title:MooTools.lang.get("Jx","panel").barTooltip});return A},establishConstraints:function(){var A={x:null,y:null};var B;if(this.options.layout=="horizontal"){A.x="left";B=this.dragHorizontal}else{A.y="top";B=this.dragVertical}if(typeof Drag!="undefined"){this.bars.each(function(D){var C;new Drag(D,{modifiers:A,onSnap:(function(E){E.addClass("jxSplitBarDrag");this.fireEvent("snap",[E])}).bind(this),onCancel:(function(E){C.destroy();this.fireEvent("cancel",[E])}).bind(this),onDrag:(function(F,E){this.fireEvent("drag",[F,E])}).bind(this),onComplete:(function(E){C.destroy();E.removeClass("jxSplitBarDrag");if(E.retrieve("splitterObj")!=this){return }B.apply(this,[E]);this.fireEvent("complete",[E]);this.fireEvent("finish",[E])}).bind(this),onBeforeStart:(function(E){this.fireEvent("beforeStart",[E]);C=new Element("div",{"class":"jxSplitterMask"}).inject(E,"after")}).bind(this),onStart:(function(F,E){this.fireEvent("start",[F,E])}).bind(this)})},this)}},dragHorizontal:function(F){var A=parseInt(F.style.left,10);var H=F.retrieve("leftSide");var C=F.retrieve("rightSide");var D=H.retrieve("jxLayout");var G=C.retrieve("jxLayout");var E=this.domObj.measure(function(){var P=this.getSizes(["padding"],["left"]);return P.padding.left});var I,O,K;var N=F.retrieve("size");if(!N){N=F.getBorderBoxSize();F.store("size",N)}I=A+N.width-E;var B=this.domObj.getContentBoxSize();if(G.options.width!=null){O=G.options.width+G.options.left-I;K=B.width-I-O}else{O=B.width-G.options.right-I;K=G.options.right}if(O<0){O=0}if(O<G.options.minWidth){O=G.options.minWidth}if(G.options.maxWidth>=0&&O>G.options.maxWidth){O=G.options.maxWidth}I=B.width-K-O;A=I-N.width;var J,M;J=D.options.left;M=A-J;if(M<0){M=0}if(M<D.options.minWidth){M=D.options.minWidth}if(D.options.maxWidth>=0&&M>D.options.maxWidth){M=D.options.maxWidth}if(J+M!=A){A=J+M;var L=A+N.width-I;I+=L;O-=L}F.style.left=E+A+"px";if(D.options.width==null){B=this.domObj.getContentBoxSize();H.resize({right:B.width-J-M})}else{H.resize({width:M})}if(G.options.width==null){C.resize({left:I})}else{C.resize({left:I,width:O})}},dragVertical:function(F){var J=parseInt(F.style.top,10);var D=F.retrieve("leftSide");var A=F.retrieve("rightSide");var E=D.retrieve("jxLayout");var H=A.retrieve("jxLayout");var N=this.domObj.measure(function(){var P=this.getSizes(["padding"],["top"]);return P.padding.top});var O=F.retrieve("size");if(!O){O=F.getBorderBoxSize();F.store("size",O)}var B=this.domObj.getContentBoxSize();var C,M,K;C=J+O.height-N;if(H.options.height!=null){M=H.options.height+H.options.top-C;K=B.height-C-M}else{M=B.height-H.options.bottom-C;K=H.options.bottom}if(M<0){M=0}if(M<H.options.minHeight){M=H.options.minHeight}if(H.options.maxHeight>=0&&M>H.options.maxHeight){M=H.options.maxHeight}C=B.height-K-M;J=C-O.height;var I,G;I=E.options.top;G=J-I;if(G<0){G=0}if(G<E.options.minHeight){G=E.options.minHeight}if(E.options.maxHeight>=0&&G>E.options.maxHeight){G=E.options.maxHeight}if(I+G!=J){J=I+G;var L=J+O.height-C;C+=L;M-=L}F.style.top=N+J+"px";if(E.options.height==null){D.resize({bottom:B.height-I-G})}else{D.resize({height:G})}if(H.options.height==null){A.resize({top:C})}else{A.resize({top:C,height:M})}},sizeChanged:function(){if(this.options.layout=="horizontal"){this.horizontalResize()}else{this.verticalResize()}},horizontalResize:function(){var O=this.domObj.getContentBoxSize().width;var D=O;var E,K,H;for(E=0;E<this.bars.length;E++){var L=this.bars[E];var Q=L.retrieve("size");if(!Q||Q.width==0){Q=L.getBorderBoxSize();L.store("size",Q)}O-=Q.width}var I=0,N=0;for(E=0;E<this.elements.length;E++){K=this.elements[E];H=K.retrieve("jxLayout").options;if(H.width!=null){O-=parseInt(H.width,10)}else{N=0;if(H.right!=0||H.left!=0){N=K.getBorderBoxSize().width}O-=N;I++}}if(I==0){O+=H.width;H.width=null;I=1}var G=parseInt(O/I,10);var P=O%I;var B=this.domObj.measure(function(){var R=this.getSizes(["padding"],["left"]);return R.padding.left});var C=0;for(E=0;E<this.elements.length;E++){K=this.elements[E];var J=K.retrieve("jxLayout");H=J.options;if(H.width!=null){J.resize({left:C});C+=H.width}else{var M=G;if(I==1){M+=P}I--;if(H.right!=0||H.left!=0){N=K.getBorderBoxSize().width+M}else{N=M}if(N<0){if(I>0){G=G+N/I}N=0}if(N<H.minWidth){if(I>0){G=G+(N-H.minWidth)/I}N=H.minWidth}if(H.maxWidth>=0&&N>H.maxWidth){if(I>0){G=G+(N-H.maxWidth)/I}N=K.options.maxWidth}var A=D-C-N;J.resize({left:C,right:A});C+=N}var F=K.retrieve("rightBar");if(F){F.setStyle("left",B+C);C+=F.retrieve("size").width}}},verticalResize:function(){var N=this.domObj.getContentBoxSize().height;var B=N;var D,K,H;for(D=0;D<this.bars.length;D++){var L=this.bars[D];var Q=L.retrieve("size");if(!Q||Q.height==0){Q=L.getBorderBoxSize();L.store("size",Q)}N-=Q.height}var I=0,G=0;for(D=0;D<this.elements.length;D++){K=this.elements[D];H=K.retrieve("jxLayout").options;if(H.height!=null){N-=parseInt(H.height,10)}else{if(H.bottom!=0||H.top!=0){G=K.getBorderBoxSize().height}N-=G;I++}}if(I==0){N+=H.height;H.height=null;I=1}var F=parseInt(N/I,10);var O=N%I;var P=this.domObj.measure(function(){var R=this.getSizes(["padding"],["top"]);return R.padding.top});var C=0;for(D=0;D<this.elements.length;D++){K=this.elements[D];var J=K.retrieve("jxLayout");H=J.options;if(H.height!=null){J.resize({top:C});C+=H.height}else{var M=F;if(I==1){M+=O}I--;G=0;if(H.bottom!=0||H.top!=0){G=K.getBorderBoxSize().height+M}else{G=M}if(G<0){if(I>0){F=F+G/I}G=0}if(G<H.minHeight){if(I>0){F=F+(G-H.minHeight)/I}G=H.minHeight}if(H.maxHeight>=0&&G>H.maxHeight){if(I>0){F=F+(G-H.maxHeight)/I}G=H.maxHeight}var A=B-C-G;J.resize({top:C,bottom:A});C+=G}var E=K.retrieve("rightBar");if(E){E.style.top=P+C+"px";C+=E.retrieve("size").height}}},createText:function(A){this.parent();this.bars.each(function(B){document.id(B).set("title",MooTools.lang.get("Jx","splitter").title)},this)}});Jx.PanelSet=new Class({Family:"Jx.PanelSet",Extends:Jx.Widget,options:{parent:null,panels:[]},panels:null,height:null,firstLayout:true,render:function(){if(this.options.panels){this.panels=this.options.panels;this.options.panels=null}this.domObj=new Element("div");new Jx.Layout(this.domObj);var B=new Element("div",{styles:{position:"absolute"}});new Jx.Layout(B,{minHeight:0,maxHeight:0,height:0});var A=[B];this.panels.each(function(C){A.push(C.domObj);C.options.hideTitle=true;C.contentContainer.resize({top:0});C.toggleCollapse=this.maximizePanel.bind(this,C);C.domObj.store("Jx.Panel",C);C.manager=this},this);this.splitter=new Jx.Splitter(this.domObj,{splitInto:this.panels.length+1,layout:"vertical",elements:A,prepareBar:(function(E){var F=new Element("div",{"class":"jxPanelBar",title:MooTools.lang.get("Jx","panelset").barTooltip});var C=this.panels[E];C.title.setStyle("visibility","hidden");document.id(document.body).adopt(C.title);var D=C.title.getBorderBoxSize();F.adopt(C.title);C.title.setStyle("visibility","");F.setStyle("height",D.height);F.store("size",D);return F}).bind(this)});this.addEvent("addTo",function(){document.id(this.domObj.parentNode).setStyle("overflow","hidden");this.domObj.resize()});if(this.options.parent){this.addTo(this.options.parent)}},maximizePanel:function(C){var F=this.domObj.getContentBoxSize().height;var B=F;var K=C.domObj.retrieve("jxLayout").options.maxHeight;var I,H,D,G,E,J;for(H=1;H<this.splitter.elements.length;H++){D=this.splitter.elements[H];B-=D.retrieve("leftBar").getBorderBoxSize().height;if(D!==C.domObj){G=D.retrieve("Jx.Panel");E=D.retrieve("jxLayout").options;B-=E.minHeight}else{I=H}}if(K==-1||K>=B){K=B;B=0}else{B=B-K}var L=0;for(H=1;H<this.splitter.elements.length;H++){D=this.splitter.elements[H];L+=D.retrieve("leftBar").getBorderBoxSize().height;if(D!==C.domObj){G=D.retrieve("Jx.Panel");E=D.retrieve("jxLayout").options;J=$chk(E.height)?E.height:D.getBorderBoxSize().height;if(B>0){if(B>=J){B-=J;D.resize({top:L,height:J});L+=J}else{if(B>E.minHeight){D.resize({top:L,height:B});L+=B;B=0}else{D.resize({top:L,height:E.minHeight});L+=E.minHeight}}}else{D.resize({top:L,height:E.minHeight});L+=E.minHeight}D.retrieve("rightBar").style.top=L+"px"}else{break}}var A=F;for(H=this.splitter.elements.length-1;H>0;H--){D=this.splitter.elements[H];if(D!==C.domObj){E=D.retrieve("jxLayout").options;J=$chk(E.height)?E.height:D.getBorderBoxSize().height;if(B>0){if(B>=J){A-=J;B-=J;D.resize({top:A,height:J})}else{if(B>E.minHeight){A-=B;D.resize({top:A,height:B});B=0}else{A-=E.minHeight;D.resize({top:A,height:E.minHeight})}}}else{A-=E.minHeight;D.resize({top:A,height:E.minHeight,bottom:null})}A-=D.retrieve("leftBar").getBorderBoxSize().height;D.retrieve("leftBar").style.top=A+"px"}else{break}}C.domObj.resize({top:L,height:K,bottom:null});this.fireEvent("panelMaximize",C)},createText:function(A){this.parent()}});Jx.Dialog.Message=new Class({Family:"Jx.Dialog.Message",Extends:Jx.Dialog,Binds:["onOk"],options:{message:"",width:300,height:150,close:true,resize:true,collapse:false,useKeyboard:true,keys:{enter:"ok"}},render:function(){this.buttons=new Jx.Toolbar({position:"bottom",scroll:false});this.ok=new Jx.Button({label:MooTools.lang.get("Jx","message").okButton,onClick:this.onOk});this.buttons.add(this.ok);this.options.toolbars=[this.buttons];var B=Jx.type(this.options.message);if(B==="string"||B=="object"||B=="element"){this.question=new Element("div",{"class":"jxMessage"});switch(B){case"string":case"object":this.question.set("html",this.getText(this.options.message));break;case"element":this.options.message.inject(this.question);break}}else{this.question=this.options.question;document.id(this.question).addClass("jxMessage")}this.options.content=this.question;if(this.options.useKeyboard){var A=this;this.options.keyboardMethods.ok=function(C){C.preventDefault();A.close()}}this.parent();if(this.options.useKeyboard){this.keyboard.addEvents(this.getKeyboardEvents())}},onOk:function(){this.close()},setMessage:function(A){this.options.message=A;if($defined(this.question)){this.question.set("html",this.getText(A))}},changeText:function(A){this.parent();if($defined(this.ok)){this.ok.setLabel(MooTools.lang.get("Jx","message").okButton)}if(Jx.type(this.options.message)==="object"){this.question.set("html",this.getText(this.options.message))}}});Jx.Dialog.Confirm=new Class({Extends:Jx.Dialog,options:{question:"",useKeyboard:true,keys:{esc:"cancel",enter:"ok"},width:300,height:150,close:false,resize:true,collapse:false},keyboard:null,render:function(){this.buttons=new Jx.Toolbar({position:"bottom",scroll:false});this.ok=new Jx.Button({label:MooTools.lang.get("Jx","confirm").affirmitiveLabel,onClick:this.onClick.bind(this,true)}),this.cancel=new Jx.Button({label:MooTools.lang.get("Jx","confirm").negativeLabel,onClick:this.onClick.bind(this,false)});this.buttons.add(this.ok,this.cancel);this.options.toolbars=[this.buttons];var B=Jx.type(this.options.question);if(B==="string"||B==="object"||B=="element"){this.question=new Element("div",{"class":"jxConfirmQuestion"});switch(B){case"string":case"object":this.question.set("html",this.getText(this.options.question));break;case"element":this.options.question.inject(this.question);break}}else{this.question=this.options.question;document.id(this.question).addClass("jxConfirmQuestion")}this.options.content=this.question;if(this.options.useKeyboard){var A=this;this.options.keyboardMethods.ok=function(C){C.preventDefault();A.onClick(true)};this.options.keyboardMethods.cancel=function(C){C.preventDefault();A.onClick(false)}}this.parent();if(this.options.useKeyboard){this.keyboard.addEvents(this.getKeyboardEvents())}},onClick:function(A){this.isOpening=false;this.hide();this.fireEvent("close",[this,A])},changeText:function(A){this.parent();if($defined(this.ok)){this.ok.setLabel(MooTools.lang.get("Jx","confirm").affirmitiveLabel)}if($defined(this.cancel)){this.cancel.setLabel(MooTools.lang.get("Jx","confirm").negativeLabel)}if(Jx.type(this.options.question)==="object"){this.question.set("html",this.getText(this.options.question))}}});Jx.Tooltip=new Class({Family:"Jx.Widget",Extends:Jx.Widget,Binds:["enter","leave","move"],options:{offsets:{x:15,y:15},showDelay:100,cssClass:null},parameters:["target","tip","options"],render:function(){this.parent();this.target=document.id(this.options.target);var A=this.target.retrieve("Tip");if(A){this.target.eliminate("Tip")}this.domObj=new Element("div",{styles:{position:"absolute",top:0,left:0,visibility:"hidden"}}).inject(document.body);if(Jx.type(this.options.tip)==="string"||Jx.type(this.options.tip)=="object"){this.domObj.set("html",this.getText(this.options.tip))}else{this.domObj.grab(this.options.tip)}this.domObj.addClass("jxTooltip");if($defined(this.options.cssClass)){this.domObj.addClass(this.options.cssClass)}this.options.target.store("Tip",this);this.options.target.addEvent("mouseenter",this.enter);this.options.target.addEvent("mouseleave",this.leave);this.options.target.addEvent("mousemove",this.move)},enter:function(A){this.timer=$clear(this.timer);this.timer=(function(){this.domObj.setStyle("visibility","visible");this.position(A)}).delay(this.options.delay,this)},leave:function(A){this.timer=$clear(this.timer);this.timer=(function(){this.domObj.setStyle("visibility","hidden")}).delay(this.options.delay,this)},move:function(A){this.position(A)},position:function(C){var B=window.getSize(),A=window.getScroll();var E=this.domObj.getMarginBoxSize();var D={x:this.domObj.offsetWidth,y:this.domObj.offsetHeight};var F={x:C.page.x+this.options.offsets.x,y:C.page.y+this.options.offsets.y};if(C.page.y+this.options.offsets.y+D.y+E.height-A.y>B.y){F.y=C.page.y-this.options.offsets.y-E.height-A.y}if(C.page.x+this.options.offsets.x+D.x+E.width-A.x>B.x){F.x=C.page.x-this.options.offsets.x-E.width-A.x}this.domObj.setStyle("top",F.y);this.domObj.setStyle("left",F.x)},detach:function(){this.target.eliminate("Tip");this.destroy()}});Jx.Fieldset=new Class({Family:"Jx.Fieldset",Extends:Jx.Widget,options:{legend:null,id:null,fieldsetClass:null,legendClass:null,template:'<fieldset class="jxFieldset"><legend><span class="jxFieldsetLegend"></span></legend></fieldset>',form:null},classes:new Hash({domObj:"jxFieldset",legend:"jxFieldsetLegend"}),legend:null,render:function(){this.parent();this.id=this.options.id;if($defined(this.options.form)&&this.options.form instanceof Jx.Form){this.form=this.options.form}if(this.domObj){if($defined(this.options.id)){this.domObj.set("id",this.options.id)}if($defined(this.options.fieldsetClass)){this.domObj.addClass(this.options.fieldsetClass)}}if(this.legend){if($defined(this.options.legend)){this.legend.set("html",this.getText(this.options.legend));if($defined(this.options.legendClass)){this.legend.addClass(this.options.legendClass)}}else{this.legend.destroy()}}},add:function(){var B;for(var A=0;A<arguments.length;A++){B=arguments[A];if($defined(B.jxFamily)&&!$defined(B.form)&&$defined(this.form)){B.form=this.form;this.form.addField(B)}this.domObj.grab(B)}return this},addTo:function(A){if(A instanceof Jx.Form){this.form=A}else{if(A instanceof Jx.Fieldset){this.form=A.form}}return this.parent(A)}});Jx.Form=new Class({Family:"Jx.Form",Extends:Jx.Widget,options:{method:"post",action:"",fileUpload:false,formClass:null,name:"",acceptCharset:"utf-8",template:'<form class="jxForm"></form>'},defaultAction:null,fields:null,pluginNamespace:"Form",classes:$H({domObj:"jxForm"}),init:function(){this.parent();this.fields=new Hash()},render:function(){this.parent();this.domObj.set({method:this.options.method,action:this.options.action,name:this.options.name,"accept-charset":this.options.acceptCharset,events:{keypress:function(A){if(A.key=="enter"&&A.target.tagName!="TEXTAREA"&&this.defaultAction&&this.defaultAction.click){document.id(this.defaultAction).focus();this.defaultAction.click();A.stop()}}.bind(this)}});if(this.options.fileUpload){this.domObj.set("enctype","multipart/form-data")}if($defined(this.options.formClass)){this.domObj.addClass(this.options.formClass)}},addField:function(A){this.fields.set(A.id,A);if(A.options.defaultAction){this.defaultAction=A}},isValid:function(A){return true},getValues:function(A){var B=this.domObj.toQueryString();if($defined(A)&&A){return B}else{return B.parseQueryString()}},setValues:function(A){if(Jx.type(A)==="object"){A=new Hash(A)}this.fields.each(function(B){B.setValue(A.get(B.name))},this)},add:function(){var B;for(var A=0;A<arguments.length;A++){B=arguments[A];if(B instanceof Jx.Field&&!$defined(B.form)){B.form=this;this.addField(B)}else{if(B instanceof Jx.Fieldset&&!$defined(B.form)){B.form=this}}this.domObj.grab(B)}return this},reset:function(){this.fields.each(function(B,A){B.reset()},this);this.fireEvent("reset",this)},getFieldsByName:function(B){var A=[];this.fields.each(function(C,D){if(C.name===B){A.push(C)}},this);return A},getField:function(A){if(this.fields.has(A)){return this.fields.get(A)}return null},setBusy:function(A){if(this.busy==A){return }this.parent(A);this.fields.each(function(B){B.setBusy(A,true)})}});Jx.Field=new Class({Family:"Jx.Field",Extends:Jx.Widget,pluginNamespace:"Field",Binds:["changeText"],options:{id:null,name:null,label:null,labelSeparator:":",value:null,tag:null,tip:null,template:null,containerClass:null,labelClass:null,fieldClass:null,tagClass:null,required:false,readonly:false,disabled:false,defaultAction:false},overtextOptions:{element:"label"},field:null,label:null,tag:null,id:null,overText:null,type:"field",classes:new Hash({domObj:"jxInputContainer",label:"jxInputLabel",tag:"jxInputTag"}),render:function(){this.classes.set("field","jxInput"+this.type);var A=$defined(this.options.name)?this.options.name:"";this.options.template=this.options.template.substitute({name:A});this.parent();this.id=($defined(this.options.id))?this.options.id:this.generateId();this.name=this.options.name;if($defined(this.type)){this.domObj.addClass("jxInputContainer"+this.type)}if($defined(this.options.containerClass)){this.domObj.addClass(this.options.containerClass)}if($defined(this.options.required)&&this.options.required){this.domObj.addClass("jxFieldRequired");if($defined(this.options.validatorClasses)){this.options.validatorClasses="required "+this.options.validatorClasses}else{this.options.validatorClasses="required"}}if(this.label){if($defined(this.options.labelClass)){this.label.addClass(this.options.labelClass)}if($defined(this.options.label)){this.label.set("html",this.getText(this.options.label)+this.options.labelSeparator)}this.label.set("for",this.id);if(this.options.required){this.requiredText=new Element("em",{html:this.getText({set:"Jx",key:"field",value:"requiredText"}),"class":"required"});this.requiredText.inject(this.label)}}if(this.field){if($defined(this.options.fieldClass)){this.field.addClass(this.options.fieldClass)}if($defined(this.options.value)){this.field.set("value",this.options.value)}this.field.set("id",this.id);if($defined(this.options.readonly)&&this.options.readonly){this.field.set("readonly","readonly");this.field.addClass("jxFieldReadonly")}if($defined(this.options.disabled)&&this.options.disabled){this.field.set("disabled","disabled");this.field.addClass("jxFieldDisabled")}this.field.addEvents({focus:this.onFocus.bind(this),blur:this.onBlur.bind(this),change:this.onChange.bind(this)});this.field.store("field",this);if(this.label){this.label.addEvent("click",this.field.focus.bind(this.field))}}if(this.tag){if($defined(this.options.tagClass)){this.tag.addClass(this.options.tagClass)}if($defined(this.options.tag)){this.tag.set("html",this.options.tag)}}if($defined(this.options.form)&&this.options.form instanceof Jx.Form){this.form=this.options.form;this.form.addField(this)}},setValue:function(A){if(!this.options.readonly){this.field.set("value",A)}},getValue:function(){return this.field.get("value")},reset:function(){this.field.set("value",this.options.value);this.fireEvent("reset",this)},disable:function(){this.field.set("disabled","disabled");this.field.addClass("jxFieldDisabled")},enable:function(){this.field.erase("disabled");this.field.removeClass("jxFieldDisabled")},addTo:function(A){if(A instanceof Jx.Fieldset||A instanceof Jx.Form){A.add(this)}else{this.parent(A)}return this},changeText:function(A){this.parent();if($defined(this.options.label)){this.label.set("html",this.getText(this.options.label)+this.options.labelSeparator)}if(this.options.required){this.requiredText=new Element("em",{html:this.getText({set:"Jx",key:"field",value:"requiredText"}),"class":"required"});this.requiredText.inject(this.label)}if($defined(this.requiredText)){this.requiredText.set("html",MooTools.lang.get("Jx","field").requiredText)}},onFocus:function(){this.fireEvent("focus",this)},onBlur:function(){this.fireEvent("blur",this)},onChange:function(){this.fireEvent("change",this)},setBusy:function(B,A){if(!A){this.parent(B)}this.field.set("readonly",B||this.options.readonly)}});Jx.Field.Text=new Class({Extends:Jx.Field,options:{overText:null,template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><input class="jxInputText" type="text" name="{name}"/><span class="jxInputTag"></span></span>'},type:"Text",render:function(){this.parent();if($defined(this.options.overText)){var A=$extend({},this.options.overText);this.field.set("alt",this.options.tip);this.overText=new OverText(this.field,A);this.overText.show()}}});Jx.Dialog.Prompt=new Class({Extends:Jx.Dialog,options:{prompt:"",startingValue:"",fieldOptions:{type:"Text",options:{},validate:true,validatorOptions:{validators:["required"],validateOnBlur:true,validateOnChange:false},showErrorMsg:true},width:400,height:200,close:true,resize:true,collapse:false,useKeyboard:true,keys:{esc:"cancel",enter:"ok"}},render:function(){this.buttons=new Jx.Toolbar({position:"bottom",scroll:false});this.ok=new Jx.Button({label:MooTools.lang.get("Jx","prompt").okButton,onClick:this.onClick.bind(this,true)});this.cancel=new Jx.Button({label:MooTools.lang.get("Jx","prompt").cancelButton,onClick:this.onClick.bind(this,false)});this.buttons.add(this.ok,this.cancel);this.options.toolbars=[this.buttons];var B=this.options.fieldOptions;B.options.label=this.getText(this.options.prompt);B.options.value=this.options.startingValue;B.options.containerClass="jxPrompt";if(Jx.type(B.type)==="string"&&$defined(Jx.Field[B.type.capitalize()])){this.field=new Jx.Field[B.type.capitalize()](B.options)}else{if(Jx.type(B.type)==="Jx.Object"){this.field=B.type}else{window.console?console.warn("Field type does not exist %o, using Jx.Field.Text",B.type):false;this.field=new Jx.Field.Text(B.options)}}if(this.options.fieldOptions.validate){this.validator=new Jx.Plugin.Field.Validator(this.options.fieldOptions.validatorOptions);this.validator.attach(this.field)}this.options.content=document.id(this.field);if(this.options.useKeyboard){var A=this;this.options.keyboardMethods.ok=function(C){C.preventDefault();A.onClick(true)};this.options.keyboardMethods.cancel=function(C){C.preventDefault();A.onClick(false)}}this.parent();if(this.options.useKeyboard){this.keyboard.addEvents(this.getKeyboardEvents())}},onClick:function(A){if(A&&$defined(this.validator)){if(this.validator.isValid()){this.isOpening=false;this.hide();this.fireEvent("close",[this,A,this.field.getValue()])}else{this.field.field.focus.delay(50,this.field.field)}}else{this.isOpening=false;this.hide();this.fireEvent("close",[this,A,this.field.getValue()])}},changeText:function(A){this.parent();if($defined(this.ok)){this.ok.setLabel(MooTools.lang.get("Jx","prompt").okButton)}if($defined(this.cancel)){this.cancel.setLabel(MooTools.lang.get("Jx","prompt").cancelButton)}this.field.label.set("html",this.getText(this.options.prompt))}});Jx.Panel.DataView=new Class({Extends:Jx.Panel,options:{data:null,sortColumns:null,itemTemplate:null,emptyTemplate:null,containerClass:null,itemClass:null,listOptions:{select:true,hover:true}},bound:{},init:function(){this.domA=new Element("div");this.list=this.createList(this.domA,this.options.listOptions);this.parent()},render:function(){if(!$defined(this.options.data)){return }this.options.content=this.domA;this.parent();this.domA.addClass(this.options.containerClass);this.itemCols=this.parseTemplate(this.options.itemTemplate);this.bound.update=this.update.bind(this);this.options.data.addEvent("loadFinished",this.bound.update);this.options.data.addEvent("sortFinished",this.bound.update);this.options.data.addEvent("loadError",this.bound.update);if(this.options.data.loaded){this.update()}},draw:function(){var D=this.options.data.count();if($defined(D)&&D>0){for(var A=0;A<D;A++){this.options.data.moveTo(A);var B=this.createItem();this.list.add(B)}}else{var C=new Element("div",{html:this.options.emptyTemplate});this.list.add(B)}this.fireEvent("renderDone",this)},createItem:function(){var A={};this.itemCols.each(function(D){A[D]=this.options.data.get(D)},this);var C=this.options.itemTemplate.substitute(A);var B=new Element("div",{"class":this.options.itemClass,html:C});return B},update:function(){if(!this.updating){this.updating=true;this.list.empty();this.options.data.sort(this.options.sortColumns);this.draw();this.updating=false}},parseTemplate:function(C){var B=this.options.data.getColumns();var A=[];B.each(function(D){var E="{"+D.name+"}";if(C.contains(E)){A.push(D.name)}},this);return A},enterItem:function(A,B){this.fireEvent("mouseenter",A,B)},leaveItem:function(A,B){this.fireEvent("mouseleave",A,B)},selectItem:function(A,B){this.fireEvent("select",A,B)},unselectItem:function(A,B){this.fireEvent("unselect",A,B)},addItem:function(A,B){this.fireEvent("add",A,B)},removeItem:function(A,B){this.fireEvent("remove",A,B)},createList:function(A,B){return new Jx.List(A,$extend({onMouseenter:this.enterItem.bind(this),onMouseleave:this.leaveItem.bind(this),onSelect:this.selectItem.bind(this),onAdd:this.addItem.bind(this),onRemove:this.removeItem.bind(this),onUnselect:this.unselectItem.bind(this)},B))}});Jx.Panel.DataView.Group=new Class({Extends:Jx.Panel.DataView,options:{groupTemplate:null,groupContainerClass:null,groupHeaderClass:null,listOptions:{select:false,hover:false},itemOptions:{select:true,hover:true,hoverClass:"jxItemHover",selectClass:"jxItemSelect"}},init:function(){this.groupCols=this.parseTemplate(this.options.groupTemplate);this.itemManager=new Jx.Selection({eventToFire:{select:"itemselect",unselect:"itemunselect"},selectClass:"jxItemSelected"});this.groupManager=new Jx.Selection({eventToFire:{select:"groupselect",unselect:"groupunselect"},selectClass:"jxGroupSelected"});this.parent()},render:function(){this.list=this.createList(this.domA,this.listOptions,this.groupManager);this.parent()},draw:function(){var J=this.options.data;var B=J.count();if($defined(B)&&B>0){var M="";var I=null;for(var E=0;E<B;E++){J.moveTo(E);var K=J.get(this.options.sortColumns[0]);if(K!==M){var A=new Element("div",{"class":this.options.groupContainerClass});var C=this.createList(A,{select:false,hover:false});this.list.add(C.container);M=K;var D={};this.groupCols.each(function(O){D[O]=J.get(O)},this);var L=this.options.groupTemplate.substitute(D);var H=new Element("div",{"class":this.options.groupHeaderClass,html:L,id:"group-"+K.replace(" ","-","g")});C.add(H);var G=new Element("div",{"class":this.options.containerClass});I=this.createList(G,this.options.itemOptions,this.itemManager);C.add(I.container)}var N=this.createItem();I.add(N)}}else{var F=new Element("div",{html:this.options.emptyTemplate});this.list.add(F)}this.fireEvent("renderDone",this)},createList:function(A,B,C){return new Jx.List(A,$extend({onMouseenter:this.enterItem.bind(this),onMouseleave:this.leaveItem.bind(this),onAdd:this.addItem.bind(this),onRemove:this.removeItem.bind(this)},B),C)}});Jx.Field.Hidden=new Class({Extends:Jx.Field,options:{template:'<span class="jxInputContainer"><input class="jxInputHidden" type="hidden" name="{name}"/></span>'},type:"Hidden"});Jx.Field.File=new Class({Extends:Jx.Field,options:{template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><div class="jxFileInputs"><input class="jxInputFile" type="file" name="{name}" /></div><span class="jxInputTag"></span></span>',autoUpload:false,progress:false,progressIDUrl:"",progressName:"APC_UPLOAD_PROGRESS",progressId:"progress_key",handlerUrl:"",progressUrl:"",debug:false,mode:"single",onUploadBegin:$empty,onUploadComplete:$empty,onUploadProgress:$empty,onUploadError:$empty,onFileSelected:$empty},type:"File",forms:null,init:function(){this.parent();this.forms=new Hash();this.setupIframe=true;this.iframe=new IFrame(null,{styles:{visibility:"hidden"},name:this.generateId()});this.iframe.inject(document.body);this.iframe.addEvent("load",this.processIFrameUpload.bind(this))},render:function(){this.parent();if(!$defined(this.options.id)){this.field.set("id",this.generateId())}this.fake=new Element("div",{"class":"jxFileFake"});this.text=new Jx.Field.Text({template:'<span class="jxInputContainer"><input class="jxInputText" type="text" /></span>'});this.browseButton=new Jx.Button({label:MooTools.lang.get("Jx","file").browseLabel});this.fake.adopt(this.text,this.browseButton);this.field.grab(this.fake,"after");this.field.addEvents({change:this.copyValue.bind(this),mouseenter:this.mouseEnter.bind(this),mouseleave:this.mouseLeave.bind(this)})},copyValue:function(){if(this.options.mode=="single"&&this.field.value!==""&&(this.text.field.value!==this.field.value)){this.text.field.value=this.field.value;this.fireEvent("fileSelected",this);if(this.options.autoUpload){this.uploadSingle()}}else{if(this.options.mode=="multiple"){var A=this.field.value;var B=this.prepForm();this.forms.set(A,B);this.text.setValue("");this.fireEvent("fileSelected",A)}}},mouseEnter:function(){this.browseButton.domA.addClass("jxButtonPressed")},mouseLeave:function(){this.browseButton.domA.removeClass("jxButtonPressed")},prepForm:function(){var C=new Jx.Form({action:this.options.handlerUrl,name:"jxUploadForm",fileUpload:true});var B=document.id(this.field.getParent());var A=document.id(this.field).getPrevious();var D=this.field.clone().cloneEvents(this.field);document.id(C).grab(this.field);if(A){D.inject(A,"after")}else{if(B){D.inject(B,"top")}}this.field=D;this.mouseLeave();return C},upload:function(){if(this.forms.getLength()>0){var B=this.forms.getKeys();this.currentKey=B[0];var A=this.forms.get(this.currentKey);this.forms.erase(this.currentKey);this.uploadSingle(A)}else{this.fireEvent("allUploadsComplete",this)}},uploadSingle:function(B){this.form=$defined(B)?B:this.prepForm();this.fireEvent("fileUploadBegin",[this.currentKey,this]);this.text.setValue("");document.id(this.form).set("target",this.iframe.get("name")).setStyles({visibility:"hidden",display:"none"}).inject(document.body);if(this.options.progress){var A=new Request.JSON({url:this.options.progressIDUrl,method:"get",onSuccess:this.submitUpload.bind(this)});A.send()}else{this.submitUpload()}},submitUpload:function(A){if($defined(A)&&A.success&&$defined(A.id)){this.progressID=A.id;var B=new Jx.Field.Hidden({name:this.options.progressName,id:this.options.progressId,value:this.progressID});B.addTo(this.form,"top")}document.id(this.form).submit();if(this.options.progress&&$defined(this.progressID)){this.pollUpload()}},pollUpload:function(){var B={id:this.progressID};var A=new Request.JSON({data:B,url:this.options.progressUrl,method:"get",onSuccess:this.processProgress.bind(this),onFailure:this.uploadFailure.bind(this)});A.send()},processProgress:function(A){if($defined(A)){this.fireEvent("fileUploadProgress",[A,this.currentKey,this]);if(A.current<A.total){this.polling=true;this.pollUpload()}else{this.polling=false}}},uploadFailure:function(A){this.fireEvent("fileUploadProgressError",[this,A])},processIFrameUpload:function(){if(!this.setupIframe){var A=this.iframe.contentDocument.defaultView.document.body.innerHTML;var B=JSON.decode(A);if($defined(B.success)&&B.success){this.done=true;this.doneData=B;this.uploadCleanUp();this.fireEvent("fileUploadComplete",[B,this.currentKey,this])}else{this.fireEvent("fileUploadError",[B,this.currentKey,this])}if(this.options.mode=="multiple"){this.upload()}else{this.fireEvent("allUploadsComplete",this)}}else{this.setupIframe=false}},uploadCleanUp:function(){if(!this.options.debug){this.form.destroy();if(this.options.mode=="single"){this.iframe.destroy()}}},remove:function(A){if(this.forms.has(A)){this.forms.erase(A)}},changeText:function(A){this.parent();if($defined(this.browseButton)){this.browseButton.setLabel(MooTools.lang.get("Jx","file").browseLabel)}}});Jx.Progressbar=new Class({Family:"Jx.Progressbar",Extends:Jx.Widget,options:{onUpdate:$empty,onComplete:$empty,parent:null,template:'<div class="jxProgressBar-container"><div class="jxProgressBar-message"></div><div class="jxProgressBar"><div class="jxProgressBar-outline"></div><div class="jxProgressBar-fill"></div><div class="jxProgressBar-text"></div></div></div>'},classes:new Hash({domObj:"jxProgressBar-container",message:"jxProgressBar-message",container:"jxProgressBar",outline:"jxProgressBar-outline",fill:"jxProgressBar-fill",text:"jxProgressBar-text"}),bar:null,text:null,render:function(){this.parent();if($defined(this.options.parent)){this.domObj.inject(document.id(this.options.parent))}this.domObj.addClass("jxProgressStarting");this.width=document.id(this.domObj).getContentBoxSize().width;if(this.message){if($defined(MooTools.lang.get("Jx","progressbar").messageText)){this.message.set("html",MooTools.lang.get("Jx","progressbar").messageText)}else{this.message.destroy()}}if(this.fill){this.fill.setStyles({width:0})}var B={};var A;if(!$defined(this.options.progressText)){A=MooTools.lang.get("Jx","progressbar").progressText}else{A=this.options.progressText}if(A.contains("{progress}")){B.progress=0}if(A.contains("{total}")){B.total=0}if(this.text){this.text.set("html",A.substitute(B))}},update:function(C,A){if(this.domObj.hasClass("jxProgressStarting")){this.domObj.removeClass("jxProgressStarting").addClass("jxProgressWorking")}var B=(A*this.width)/C;this.text.get("tween",{property:"width",onComplete:function(){var F={};var E;if(!$defined(this.options.progressText)){E=MooTools.lang.get("Jx","progressbar").progressText}else{E=this.options.progressText}if(E.contains("{progress}")){F.progress=A}if(E.contains("{total}")){F.total=C}var D=E.substitute(F);this.text.set("text",D)}.bind(this)}).start(B);this.fill.get("tween",{property:"width",onComplete:(function(){if(C===A){this.complete=true;this.domObj.removeClass("jxProgressWorking").addClass("jxProgressFinished");this.fireEvent("complete")}else{this.fireEvent("update")}}).bind(this)}).start(B)},changeText:function(A){this.parent();if(this.message){this.message.set("html",MooTools.lang.get("Jx","progressbar").messageText)}}});Jx.Panel.FileUpload=new Class({Family:"Jx.Panel.FileUpload",Extends:Jx.Panel,Binds:["moveToQueue","fileUploadBegin","fileUploadComplete","allUploadsComplete","fileUploadProgressError,","fileUploadError","fileUploadProgress"],options:{file:{autoUpload:false,progress:false,progressIDUrl:"",handlerUrl:"",progressUrl:""},progressOptions:{template:"<li class='jxListItemContainer jxProgressBar-container' id='{id}'><div class='jxProgressBar'><div class='jxProgressBar-outline'></div><div class='jxProgressBar-fill'></div><div class='jxProgressBar-text'></div></div></li>",containerClass:"progress-container",messageText:null,messageClass:"progress-message",progressText:"Uploading {filename}",progressClass:"progress-bar"},onFileComplete:$empty,onComplete:$empty,prompt:null,removeOnComplete:false},domObjA:null,fileQueue:[],listTemplate:"<li class='jxListItemContainer' id='{id}'><a class='jxListItem' href='javascript:void(0);'><span class='itemLabel jxUploadFileName'>{name}</span><span class='jxUploadFileDelete' title='Remove this file from the queue.'></span></a></li>",render:function(){this.domObjA=new Element("div",{"class":"jxFileUploadPanel"});if($defined(this.options.prompt)){var B;if(Jx.type(this.options.prompt==="string")){B=new Element("p",{html:this.options.prompt})}else{B=this.options.prompt}B.inject(this.domObjA)}this.fileOpt=this.options.file;this.fileOpt.template='<div class="jxInputContainer jxFileInputs"><input class="jxInputFile" type="file" name={name} /></div>';this.file=new Jx.Field.File(this.fileOpt);this.file.addEvent("fileSelected",this.moveToQueue);this.file.addTo(this.domObjA);this.listView=new Jx.ListView({template:'<ul class="jxListView jxList jxUploadQueue"></ul>'}).addTo(this.domObjA);this.uploadBtn=new Jx.Button({label:MooTools.lang.get("Jx","upload").buttonText,onClick:this.upload.bind(this)});var A=new Jx.Toolbar({position:"bottom",scroll:false}).add(this.uploadBtn);this.uploadBtn.setEnabled(false);this.options.toolbars=[A];this.options.content=this.domObjA;this.parent(this.options)},moveToQueue:function(B){var A=new String(this.listTemplate).substitute({name:B,id:B});var C=new Jx.ListItem({template:A,enabled:true});$(C).getElement(".jxUploadFileDelete").addEvent("click",function(){this.listView.remove(C);this.file.remove(B);if(this.listView.list.count()==0){this.uploadBtn.setEnabled(false)}}.bind(this));this.listView.add(C);if(!this.uploadBtn.isEnabled()){this.uploadBtn.setEnabled(true)}},upload:function(){this.file.addEvents({fileUploadBegin:this.fileUploadBegin,fileUploadComplete:this.fileUploadComplete,allUploadsComplete:this.allUploadsComplete,fileUploadError:this.fileUploadError,fileUploadProgress:this.fileUploadProgress,fileUploadProgressError:this.fileUploadError});this.file.upload()},fileUploadBegin:function(A){if(this.options.file.progress){var B=$merge({},this.options.progressOptions);B.progressText=B.progressText.substitute({filename:A});B.template=B.template.substitute({id:A});this.pb=new Jx.Progressbar(B);var D=document.id(A);this.oldContents=D;this.listView.replace(D,$(this.pb))}else{var C=document.id(A).getElement(".jxUploadFileDelete");C.addClass("jxUploadFileProgress").set("title","File Uploading...")}},fileUploadComplete:function(B,A){if($defined(B.success)&&B.success){this.removeUploadedFile(A)}else{this.fileUploadError(B,A)}},fileUploadError:function(D,A){if(this.options.file.progress){this.listView.replace(document.id(A),this.oldContents)}var C=document.id(A).getElement(".jxUploadFileDelete");C.erase("title");if(C.hasClass("jxUploadFileProgress")){C.removeClass("jxUploadFileProgress").addClass("jxUploadFileError")}else{C.addClass("jxUploadFileError")}if($defined(D.error)&&$defined(D.error.message)){var B=new Jx.Tooltip(C,D.error.message,{cssClass:"jxUploadFileErrorTip"})}},removeUploadedFile:function(B){if(this.options.removeOnComplete){this.listView.remove(document.id(B))}else{if(this.options.file.progress){this.listView.replace(document.id(B),this.oldContents)}var A=document.id(B).getElement(".jxUploadFileDelete");if(A.hasClass("jxUploadFileDelete")){A.addClass("jxUploadFileComplete")}else{if(A.hasClass("jxUploadFileProgress")){A.removeClass("jxUploadFileProgress").addClass("jxUploadFileComplete")}}}this.fireEvent("fileUploadComplete",B)},fileUploadProgress:function(B,A){if(this.options.progress){this.pb.update(B.total,B.current)}},allUploadsComplete:function(){this.uploadBtn.setEnabled(false);this.fireEvent("allUploadsCompleted",this)},createText:function(A){this.parent();if($defined(this.uploadBtn)){this.uploadBtn.setLabel(MooTools.lang.get("Jx","upload").buttonText)}}});Jx.ListItem=new Class({Family:"Jx.ListItem",Extends:Jx.Widget,options:{enabled:true,template:'<li class="jxListItemContainer jxListItem"></li>'},classes:new Hash({domObj:"jxListItemContainer",domContent:"jxListItem"}),render:function(){this.parent();this.domContent.store("jxListItem",this);this.domObj.store("jxListTarget",this.domContent);this.loadContent(this.domContent)},enable:function(A){}});Jx.ListView=new Class({Family:"Jx.Widget",Extends:Jx.Widget,options:{template:'<ul class="jxListView jxList"></ul>',listOptions:{hover:true,press:true,select:true}},classes:new Hash({domObj:"jxListView",listObj:"jxList"}),render:function(){this.parent();if(this.options.selection){this.selection=this.options.selection}else{if(this.options.select){this.selection=new Jx.Selection(this.options);this.ownsSelection=true}}this.list=new Jx.List(this.listObj,this.options.listOptions,this.selection)},cleanup:function(){if(this.ownsSelection){this.selection.destroy()}this.list.destroy()},add:function(B,A){this.list.add(B,A);return this},remove:function(A){this.list.remove(A);return this},replace:function(B,A){this.list.replace(B,A);return this}});Jx.Column=new Class({Family:"Jx.Column",Extends:Jx.Widget,options:{renderMode:"fit",width:null,isEditable:false,isSortable:false,isResizable:false,isHidden:false,name:"",template:null,renderer:null},classes:$H({domObj:"jxGridCellContent"}),model:null,parameters:["options","grid"],init:function(){this.name=this.options.name;if(!$defined(this.options.template)){this.options.template='<span class="jxGridCellContent">'+this.name.capitalize()+"</span>"}this.parent();if($defined(this.options.grid)&&this.options.grid instanceof Jx.Grid){this.grid=this.options.grid}if(!$defined(this.options.renderer)){this.options.renderer=new Jx.Grid.Renderer.Text({textTemplate:"{"+this.name+"}"})}else{if(!(this.options.renderer instanceof Jx.Grid.Renderer)){var A=Jx.type(this.options.renderer);if(A==="object"){this.options.renderer=new Jx.Grid.Renderer[this.options.renderer.name.capitalize()](this.options.renderer.options)}}}this.options.renderer.setColumn(this);this.sortImg=new Element("img",{src:Jx.aPixel.src})},getHeaderHTML:function(){if(this.isSortable()){this.sortImg.inject(this.domObj)}return this.domObj},setWidth:function(B,A){A=$defined(A)?A:false;var C=this.cellWidth-this.width;if(!A){this.width=parseInt(B,10);this.cellWidth=this.width+C;this.options.width=B}else{this.width=parseInt(B,10)-C;this.cellWidth=B;this.options.width=this.width}if(this.rule&&parseInt(this.width,10)>=0){this.rule.style.width=parseInt(this.width,10)+"px"}if(this.cellRule&&parseInt(this.cellWidth,10)>=0){this.cellRule.style.width=parseInt(this.cellWidth,10)+"px"}},getWidth:function(){return this.width},getCellWidth:function(){return this.cellWidth},calculateWidth:function(D){D=$defined(D)?D:false;var E;var H;var B=this.grid.getModel();B.first();if((this.options.renderMode=="fixed"||this.options.renderMode=="expand")&&B.valid){var G=new Element("span",{"class":"jxGridCellContent",html:"a",styles:{width:this.options.width}});var I=this.measure(G,"jxGridCell");E=I.content.width;H=I.cell.width}else{var A=B.getPosition();E=H=0;while(B.valid()){this.options.renderer.render();var F=document.id(this.options.renderer);var C="jxGridCell";if(this.grid.row.useHeaders()&&this.options.name===this.grid.row.getRowHeaderColumn()){C="jxGridRowHead"}var I=this.measure(F,C,D,B.getPosition());if(I.content.width>E){E=I.content.width}if(I.cell.width>H){H=I.cell.width}if(B.hasNext()){B.next()}else{break}}if(!(this.grid.row.useHeaders()&&this.options.name===this.grid.row.getRowHeaderColumn())){C="jxGridColHead";if(this.isEditable()){C+=" jxColEditable"}if(this.isResizable()){C+=" jxColResizable"}if(this.isSortable()){C+=" jxColSortable"}I=this.measure(this.domObj.clone(),C);if(I.content.width>E){E=I.content.width}if(I.cell.width>H){H=I.cell.width}}}this.width=E;this.cellWidth=H;B.moveTo(A);return this.width},measure:function(F,A,C,E){var D=new Element("span",{"class":A});F.inject(D);D.setStyles({visibility:"hidden",width:"auto"});D.inject(document.body,"bottom");var B=D.measure(function(){if(!C){return{content:this.getFirst().getContentBoxSize(),cell:this.getFirst().getMarginBoxSize()}}else{return{content:this.getMarginBoxSize(),cell:this.getMarginBoxSize()}}});D.destroy();return B},isEditable:function(){return this.options.isEditable},isSortable:function(){return this.options.isSortable},isResizable:function(){return this.options.isResizable},isHidden:function(){return this.options.isHidden},isAttached:function(){return this.options.renderer.attached},getHTML:function(){this.options.renderer.render();return document.id(this.options.renderer)}});Jx.Columns=new Class({Family:"Jx.Columns",Extends:Jx.Object,options:{headerRowHeight:20,useHeaders:false,columns:[]},columns:[],parameters:["options","grid"],hasExpandable:null,init:function(){this.parent();if($defined(this.options.grid)&&this.options.grid instanceof Jx.Grid){this.grid=this.options.grid}this.hasExpandable=false;this.options.columns.each(function(A){if(A instanceof Jx.Column){this.columns.push(A)}else{if(Jx.type(A)==="object"){this.columns.push(new Jx.Column(A,this.grid))}}var B=this.columns[this.columns.length-1];if(B.options.renderMode==="expand"){this.hasExpandable=true}},this)},getHeaderHeight:function(A){if(!$defined(this.height)||A){if($defined(this.options.headerRowHeight)&&this.options.headerRowHeight!=="auto"){this.height=this.options.headerRowHeight}}return this.height},useHeaders:function(){return this.options.useHeaders},getByName:function(B){var A;this.columns.each(function(C){if(C.name===B){A=C}},this);return A},getByField:function(B){var A;this.columns.each(function(C){if(C.options.modelField===B){A=C}},this);return A},getByGridIndex:function(B){var E=this.options.useHeaders?this.grid.colTableBody.getFirst().getChildren():this.grid.gridTableBody.getFirst().getChildren();var A=E[B];var C=A.get("class").split(" ").filter(function(F){if(this.options.useHeaders){return F.test("jxColHead-")}else{return F.test("jxCol-")}}.bind(this));var D=C[0].split("-");return this.getByName(D[1])},getHeaders:function(C){var B=this.grid.row.useHeaders();var A=this.grid.row.getRowHeaderColumn();this.columns.each(function(E,D){if(B&&A===E.options.name){}else{if(!E.isHidden()){var F=new Element("th",{"class":"jxGridColHead jxGridCol"+D});F.adopt(E.getHeaderHTML());F.addClass("jxColHead-"+E.name);if(E.isEditable()){F.addClass("jxColEditable")}if(E.isResizable()){F.addClass("jxColResizable")}if(E.isSortable()){F.addClass("jxColSortable")}C.add(F);F.store("jxCellData",{column:E,colHeader:true,index:D})}}},this);return C},getColumnCells:function(D){var B=this.grid.row;var C=B.getRowHeaderColumn();var A=B.useHeaders();this.columns.each(function(F,E){if(A&&F.name!==C&&!F.isHidden()){D.add(this.getColumnCell(F,E))}else{if(!A&&!F.isHidden()){D.add(this.getColumnCell(F,E))}}},this);if(!this.hasExpandable){D.add(new Element("td",{"class":"jxGridCellUnattached"}))}},getColumnCell:function(B,A){var C=new Element("td",{"class":"jxGridCell"});C.adopt(B.getHTML());C.addClass("jxCol-"+B.name);C.addClass("jxGridCol"+A);if(B.isEditable()){C.addClass("jxColEditable")}if(B.isResizable()){C.addClass("jxColResizable")}if(B.isSortable()){C.addClass("jxColSortable")}if(!B.isAttached()){C.addClass("jxGridCellUnattached")}C.store("jxCellData",{col:B,index:A,row:this.grid.model.getPosition()});return C},calculateWidths:function(){var E=null;var A=0;var C=0;this.columns.each(function(G,F){var H=false;if(G.name==this.grid.row.options.headerColumn){H=true}if(G.options.renderMode=="fixed"){G.calculateWidth()}else{if(G.options.renderMode=="fit"){G.calculateWidth(H)}else{if(G.options.renderMode=="expand"&&!$defined(E)){E=G}else{if($defined(G.options.width)){G.setWidth(G.options.width)}else{G.calculateWidth(H)}}}}if(!G.isHidden()&&!(G.name==this.grid.row.options.headerColumn)){A+=Jx.getNumber(G.getCellWidth());if(H){C=G.getWidth()}}},this);var B=this.grid.gridObj.getContentBoxSize();if(B.width>A){if($defined(E)){var D=B.width-A-2;if(D>=E.options.width){E.options.width=D;E.calculateWidth();E.setWidth(D,true);A+=D}else{E.setWidth(E.options.width)}}}this.grid.gridTable.setContentBoxSize({width:A-C});this.grid.colTable.setContentBoxSize({width:A-C})},createRules:function(B,A){this.columns.each(function(E,D){var C=A+" .jxGridCol"+D;var F="";if(E.options.renderMode==="fixed"||E.options.renderMode==="expand"){F="white-space: normal !important"}E.cellRule=Jx.Styles.insertCssRule(C,F,B);E.cellRule.style.width=E.getCellWidth()+"px";var C=A+" .jxGridCol"+D+" .jxGridCellContent";E.rule=Jx.Styles.insertCssRule(C,F,B);E.rule.style.width=E.getWidth()+"px"},this)},updateRule:function(B){var A=this.getByName(B);if(A.options.renderMode==="fit"){A.calculateWidth()}A.rule.style.width=A.getWidth()+"px";A.cellRule.style.width=A.getCellWidth()+"px"},getColumnCount:function(){return this.columns.length},getIndexFromGrid:function(B){var D=this.options.useHeaders?this.grid.colTableBody.getFirst().getChildren():this.grid.gridTableBody.getFirst().getChildren();var E;var C=-1;var A=this;D.each(function(F){C++;var G=F.get("class").split(" ").filter(function(H){if(A.options.useHeaders){return H.test("jxColHead-")}else{return H.test("jxCol-")}});G.each(function(H){if(H.test(B)){E=C}})},this);return E}});Jx.Row=new Class({Family:"Jx.Row",Extends:Jx.Object,options:{useHeaders:false,alternateRowColors:false,rowClasses:{odd:"jxGridRowOdd",even:"jxGridRowEven",all:"jxGridRowAll"},rowHeight:20,headerWidth:20,headerColumn:"id"},grid:null,heights:[],rules:$H(),parameters:["options","grid"],init:function(){this.parent();if($defined(this.options.grid)&&this.options.grid instanceof Jx.Grid){this.grid=this.options.grid}},getGridRowElement:function(B){var A=new Element("tr");if(this.options.alternateRowColors){A.className=(this.grid.getModel().getPosition()%2)?this.options.rowClasses.even:this.options.rowClasses.odd}else{A.className=this.options.rowClasses.all}A.store("jxRowData",{row:B});A.addClass("jxGridRow"+B);return A},getRowHeaderCell:function(){var B=this.grid.getModel();var D=new Element("th",{"class":"jxGridRowHead"});var A=this.grid.columns.getByName(this.options.headerColumn);var C=A.getHTML();C.inject(D);D.store("jxCellData",{row:B.getPosition(),rowHeader:true});return D},getRowHeaderWidth:function(){var A=this.grid.columns.getByName(this.options.headerColumn);if(!$defined(A.getWidth())){A.calculateWidth(true)}return A.getWidth()},getHeight:function(A){if((!$defined(this.options.rowHeight)||this.options.rowHeight==="auto")&&$defined(this.heights[A])){return this.heights[A]}else{if(Jx.type(this.options.rowHeight==="number")){return this.options.rowHeight}}},calculateHeights:function(){document.id(this.grid.gridTableBody).getChildren().each(function(C){C=document.id(C);var B=C.retrieve("jxRowData");var A=C.getContentBoxSize();this.heights[B.row]=A.height},this);document.id(this.grid.rowTableHead).getChildren().each(function(C){C=document.id(C);var B=C.retrieve("jxRowData");if(B){var A=C.getContentBoxSize();this.heights[B.row]=Math.max(this.heights[B.row],A.height);if(Browser.Engine.webkit){this.heights[B.row]-=1}}},this)},createRules:function(B,A){this.grid.gridTableBody.getChildren().each(function(G,D){var C=A+" .jxGridRow"+D;var E=Jx.Styles.insertCssRule(C,"",B);this.rules.set("jxGridRow"+D,E);E.style.height=this.heights[D]+"px";if(Browser.Engine.webkit){C+=" th";var F=Jx.Styles.insertCssRule(C,"",B);F.style.height=this.heights[D]+"px"}},this)},useHeaders:function(){return this.options.useHeaders},getRowHeader:function(B){var A=this.getRowHeaderCell();A.store("jxCellData",{rowHeader:true,row:this.grid.model.getPosition()});B.add(A)},getRowHeaderColumn:function(){return this.options.headerColumn}});Jx.Plugin=new Class({Family:"Jx.Plugin",Extends:Jx.Object,options:{},attach:function(A){A.registerPlugin(this)},detach:function(A){A.deregisterPlugin(this)},changeText:function(A){if(this.busy){this.setBusy(false);this.setBusy(true)}}});Jx.Plugin.Grid={};Jx.Grid=new Class({Family:"Jx.Grid",Extends:Jx.Widget,Binds:["modelChanged","render","addRow","removeRow","removeRows","onSelect","onUnselect","onMouseEnter","onMouseLeave"],options:{parent:null,columns:{columns:[]},row:null,plugins:[],model:null,deferRender:true},model:null,columns:null,row:null,styleSheet:"JxGridStyles",pluginNamespace:"Grid",selection:null,lists:[],init:function(){this.uniqueId=this.generateId("jxGrid_");var B;if($defined(this.options.model)&&this.options.model instanceof Jx.Store){this.model=this.options.model;this.model.addEvent("storeColumnChanged",this.modelChanged);this.model.addEvent("storeSortFinished",this.render);this.model.addEvent("storeRecordAdded",this.addRow);this.model.addEvent("storeRecordRemoved",this.removeRow);this.model.addEvent("storeMultipleRecordsRemoved",this.removeRows)}if($defined(this.options.columns)){if(this.options.columns instanceof Jx.Columns){this.columns=this.options.columns}else{if(Jx.type(this.options.columns)==="object"){B=this.options.columns;B.grid=this;this.columns=new Jx.Columns(B)}}}if($defined(this.options.row)){if(this.options.row instanceof Jx.Row){this.row=this.options.row}else{if(Jx.type(this.options.row)==="object"){B=this.options.row;B.grid=this;this.row=new Jx.Row(B)}}}else{this.row=new Jx.Row({grid:this})}this.domObj=new Element("div",{"class":this.uniqueId});var A=new Jx.Layout(this.domObj,{onSizeChange:this.resize.bind(this)});this.domObj.addEvent("mouseleave",function(){this.fireEvent("gridMouseLeave")}.bind(this));if(this.options.parent){this.addTo(this.options.parent)}this.rowColObj=new Element("div",{"class":"jxGridContainer"});this.colObj=new Element("div",{"class":"jxGridContainer"});this.colTable=new Element("table",{"class":"jxGridTable jxGridHeader"});this.colTableBody=new Element("thead");this.colTable.appendChild(this.colTableBody);this.colObj.appendChild(this.colTable);this.rowObj=new Element("div",{"class":"jxGridContainer jxGridHeader"});this.rowTable=new Element("table",{"class":"jxGridTable"});this.rowTableHead=new Element("thead");this.rowTable.appendChild(this.rowTableHead);this.rowObj.appendChild(this.rowTable);this.gridObj=new Element("div",{"class":"jxGridContainer",styles:{overflow:"auto"}});this.gridTable=new Element("table",{"class":"jxGridTable jxGridContent"});this.gridTableBody=new Element("tbody");this.gridTable.appendChild(this.gridTableBody);this.gridObj.appendChild(this.gridTable);var C=this;this.domObj.appendChild(this.rowColObj);this.domObj.appendChild(this.rowObj);this.domObj.appendChild(this.colObj);this.domObj.appendChild(this.gridObj);this.gridObj.addEvent("scroll",this.onScroll.bind(this));this.selection=new Jx.Selection();this.selection.addEvents({select:this.onSelect,unselect:this.onUnselect});this.parent();this.domObj.store("grid",this)},onScroll:function(){this.colObj.scrollLeft=this.gridObj.scrollLeft;this.rowObj.scrollTop=this.gridObj.scrollTop},resize:function(){if(!this.model){return }var C=this.columns.useHeaders()?this.columns.getHeaderHeight():1;var A=this.row.useHeaders()?this.row.getRowHeaderWidth():1;var B=this.domObj.getContentBoxSize();this.rowColObj.setStyles({width:A-1,height:C-1});this.rowObj.setStyles({top:C,left:0,width:A-1,height:B.height-C-1});this.colObj.setStyles({top:0,left:A,width:B.width-A-1,height:C-1});this.gridObj.setStyles({top:C,left:A,width:B.width-A-1,height:B.height-C-1})},resizeRowsCols:function(A){A=$defined(A)?A:"all";if(A==="all"||A==="columns"){Jx.Styles.removeStyleSheet(this.styleSheet+"Columns");Jx.Styles.enableStyleSheet(this.styleSheet+"Columns");this.columns.calculateWidths();this.columns.createRules(this.styleSheet+"Columns","."+this.uniqueId)}if(A==="all"||A==="rows"){Jx.Styles.removeStyleSheet(this.styleSheet+"Rows");Jx.Styles.enableStyleSheet(this.styleSheet+"Rows");this.row.calculateHeights();this.row.createRules(this.styleSheet+"Rows","."+this.uniqueId)}},setModel:function(A){this.model=A;if(this.model){this.render();this.domObj.resize()}else{this.destroyGrid()}},getModel:function(){return this.model},destroyGrid:function(){var A=this.colTableBody.cloneNode(false);this.colTable.replaceChild(A,this.colTableBody);this.colTableBody=A;A=this.rowTableHead.cloneNode(false);this.rowTable.replaceChild(A,this.rowTableHead);this.rowTableHead=A;A=this.gridTableBody.cloneNode(false);this.gridTable.replaceChild(A,this.gridTableBody);this.gridTableBody=A;document.id(this.rowColObj).empty();if(Jx.Styles.isStyleSheetDefined(this.styleSheet)){Jx.Styles.removeStyleSheet(this.styleSheet)}},render:function(){this.destroyGrid();this.fireEvent("beginCreateGrid",this);if(this.model&&this.model.loaded){var D=this.model;var B=this.columns.getColumnCount();var J=D.count();var A;if(this.columns.useHeaders()){this.colTableBody.setStyle("visibility","visible");var F=this.columns.getHeaderHeight();var E=new Element("tr",{styles:{height:F}});this.colTableBody.appendChild(E);var C=this.makeList(E);this.columns.getHeaders(C);A=new Element("th",{"class":"jxGridColHead",styles:{width:1000,height:F-1}}).inject(E)}else{this.colTableBody.setStyle("visibility","hidden")}this.model.first();while(this.model.valid()){H=this.row.getGridRowElement(this.model.getPosition());var G=this.makeList(H);this.gridTableBody.appendChild(H);this.columns.getColumnCells(G);if(this.model.hasNext()){this.model.next()}else{break}}if(this.row.useHeaders()){this.rowTableHead.setStyle("visibility","visible");this.model.first();while(this.model.valid()){var H=new Element("tr",{"class":"jxGridRow"+this.model.getPosition()});H.store("jxRowData",{row:this.model.getPosition()});var I=this.makeList(H);this.row.getRowHeader(I);this.rowTableHead.appendChild(H);if(this.model.hasNext()){this.model.next()}else{break}}H=new Element("tr").inject(this.rowTableHead);A=new Element("th",{"class":"jxGridRowHead",styles:{width:this.row.getRowHeaderWidth(),height:1000}}).inject(H)}else{this.rowTableHead.setStyle("visibility","hidden")}this.domObj.resize();this.resizeRowsCols();this.resize();this.fireEvent("doneCreateGrid",this)}else{this.model.load()}},modelChanged:function(G,D){var E=this.columns.getIndexFromGrid(D);var H=document.id(this.gridObj.childNodes[0].childNodes[0].childNodes[G].childNodes[E]);var C=this.model.getPosition();this.model.moveTo(G);var B=this.options.row.useHeaders?E+1:E;var A=this.columns.getColumnCell(this.columns.getByName(D),B);var F=H.getParent().retrieve("jxList");F.replace(H,A);this.columns.updateRule(D);this.model.moveTo(C)},addRow:function(C,B,A){if(this.model.loaded){if(A==="bottom"){this.model.last()}else{this.model.first();this.renumberGrid(0,1)}if(this.row.useHeaders()){var F=this.row.getHeight();var G=new Element("tr",{styles:{height:F}});var D=this.makeList(G);this.row.getRowHeader(D);if(A==="top"){G.inject(this.rowTableHead,A)}else{var E=this.rowTableHead.children[this.rowTableHead.children.length-1];G.inject(E,"before")}}G=this.row.getGridRowElement();G.store("jxRowData",{row:this.model.getPosition()});var H=this.makeList(G);this.columns.getColumnCells(H);G.inject(this.gridTableBody,A)}},renumberGrid:function(F,A){var B=this.gridTable.rows.length;for(var C=F;C<B;C++){var D=document.id(this.gridTable.rows[C]);var E=D.retrieve("jxRowData");E.row+=A;D.store("jxRowData",E);$A(D.children).each(function(G){var H=G.retrieve("jxCellData");H.row+=A;G.store("jxCellData",H)},this)}},removeRow:function(A,B){this.gridTable.deleteRow(B);this.rowTable.deleteRow(B);this.renumberGrid(B,-1)},removeRows:function(A,D,C){for(var B=D;B<=C;B++){this.removeRow(D)}},makeList:function(B){var A=new Jx.List(B,{hover:true,select:true},this.selection);var C=this;A.addEvents({mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave});this.lists.push(A);return A},onSelect:function(B,A){this.fireEvent("gridCellSelect",[B,A,this])},onUnselect:function(B,A){this.fireEvent("gridCellUnselect",[B,A,this])},onMouseEnter:function(A,B){this.fireEvent("gridCellEnter",[A,B,this])},onMouseLeave:function(A,B){this.fireEvent("gridCellLeave",[A,B,this])},changeText:function(A){this.parent();this.resize();this.resizeRowsCols()}});Jx.Grid.Renderer=new Class({Family:"Jx.Grid.Renderer",Extends:Jx.Widget,parameters:["options"],options:{deferRender:true,template:'<span class="jxGridCellContent"></span>'},attached:null,classes:$H({domObj:"jxGridCellContent"}),column:null,init:function(){this.parent();this.attached=false},render:function(){this.parent()},setColumn:function(A){if(A instanceof Jx.Column){this.column=A}}});Jx.Grid.Renderer.Text=new Class({Family:"Jx.Grid.Renderer.Text",Extends:Jx.Grid.Renderer,options:{formatter:null,textTemplate:null,css:null},store:null,columnsNeeded:null,init:function(){this.parent();if($defined(this.options.formatter)&&!(this.options.formatter instanceof Jx.Formatter)){var A=Jx.type(this.options.formatter);if(A==="object"){this.options.formatter=new Jx.Formatter[this.options.formatter.name](this.options.formatter.options)}}},setColumn:function(A){this.parent();this.store=A.grid.getModel();this.attached=true;if($defined(this.options.textTemplate)){this.columnsNeeded=this.store.parseTemplate(this.options.textTemplate)}},render:function(){this.parent();var A="";if($defined(this.options.textTemplate)){if(!$defined(this.columnsNeeded)||(Jx.type(this.columnsNeeded)==="array"&&this.columnsNeeded.length===0)){this.columnsNeeded=this.store.parseTemplate(this.options.textTemplate)}A=this.store.fillTemplate(null,this.options.textTemplate,this.columnsNeeded)}if($defined(this.options.formatter)){A=this.options.formatter.format(A)}this.domObj.set("html",A);if($defined(this.options.css)&&Jx.type(this.options.css)==="function"){this.domObj.addClass(this.options.css.run(A))}else{if($defined(this.options.css)&&Jx.type(this.options.css)==="string"){this.domObj.addClass(this.options.css)}}}});Jx.Grid.Renderer.Checkbox=new Class({Family:"Jx.Grid.Renderer.Checkbox",Extends:Jx.Grid.Renderer,Binds:["onBlur","onChange"],options:{useStore:false,field:null,updateStore:false,checkboxOptions:{template:'<input class="jxInputContainer jxInputCheck" type="checkbox" name="{name}"/>',name:""}},init:function(){this.parent()},render:function(){this.parent();var A=new Jx.Field.Checkbox(this.options.checkboxOptions);this.domObj.adopt(document.id(A));if(this.options.useStore){A.setValue(this.store.get(this.options.field))}A.addEvents({blur:this.onBlur,change:this.onChange})},setColumn:function(A){this.column=A;if(this.options.useStore){this.store=this.column.grid.getModel();this.attached=true}},onBlur:function(A){if(this.options.updateStore){this.updateStore(A)}this.column.grid.fireEvent("checkBlur",[this.column,A])},onChange:function(A){if(this.options.updateStore){this.updateStore(A)}this.column.grid.fireEvent("checkBlur",[this.column,A])},updateStore:function(C){var B=C.getValue();var A=document.id(C).getParent().retrieve("jxCellData");var D=A.row;if(this.store.get(this.options.field,D)!==B){this.store.set(this.options.field,B,D)}}});Jx.Grid.Renderer.Button=new Class({Family:"Jx.Grid.Renderer.Button",Extends:Jx.Grid.Renderer,Binds:[],options:{template:'<span class="buttons"></span>',buttonOptions:null},classes:$H({domObj:"buttons"}),init:function(){this.parent()},render:function(){this.parent();$A(this.options.buttonOptions).each(function(B){var A=new Jx.Button(B);this.domObj.grab(document.id(A))},this)}});Jx.Plugin.Grid.Selector=new Class({Family:"Jx.Plugin.Grid.Selector",Extends:Jx.Plugin,Binds:["select","checkSelection","checkAll","afterGridRender"],options:{cell:false,row:false,column:false,multiple:false,useCheckColumn:false,checkAsHeader:false},selected:null,init:function(){this.parent();this.selected=$H({columns:[],rows:[],rowHeads:[],columnHeads:[]})},attach:function(A){if(!$defined(A)&&!(A instanceof Jx.Grid)){return }this.grid=A;this.grid.addEvent("gridCellSelect",this.select);if(this.options.cell){this.oldSelectionClass=this.grid.selection.options.selectedClass;this.grid.selection.options.selectClass="jxGridCellSelected";if(this.options.multiple){this.grid.selection.options.selectMode="multiple"}}if(this.options.useCheckColumn){var C='<span class="jxGridCellContent">';if(this.options.multiple){C+='<span class="jxInputContainer jxInputContainerCheck"><input class="jxInputCheck" type="checkbox" name="checkAll" id="checkAll"/></span>'}else{C+="</span>"}C+="</span>";this.checkColumn=new Jx.Column({template:C,renderMode:"fit",renderer:new Jx.Grid.Renderer.Checkbox({}),name:"selection"},this.grid);this.grid.columns.columns.reverse();this.grid.columns.columns.push(this.checkColumn);this.grid.columns.columns.reverse();if(this.options.checkAsHeader){this.oldHeaderColumn=this.grid.row.options.headerColumn;this.grid.row.options.headerColumn="selection";if(this.options.multiple){this.grid.addEvent("doneCreateGrid",this.afterGridRender)}}if(this.options.multiple){var B=document.id(this.checkColumn).getElement("input");B.addEvents({change:this.checkAll})}}},afterGridRender:function(){if(this.options.checkAsHeader){var A=document.id(this.checkColumn).clone();A.getElement("input").addEvent("change",this.checkAll);this.grid.rowColObj.adopt(A)}this.grid.removeEvent("doneCreateGrid",this.afterGridRender)},detach:function(){if(this.grid){this.grid.removeEvent("gridCellSelect",this.select);if(this.options.cell){this.grid.selection.options.selectedClass=this.oldSelectionClass}}if(this.options.useCheckColumn){var A=this.grid.columns.getByName("selection");this.grid.columns.columns.erase(A);if(this.options.checkAsHeader){this.grid.row.options.headerColumn=this.oldHeaderColumn}}this.grid=null},activate:function(A){this.options[A]=true;if(A==="cell"){this.oldSelectionClass=this.grid.selection.options.selectedClass;this.grid.selection.options.selectClass="jxGridCellSelected"}},deactivate:function(A){this.options[A]=false;if(A==="cell"){this.grid.selection.selected().each(function(B){this.grid.selection.unselect(B)},this);this.grid.selection.options.selectClass=this.oldSelectionClass}else{if(A==="row"){this.selected.get("rows").each(function(B){B.removeClass("jxGridRowSelected")},this);this.selected.set("rows",[]);this.selected.get("rowHeads").each(function(B){B.removeClass("jxGridRowHeaderSelected")},this);this.selected.set("rowHeads",[])}else{this.selected.get("columns").each(function(C){for(var B=0;B<this.grid.gridTable.rows.length;B++){this.grid.gridTable.rows[B].cells[C].removeClass("jxGridColumnSelected")}},this);this.selected.set("columns",[]);this.selected.get("columnHeads").each(function(B){B.removeClass("jxGridColumnHeaderSelected")},this);this.selected.set("columnHeads",[])}}},select:function(A){var B=A.retrieve("jxCellData");if(this.options.row&&$defined(B.row)){this.selectRow(B.row)}if(this.options.column&&$defined(B.index)){if(this.grid.row.useHeaders()){this.selectColumn(B.index-1)}else{this.selectColumn(B.index)}}},selectRow:function(C){if(!this.options.row){return }var B=(C>=0&&C<this.grid.gridTableBody.rows.length)?this.grid.gridTableBody.rows[C]:null;B=document.id(B);var A=this.selected.get("rows");if(B.hasClass("jxGridRowSelected")){B.removeClass("jxGridRowSelected");this.setCheckField(C,false);if(this.options.multiple&&this.options.useCheckColumn){if(this.options.checkAsHeader){document.id(this.grid.rowColObj).getElement("input").removeProperty("checked")}else{document.id(this.checkColumn).getElement("input").removeProperty("checked")}}A.erase(B)}else{A.push(B);B.addClass("jxGridRowSelected");this.setCheckField(C,true)}if(!this.options.multiple){A.each(function(D){if(D!==B){D.removeClass("jxGridRowSelected");this.setCheckField(D.retrieve("jxRowData").row,false);A.erase(D)}},this)}this.selectRowHeader(C)},setCheckField:function(D,C){if(this.options.useCheckColumn){var A;if(this.options.checkAsHeader){A=document.id(this.grid.rowTableHead.rows[D].cells[0]).getFirst().getFirst()}else{var B=this.grid.columns.getIndexFromGrid(this.checkColumn.name);A=document.id(this.grid.gridTableBody.rows[D].cells[B]).getFirst().getFirst()}A.retrieve("field").setValue(C)}},selectRowHeader:function(C){if(!this.grid.row.useHeaders()){return }var A=(C>=0&&C<this.grid.rowTableHead.rows.length)?this.grid.rowTableHead.rows[C].cells[0]:null;if(!A){return }A=document.id(A);var B=this.selected.get("rowHeads");if(B.contains(A)){A.removeClass("jxGridRowHeaderSelected");B.erase(A)}else{A.addClass("jxGridRowHeaderSelected");B.push(A)}if(!this.options.multiple){B.each(function(D){if(D!==A){D.removeClass("jxGridRowHeaderSelected");B.erase(D)}},this)}},selectColumn:function(B){if(B>=0&&B<this.grid.gridTable.rows[0].cells.length){var D=this.selected.get("columns");var A="";if(D.contains(B)){A="removeClass";D.erase(B)}else{A="addClass";D.push(B)}for(var C=0;C<this.grid.gridTable.rows.length;C++){this.grid.gridTable.rows[C].cells[B][A]("jxGridColumnSelected")}if(!this.options.multiple){D.each(function(F){if(F!==B){for(var E=0;E<this.grid.gridTable.rows.length;E++){this.grid.gridTable.rows[E].cells[F].removeClass("jxGridColumnSelected")}D.erase(F)}},this)}this.selectColumnHeader(B)}},selectColumnHeader:function(B){if(this.grid.colTableBody.rows.length===0||!this.grid.row.useHeaders()){return }var A=(B>=0&&B<this.grid.colTableBody.rows[0].cells.length)?this.grid.colTableBody.rows[0].cells[B]:null;if(A===null){return }A=document.id(A);cells=this.selected.get("columnHeads");if(cells.contains(A)){A.removeClass("jxGridColumnHeaderSelected");cells.erase(A)}else{A.addClass("jxGridColumnHeaderSelected");cells.push(A)}if(!this.options.multiple){cells.each(function(C){if(C!==A){C.removeClass("jxGridColumnHeaderSelected");cells.erase(C)}},this)}},checkSelection:function(A,C){var B=document.id(C).getParent().retrieve("jxCellData");this.selectRow(B.row)},checkAll:function(){var A;var C;var B;B=this.options.checkAsHeader?this.grid.rowColObj.getElement("input").get("checked"):this.checkColumn.domObj.getElement("input").get("checked");if(this.options.checkAsHeader){A=0;C=this.grid.rowTableHead.rows}else{A=this.grid.columns.getIndexFromGrid(this.checkColumn.name);C=this.grid.gridTableBody.rows}$A(C).each(function(G,D){var E=G.cells[A].getElement("input");if($defined(E)){var F=E.get("checked");if(F!==B){this.selectRow(D)}}},this)}});Jx.Plugin.Grid.Prelighter=new Class({Extends:Jx.Plugin,options:{cell:false,row:false,column:false,rowHeader:false,columnHeader:false},bound:{},init:function(){this.parent();this.bound.lighton=this.lighton.bind(this);this.bound.lightoff=this.lightoff.bind(this);this.bound.mouseleave=this.mouseleave.bind(this)},attach:function(A){if(!$defined(A)&&!(A instanceof Jx.Grid)){return }this.grid=A;this.grid.addEvent("gridCellEnter",this.bound.lighton);this.grid.addEvent("gridCellLeave",this.bound.lightoff);this.grid.addEvent("gridMouseLeave",this.bound.mouseleave)},detach:function(){if(this.grid){this.grid.removeEvent("gridCellEnter",this.bound.lighton);this.grid.removeEvent("gridCellLeave",this.bound.lightoff);this.grid.removeEvent("gridMouseLeave",this.bound.mouseleave)}this.grid=null},activate:function(A){this.options[A]=true},deactivate:function(A){this.options[A]=false},lighton:function(A,C,B){this.light(A,C,B,true)},lightoff:function(A,C,B){this.light(A,C,B,false)},light:function(A,E,C,B){var D=A.retrieve("jxCellData");if(this.options.cell){this.prelightCell(A,B)}if(this.options.row){this.prelightRow(D.row,B)}if(this.options.column){if(this.grid.row.useHeaders()){this.prelightColumn(D.index-1,B)}else{this.prelightColumn(D.index,B)}}if(this.options.rowHeader){this.prelightRowHeader(D.row,B)}if(this.options.columnHeader){this.prelightColumnHeader(D.index-1,B)}},prelightRowHeader:function(B,A){if($defined(this.prelitRowHeader)&&!A){this.prelitRowHeader.removeClass("jxGridRowHeaderPrelight")}else{if(A){this.prelitRowHeader=(B>=0&&B<this.grid.rowTableHead.rows.length)?this.grid.rowTableHead.rows[B].cells[0]:null;if(this.prelitRowHeader){this.prelitRowHeader.addClass("jxGridRowHeaderPrelight")}}}},prelightColumnHeader:function(B,A){if(this.grid.colTableBody.rows.length===0){return }if($defined(this.prelitColumnHeader)&&!A){this.prelitColumnHeader.removeClass("jxGridColumnHeaderPrelight")}else{if(A){this.prelitColumnHeader=(B>=0&&B<this.grid.colTableBody.rows[0].cells.length)?this.grid.colTableBody.rows[0].cells[B]:null;if(this.prelitColumnHeader){this.prelitColumnHeader.addClass("jxGridColumnHeaderPrelight")}}}},prelightRow:function(B,A){if($defined(this.prelitRow)&&!A){this.prelitRow.removeClass("jxGridRowPrelight")}else{if(A){this.prelitRow=(B>=0&&B<this.grid.gridTableBody.rows.length)?this.grid.gridTableBody.rows[B]:null;if(this.prelitRow){this.prelitRow.addClass("jxGridRowPrelight")}}}this.prelightRowHeader(B,A)},prelightColumn:function(B,A){if(B>=0&&B<this.grid.gridTable.rows[0].cells.length){if($defined(this.prelitColumn)&&!A){for(var C=0;C<this.grid.gridTable.rows.length;C++){this.grid.gridTable.rows[C].cells[this.prelitColumn].removeClass("jxGridColumnPrelight")}}else{if(A){this.prelitColumn=B;for(C=0;C<this.grid.gridTable.rows.length;C++){this.grid.gridTable.rows[C].cells[B].addClass("jxGridColumnPrelight")}}}this.prelightColumnHeader(B,A)}},prelightCell:function(A,B){if($defined(this.prelitCell)&&!B){this.prelitCell.removeClass("jxGridCellPrelight")}else{if(B){this.prelitCell=A;if(this.prelitCell){this.prelitCell.addClass("jxGridCellPrelight")}}}},mouseleave:function(){if($defined(this.prelitCell)){this.prelitCell.removeClass("jxGridCellPrelight")}if($defined(this.prelitColumn)){for(var A=0;A<this.grid.gridTable.rows.length;A++){this.grid.gridTable.rows[A].cells[this.prelitColumn].removeClass("jxGridColumnPrelight")}}if($defined(this.prelitRow)){this.prelitRow.removeClass("jxGridRowPrelight")}if($defined(this.prelitColumnHeader)){this.prelitColumnHeader.removeClass("jxGridColumnHeaderPrelight")}if($defined(this.prelitRowHeader)){this.prelitRowHeader.removeClass("jxGridRowHeaderPrelight")}}});Jx.Plugin.Grid.Sorter=new Class({Family:"Jx.Plugin.Grid.Sorter",Extends:Jx.Plugin,Binds:["sort","addHeaderClass"],current:null,direction:null,currentGridIndex:null,attach:function(A){if(!$defined(A)&&!(A instanceof Jx.Grid)){return }this.grid=A;this.grid.addEvent("gridCellSelect",this.sort)},detach:function(){if(this.grid){this.grid.removeEvent("gridCellSelect",this.sort)}this.grid=null},sort:function(A){var C=A.retrieve("jxCellData");if(C.colHeader){var B=C.column;if(B.isSortable()){if(B===this.current){this.direction=(this.direction==="asc")?"desc":"asc"}else{this.current=B;this.direction="asc";this.currentGridIndex=C.index-1}this.grid.addEvent("doneCreateGrid",this.addHeaderClass);var D=this.grid.getModel().getStrategy("sort");if(D){D.sort(this.current.name,null,this.direction)}}}},addHeaderClass:function(){this.grid.removeEvent("doneCreateGrid",this.addHeaderClass);var A=this.grid.colTable.rows[0].cells[this.currentGridIndex];A.addClass("jxGridColumnSorted"+this.direction.capitalize())}});Jx.Plugin.Grid.Resize=new Class({Extends:Jx.Plugin,Binds:["createHandles","removeHandles"],options:{column:false,row:false,tooltip:MooTools.lang.get("Jx","plugin.resize").tooltip},els:{column:[],row:[]},drags:{column:[],row:[]},attach:function(A){if(!$defined(A)&&!(A instanceof Jx.Grid)){return }this.grid=A;this.grid.addEvent("doneCreateGrid",this.createHandles);this.grid.addEvent("beginCreateGrid",this.removeHandles);this.createHandles()},detach:function(){if(this.grid){this.grid.removeEvent("doneCreateGrid",this.createHandles);this.grid.removeEvent("beginCreateGrid",this.removeHandles)}this.grid=null},activate:function(A){if($defined(this.options[A])){this.options[A]=true}this.createHandles()},deactivate:function(A){if($defined(this.options[A])){this.options[A]=false}this.createHandles()},removeHandles:function(){["column","row"].each(function(A){this.els[A].each(function(B){B.dispose()});this.els[A]=[];this.drags[A].each(function(B){B.detach()});this.drags[A]=[]},this)},createHandles:function(){this.removeHandles();if(this.options.column&&this.grid.columns.useHeaders()){var A=this.grid.row.getRowHeaderColumn();this.grid.columns.columns.each(function(C,B){if(C.options.name!=A&&C.isResizable()&&C.domObj){var D=new Element("div",{"class":"jxGridColumnResize",title:this.options.tooltip,events:{dblclick:function(){C.options.renderMode="fit";C.options.width="auto";C.setWidth(C.getWidth(true))}}}).inject(C.domObj);D.store("col",C);this.els.column.push(D);this.drags.column.push(new Drag(D,{limit:{y:[0,0]},snap:2,onBeforeStart:function(F){var E=F.getPosition(F.parentNode).x.toInt();F.setStyles({left:E,right:null})},onStart:function(F){var E=F.getPosition(F.parentNode).x.toInt();F.setStyles({left:E,right:null})},onDrag:function(G){var F=G.retrieve("col");F.options.renderMode="fixed";var E=G.getPosition(G.parentNode).x.toInt();F.setWidth(E);F.grid.resizeRowsCols("rows")},onComplete:function(E){E.setStyle("left",null)}}))}},this)}},createText:function(B){this.parent();var A=MooTools.lang.get("Jx","plugin.resize").tooltip;["column","row"].each(function(C){this.els[C].each(function(D){D.set("title",A)})},this)}});Jx.Plugin.Grid.Editor=new Class({Extends:Jx.Plugin,Binds:["activate","deactivate","changeText"],options:{enabled:true,blurDelay:500,popup:{use:true,useLabels:false,useButtons:true,button:{submit:{label:"",image:"images/accept.png"},cancel:{label:"",image:"images/cancel.png"}},template:'<div class="jxGridEditorPopup"><div class="jxGridEditorPopupInnerWrapper"></div></div>'},validate:true,fieldOptions:[{field:"*",type:"Text",options:{},validatorOptions:{validators:[],validateOnBlur:true,validateOnChange:false}}],fieldFormatted:true,cellChangeFx:{use:true,success:"#090",error:"#F00"},cellOutline:{use:true,style:"2px solid #88c3e7"},useKeyboard:true,keys:{"ctrl+shift+enter":"saveNGoUp",tab:"saveNGoRight","ctrl+enter":"saveNGoDown","shift+tab":"saveNGoLeft",enter:"saveNClose","ctrl+up":"cancelNGoUp","ctrl+right":"cancelNGoRight","ctrl+down":"cancelNGoDown","ctrl+left":"cancelNGoLeft",esc:"cancelNClose",up:"valueIncrement",down:"valueDecrement"},keyboardMethods:{},keypressLoop:true,linkClickListener:true},classes:["jxGridEditorPopup","jxGridEditorPopupInnerWrapper"],activeCell:{field:null,cell:null,span:null,oldValue:null,newValue:{data:null,error:false},timeoutId:null,coords:{},colOptions:{},fieldOptions:{}},popup:{domObj:null,innerWarpper:null,closeIcon:null,button:{submit:null,cancel:null}},keyboard:null,keyboardMethods:{},init:function(){this.parent()},attach:function(D){if(!$defined(D)&&!(D instanceof Jx.Grid)){return }this.grid=D;this.grid.addEvent("gridCellSelect",this.activate);this.grid.addEvent("gridCellUnSelect",this.deactivate);if(this.getFieldOptionsByColName("*").field!="*"){this.options.fieldOptions.unshift({field:"*",type:"Text",options:{},validatorOptions:{validators:[],validateOnBlur:true,validateOnChange:false}})}var A=this;this.keyboardMethods={saveNClose:function(E){if(A.activeCell.fieldOptions.type!="Textarea"||(A.activeCell.fieldOptions.type=="Textarea"&&E.key!="enter")){A.deactivate()}},saveNGoUp:function(E){E.preventDefault();A.getPrevCellInCol()},saveNGoRight:function(E){E.preventDefault();A.getNextCellInRow()},saveNGoDown:function(E){E.preventDefault();A.getNextCellInCol()},saveNGoLeft:function(E){E.preventDefault();A.getPrevCellInRow()},cancelNClose:function(E){E.preventDefault();A.deactivate(false)},cancelNGoUp:function(E){E.preventDefault();A.getPrevCellInCol(false)},cancelNGoRight:function(E){E.preventDefault();A.getNextCellInRow(false)},cancelNGoDown:function(E){E.preventDefault();A.getNextCellInCol(false)},cancelNGoLeft:function(E){E.preventDefault();A.getPrevCellInRow(false)},valueIncrement:function(E){E.preventDefault();A.cellValueIncrement(true)},valueDecrement:function(E){E.preventDefault();A.cellValueIncrement(false)}};var C={};for(var B in this.options.keys){if($defined(this.keyboardMethods[this.options.keys[B]])){C[B]=this.keyboardMethods[this.options.keys[B]]}else{if($defined(this.options.keyboardMethods[this.options.keys[B]])){C[B]=this.options.keyboardMethods[this.options.keys[B]].bind(A)}else{if(Jx.type(this.options.keys[B])=="function"){C[B]=this.options.keys[B].bind(A)}else{$defined(console)?console.warn("keyboard method %o not defined",this.options.keys[B]):false}}}}this.keyboard=new Keyboard({events:C});this.addFormatterUriClickListener()},detach:function(){if(this.grid){this.grid.removeEvent("gridClick",this.activate)}this.grid=null;this.keyboard=null},enable:function(){this.options.enabled=true},disable:function(B,A){B=$defined(B)?B:true;A=$defined(A)?A:false;if(B&&this.activeCell.cell!=null){this.deactivate(A)}this.options.enabled=false},activate:function(J){if(!this.options.enabled){return }var E=J.retrieve("jxCellData");if(($defined(E.colHeader)&&E.colHeader)||($defined(E.rowHeader)&&E.rowHeader)){return }var M=E.row,G=E.index;clearTimeout(this.activeCell.timeoutId);if(this.cellIsInGrid(M,G)){var I=this.grid.options.row.useHeaders?G-1:G;var F=this.grid.getModel(),L=this.grid.columns.getByGridIndex(I).options;if(!J||!L.isEditable){return }if(this.activeCell.cell!=null&&this.deactivate()==false){return }F.moveTo(M);this.activeCell={oldValue:F.get(E.index),newValue:{data:null,error:false},fieldOptions:this.getFieldOptionsByColName(L.name),colOptions:L,coords:{row:M,index:G},cell:J,span:J.getElement("span.jxGridCellContent"),validator:null,field:null,timeoutId:null};if(!$defined(this.activeCell.colOptions.validate)||typeof (this.activeCell.colOptions.validate)!="boolean"){this.activeCell.colOptions.validate=this.options.validate}var N=$defined(this.activeCell.fieldOptions.options)?this.activeCell.fieldOptions.options:{};switch(this.activeCell.fieldOptions.type){case"Text":case"Color":case"Password":case"File":N.value=this.activeCell.oldValue;break;case"Textarea":N.value=this.activeCell.oldValue.replace(/<br \/>/gi,"\n");break;case"Select":var A=this.activeCell.oldValue.toString();function H(R,P){for(var Q=0,O=R.length;Q<O;Q++){if(R[Q].value==P){R[Q].selected=true}else{R[Q].selected=false}}return R}if(N.comboOpts){N.comboOpts=H(N.comboOpts,A)}else{if(N.optGroups){var C=N.optGroups;for(var D=0,B=C.length;D<B;D++){C[D].options=H(C[D].options,A)}N.optGroups=C}}break;case"Radio":case"Checkbox":default:$defined(console)?console.warn("Fieldtype %o is not supported yet. If you have set a validator for a column, you maybe have forgotton to enter a field type.",this.activeCell.fieldOptions.type):false;return ;break}if(this.options.fieldFormatted&&this.activeCell.colOptions.renderer.options.formatter!=null){if(!$defined(this.activeCell.colOptions.fieldFormatted)||this.activeCell.colOptions.fieldFormatted==true){N.value=this.activeCell.colOptions.renderer.options.formatter.format(N.value);this.activeCell.oldValue=N.value}}this.activeCell.field=new Jx.Field[this.activeCell.fieldOptions.type.capitalize()](N);if(this.options.validate&&this.activeCell.colOptions.validate){this.activeCell.validator=new Jx.Plugin.Field.Validator(this.activeCell.fieldOptions.validatorOptions);this.activeCell.validator.attach(this.activeCell.field)}this.setStyles(J);if(this.options.useKeyboard){this.keyboard.activate()}if(typeof (this.options.blurDelay)=="string"){this.options.blurDelay=this.options.blurDelay.toInt()?this.options.blurDelay.toInt():false}if(this.options.blurDelay!==false&&typeof (this.options.blurDelay)=="number"){var K=this;this.activeCell.field.field.addEvents({blur:function(){clearTimeout(K.activeCell.timeoutId);K.activeCell.timeoutId=K.deactivate.delay(K.options.blurDelay)},focus:function(){clearTimeout(K.activeCell.timeoutId)},mouseover:function(){clearTimeout(K.activeCell.timeoutId)}});if(this.popup.domObj!=null){this.popup.domObj.addEvent("mouseenter",function(){clearTimeout(K.activeCell.timeoutId)})}}this.activeCell.field.field.focus()}else{if($defined(console)){console.warn("out of grid %o",J)}}},deactivate:function(D){clearTimeout(this.activeCell.timeoutId);if(this.activeCell.field!==null){D=$defined(D)?D:true;var E={data:null,error:false};if(D&&this.activeCell.field.getValue().toString()!=this.activeCell.oldValue.toString()){this.grid.model.moveTo(this.activeCell.coords.row);switch(this.activeCell.fieldOptions.type){case"Select":var C=this.activeCell.field.field.selectedIndex;E.data=document.id(this.activeCell.field.field.options[C]).get("value");break;case"Textarea":E.data=this.activeCell.field.getValue().replace(/\n/gi,"<br />");break;default:E.data=this.activeCell.field.getValue();break}if(D){this.activeCell.newValue.data=E.data}if(this.activeCell.validator!=null&&!this.activeCell.validator.isValid()){E.error=true;this.activeCell.field.field.focus.delay(50,this.activeCell.field.field)}}else{this.activeCell.span.show()}if(D&&E.data!=null&&E.error==false){this.grid.model.set(this.activeCell.coords.index,E.data);this.addFormatterUriClickListener()}else{if(E.error==true){this.activeCell.span.show()}}if($defined(this.activeCell.coords.row)&&$defined(this.activeCell.coords.index)){var B=this.grid.options.row.useHeaders?this.activeCell.coords.index-1:this.activeCell.coords.index;this.activeCell.cell=this.grid.gridTableBody.rows[this.activeCell.coords.row].cells[B]}if(this.options.useKeyboard){this.activeCell.field.removeEvent("keypress",this.setKeyboard)}if(this.options.cellChangeFx.use){var A=new Fx.Tween(this.activeCell.cell,{duration:250,onComplete:function(G){this.element.removeProperty("style")}});var F=this.activeCell.cell.getStyle("background-color");F=F=="transparent"?"#fff":F;if(E.data!=null&&E.error==false){A.start("background-color",this.options.cellChangeFx.success,F)}else{if(E.error){A.start("background-color",this.options.cellChangeFx.error,F)}}}if(E.error){if(this.options.cellChangeFx.use){this.activeCell.field.field.highlight(this.options.cellChangeFx.error)}this.activeCell.field.field.setStyle("border","1px solid "+this.options.cellChangeFx.error);this.activeCell.field.field.focus();return false}else{this.keyboard.deactivate();this.unsetActiveField();return true}}},setStyles:function(A){if(this.options.popup.use){if(this.options.popup.useLabels){this.activeCell.field.options.label=this.activeCell.colOptions.header;this.activeCell.field.render()}var C={field:{width:this.activeCell.field.type=="Select"?A.getContentBoxSize().width+5+"px":A.getContentBoxSize().width-14+"px",margin:"auto 0"}};this.activeCell.field.field.setStyles(C.field);this.showPopUp(A)}else{var B=A.getContentBoxSize(),C={domObj:{position:"absolute"},field:{width:B.width+"px","margin-left":0}};this.activeCell.field.domObj.setStyles(C.domObj);this.activeCell.field.field.setStyles(C.field);this.activeCell.field.domObj.inject(document.body);Jx.Widget.prototype.position(this.activeCell.field.domObj,A,{horizontal:["left left"],vertical:["top top"]});this.activeCell.span.hide()}if(this.options.cellOutline.use){A.setStyle("outline",this.options.cellOutline.style)}},showPopUp:function(A){if(this.popup.domObj!=null){Jx.Widget.prototype.position(this.popup.domObj,A,{horizontal:["left left"],vertical:["top top"]});this.activeCell.field.domObj.inject(this.popup.innerWrapper,"top");this.popup.domObj.show();this.setPopUpButtons();this.setPopUpStylesAfterRendering()}else{this.createPopUp(A)}},createPopUp:function(G){var E=G.getCoordinates(),I=this,A=null,C=null,B=null,D=null,H=null,F=Jx.Widget.prototype.processTemplate(this.options.popup.template,this.classes);A=F.jxGridEditorPopup;C=F.jxGridEditorPopupInnerWrapper;A.setStyles({left:E.left+"px",top:E.top+"px"});this.popup.domObj=A;this.popup.innerWrapper=C;this.popup.closeIcon=B;this.setPopUpButtons();this.activeCell.field.domObj.inject(this.popup.innerWrapper,"top");this.popup.domObj.inject(document.body);this.setPopUpStylesAfterRendering()},setPopUpStylesAfterRendering:function(){if(this.options.popup.useButtons&&this.popup.button.submit!=null&&this.popup.button.cancel!=null){this.popup.domObj.setStyle("min-width",this.popup.button.submit.domObj.getSize().x+this.popup.button.cancel.domObj.getSize().x+"px")}else{if(this.popup.button.submit!=null){this.popup.button.submit.domObj.hide()}if(this.popup.button.cancel!=null){this.popup.button.cancel.domObj.hide()}}this.activeCell.field.field.setStyle("width",this.activeCell.field.type=="Select"?this.popup.domObj.getSize().x-7+"px":this.popup.domObj.getSize().x-17+"px")},setPopUpButtons:function(){var A=this,B={submit:null,cancel:null};if(this.options.popup.useButtons&&this.popup.innerWrapper!=null&&this.popup.button.submit==null){B.submit=new Jx.Button({label:this.options.popup.button.submit.label.length==0?MooTools.lang.get("Jx","plugin.editor").submitButton:this.options.popup.button.submit.label,image:this.options.popup.button.submit.image,onClick:function(){A.deactivate(true)}}).addTo(this.popup.innerWrapper);B.cancel=new Jx.Button({label:this.options.popup.button.cancel.label.length==0?MooTools.lang.get("Jx","plugin.editor").cancelButton:this.options.popup.button.cancel.label,image:this.options.popup.button.cancel.image,onClick:function(){A.deactivate(false)}}).addTo(this.popup.innerWrapper)}else{if(this.options.popup.useButtons&&this.popup.button.submit!=null){B={submit:this.popup.button.submit,cancel:this.popup.button.cancel}}else{if(this.options.popup.useButtons==false&&this.popup.button.submit!=null){this.popup.button.submit.cleanup();this.popup.button.cancel.cleanup()}}}this.popup.button=B},unsetActiveField:function(){this.activeCell.field.destroy();if(this.popup.domObj!=null){this.popup.domObj.removeEvent("mouseenter");this.popup.domObj.hide()}this.activeCell.cell.setStyle("outline","0px");this.activeCell={field:null,oldValue:null,newValue:{data:null,error:false},cell:null,span:null,timeoutId:null,colOptions:{},coords:{},fieldOptions:{},validator:null}},unsetPopUp:function(){if(this.popup.domObj!=null){this.popup.domObj.destroy();this.popup.innerWrapper=null;this.popup.closeIcon=null;this.popup.button.submit=null;this.popup.button.cancel=null}},getNextCellInRow:function(E){E=$defined(E)?E:true;if(this.activeCell.cell!=null){var D=true,C=true,A=this.grid.columns.columns.length,G="td.jxGridCell:not(.jxGridCellUnattached)";var B=0;do{D=B>0?D.getNext(G):this.activeCell.cell.getNext(G);if(D==null){C=this.activeCell.cell.getParent("tr").getNext();if(C==null&&this.options.keypressLoop){C=this.activeCell.cell.getParent("tbody").getFirst()}else{if(C==null&&!this.options.keypressLoop){return }}D=C.getFirst(G)}var F=D.retrieve("jxCellData");B++;if(B==A*2){this.deactivate(E);return }}while(!F.col.options.isEditable);if(E===false){this.deactivate(E)}this.grid.selection.select(D)}},getPrevCellInRow:function(F){F=$defined(F)?F:true;if(this.activeCell.cell!=null){var G,A,D=0,I=this.grid.columns.columns.length,B="td.jxGridCell:not(.jxGridCellUnattached)";do{G=D>0?G.getPrevious(B):this.activeCell.cell.getPrevious(B);if(G==null){A=this.activeCell.cell.getParent("tr").getPrevious();if(A==null&&this.options.keypressLoop){A=this.activeCell.cell.getParent("tbody").getLast()}else{if(A==null&&!this.options.keypressLoop){return }}G=A.getLast(B)}var C=G.retrieve("jxCellData"),H=C.row,E=C.index;D++;if(D==I*2){this.deactivate(F);return }}while(!C.col.options.isEditable);if(F===false){this.deactivate(F)}this.grid.selection.select(G)}},getNextCellInCol:function(C){C=$defined(C)?C:true;if(this.activeCell.cell!=null){var B,A;B=this.activeCell.cell.getParent().getNext();if(B==null){B=this.activeCell.cell.getParent("tbody").getFirst()}A=B.getElement("td.jxGridCol"+this.activeCell.coords.index);if(C===false){this.deactivate(C)}this.grid.selection.select(A)}},getPrevCellInCol:function(B){B=$defined(B)?B:true;if(this.activeCell.cell!=null){var C,A;C=this.activeCell.cell.getParent().getPrevious();if(C==null){C=this.activeCell.cell.getParent("tbody").getLast()}A=C.getElement("td.jxGridCol"+this.activeCell.coords.index);if(B===false){this.deactivate(B)}this.grid.selection.select(A)}},cellValueIncrement:function(B){var A=this.activeCell.colOptions.dataType,D=null;switch(A){case"numeric":case"currency":D=this.activeCell.field.getValue().toInt();if(typeof (D)=="number"){if(B){D++}else{D--}}break;case"date":D=Date.parse(this.activeCell.field.getValue());if(D instanceof Date){if(B){D.increment()}else{D.decrement()}var C=new Jx.Formatter.Date();D=C.format(D)}break}if(D!=null){this.activeCell.field.setValue(D)}},cellIsInGrid:function(B,A){if($defined(B)&&$defined(A)){if(B>=0&&A>=0&&B<=this.grid.gridTableBody.rows.length&&A<=this.grid.gridTableBody.rows[B].cells.length){return true}else{return false}}else{return false}},getFieldOptionsByColName:function(D){var C=this.options.fieldOptions,E=this.options.fieldOptions[0];for(var B=0,A=C.length;B<A;B++){if(C[B].field==D){E=C[B];break}}return E},addFormatterUriClickListener:function(){if(this.options.linkClickListener){var B=[],C,A;this.grid.columns.columns.each(function(D,E){if(D.options.renderer.options.formatter!=null&&D.options.renderer.options.formatter instanceof Jx.Formatter.Uri){B.push(E)}});this.grid.gridTable.getElements("tr").each(function(G,F){C=G.getElements("td.jxGridCell");for(var E=0,D=B.length;E<D;E++){A=C[B[E]-1].getElement("a");if(A){A.removeEvent("click");A.addEvent("click",function(H){if(!H.control){H.preventDefault()}})}}})}},changeText:function(A){this.parent();if(this.options.popup.use&&this.options.popup.useButtons){if(this.popup.button.submit!=null){this.popup.button.submit.cleanup();this.popup.button.cancel.cleanup();this.popup.button.submit=null;this.popup.button.cancel=null;this.setPopUpButtons()}}}});Jx.Plugin.DataView={};Jx.Slide=new Class({Family:"Jx.Slide",Implements:Jx.Object,Binds:["handleClick"],options:{target:null,trigger:null,type:"height",setOpenTo:"auto",onSlideOut:$empty,onSlideIn:$empty},init:function(){this.target=document.id(this.options.target);this.target.set("tween",{onComplete:this.setDisplay.bind(this)});if($defined(this.options.trigger)){this.trigger=document.id(this.options.trigger);this.trigger.addEvent("click",this.handleClick)}this.target.store("slider",this)},handleClick:function(){var A=this.target.getMarginBoxSize();if(A.height===0){this.slide("in")}else{this.slide("out")}},setDisplay:function(){var A=this.target.getStyle(this.options.type).toInt();if(A===0){this.target.setStyle("display","none");this.fireEvent("slideOut",this.target)}else{if(this.target.getStyle("position")!=="absolute"){this.target.setStyle(this.options.type,this.options.setOpenTo)}this.fireEvent("slideIn",this.target)}},slide:function(A){var B;if(A==="in"){B=this.target.retrieve(this.options.type);this.target.setStyles({overflow:"hidden",display:"block"});this.target.setStyles(this.options.type,0);this.target.tween(this.options.type,B)}else{if(this.options.type==="height"){B=this.target.getMarginBoxSize().height}else{B=this.target.getMarginBoxSize().width}this.target.store(this.options.type,B);this.target.setStyle("overflow","hidden");this.target.setStyle(this.options.type,B);this.target.tween(this.options.type,0)}}});Jx.Plugin.DataView.GroupFolder=new Class({Extends:Jx.Plugin,options:{headerClass:null},headerState:new Hash(),attach:function(A){if(!$defined(A)&&!(dataview instanceof Jx.Panel.DataView)){return }this.dv=A;this.dv.addEvent("renderDone",this.setHeaders.bind(this))},setHeaders:function(){var A=this.dv.domA.getElements("."+this.dv.options.groupHeaderClass);A.each(function(E){var D=E.get("id");var B=new Jx.Slide({target:E.getNext(),trigger:D,onSlideOut:this.onSlideOut.bind(this,E),onSlideIn:this.onSlideIn.bind(this,E)});if(this.headerState.has(D)){var C=this.headerState.get(D);if(C==="open"){B.slide("in")}else{B.slide("out")}}else{B.slide("in")}},this)},onSlideIn:function(A){this.headerState.set(A.get("id"),"open");if(A.hasClass(this.options.headerClass+"-closed")){A.removeClass(this.options.headerClass+"-closed")}A.addClass(this.options.headerClass+"-open")},onSlideOut:function(A){this.headerState.set(A.get("id"),"closed");if(A.hasClass(this.options.headerClass+"-open")){A.removeClass(this.options.headerClass+"-open")}A.addClass(this.options.headerClass+"-closed")}});Jx.Plugin.Field={};Jx.Plugin.Field.Validator=new Class({Extends:Jx.Plugin,name:"Field.Validator",options:{validators:[],validateOnBlur:true,validateOnChange:true},valid:null,errors:[],bound:{},validators:new Hash(),init:function(){this.parent();this.bound.validate=this.validate.bind(this);this.bound.reset=this.reset.bind(this)},attach:function(A){if(!$defined(A)&&!(A instanceof Jx.Field)){return }this.field=A;if(this.field.options.required&&!this.options.validators.contains("required")){this.options.validators.reverse().push("required");this.options.validators.reverse()}this.options.validators.each(function(B){var C=Jx.type(B);if(C==="string"){this.field.field.addClass(B)}else{if(C==="object"){this.validators.set(B.validator.name,new InputValidator(B.validator.name,B.validator.options));this.field.field.addClass(B.validatorClass)}}},this);if(this.options.validateOnBlur){this.field.field.addEvent("blur",this.bound.validate)}if(this.options.validateOnChange){this.field.field.addEvent("change",this.bound.validate)}this.field.addEvent("reset",this.bound.reset)},detach:function(){if(this.field){this.field.field.removeEvent("blur",this.bound.validate);this.field.field.removeEvent("change",this.bound.validate)}this.field.removeEvent("reset",this.bound.reset);this.field=null;this.validators=null},validate:function(){$clear(this.timer);this.timer=this.validateField.delay(50,this)},validateField:function(){this.valid=true;this.errors=[];this.options.validators.each(function(A){var B=(Jx.type(A)==="string")?Form.Validator.getValidator(A):this.validators.get(A.validator.name);if(B){if(!B.test(this.field.field)){this.valid=false;this.errors.push(B.getError(this.field.field))}}},this);if(!this.valid){this.field.domObj.removeClass("jxFieldSuccess").addClass("jxFieldError");this.fireEvent("fieldValidationFailed",[this.field,this])}else{this.field.domObj.removeClass("jxFieldError").addClass("jxFieldSuccess");this.fireEvent("fieldValidationPassed",[this.field,this])}return this.valid},isValid:function(){return this.validateField()},reset:function(){this.valid=null;this.errors=[];this.field.field.removeClass("jxFieldError").removeClass("jxFieldSuccess")},getErrors:function(){return this.errors}});Jx.Plugin.Form={};Jx.Plugin.Form.Validator=new Class({Extends:Jx.Plugin,name:"Form.Validator",options:{fields:null,fieldDefaults:{validateOnBlur:true,validateOnChange:true},validateOnSubmit:true,suspendSubmit:false},errorMessage:null,bound:{},init:function(){this.parent();this.bound.validate=this.validate.bind(this);this.bound.failed=this.fieldFailed.bind(this);this.bound.passed=this.fieldPassed.bind(this)},attach:function(B){if(!$defined(B)&&!(B instanceof Jx.Form)){return }this.form=B;var A=this;this.form.isValid=function(){return A.isValid()};if(this.options.validateOnSubmit&&!this.options.suspendSubmit){document.id(this.form).addEvent("submit",this.bound.validate)}else{if(this.options.suspendSubmit){document.id(this.form).addEvent("submit",function(C){C.stop()})}}this.plugins=$H();$H(this.options.fields).each(function(G,C){var D=$merge(this.options.fieldDefaults,G);var F=this.form.getField(C);var E=new Jx.Plugin.Field.Validator(D);this.plugins.set(C,E);E.attach(F);E.addEvent("fieldValidationFailed",this.bound.failed);E.addEvent("fieldValidationPassed",this.bound.passed)},this)},detach:function(){if(this.form){document.id(this.form).removeEvent("submit")}this.form=null;this.plugins.each(function(A){A.detach();A=null},this);this.plugins=null},isValid:function(){return this.validate()},validate:function(){var A=true;this.errors=$H();this.plugins.each(function(B){if(!B.isValid()){A=false;this.errors.set(B.field.id,B.getErrors())}},this);if(A){this.fireEvent("formValidationPassed",[this.form,this])}else{this.fireEvent("formValidationFailed",[this.form,this])}return A},fieldFailed:function(B,A){this.fireEvent("fieldValidationFailed",[B,A])},fieldPassed:function(B,A){this.fireEvent("fieldValidationPassed",[B,A])},getErrors:function(){if(!$defined(this.errors)){this.validate()}return this.errors}});Jx.Plugin.ToolbarContainer={};Jx.Plugin.ToolbarContainer.TabMenu=new Class({Family:"Jx.Plugin.ToolbarContainer.TabMenu",Extends:Jx.Plugin,Binds:["addButton"],options:{},tabs:[],init:function(){this.parent()},attach:function(B){this.parent(B);this.container=B;if(!this.container.options.scroll){return }this.menu=new Jx.Menu({},{buttonTemplate:'<span class="jxButtonContainer"><a class="jxButton jxButtonMenu jxDiscloser"><span class="jxButtonContent"><span class="jxButtonLabel"></span></span></a></span>'}).addTo(this.container.controls,"bottom");document.id(this.menu).addClass("jxTabMenuRevealer");this.container.update();var A=document.id(this.container).getElement("ul").retrieve("jxToolbar");A.list.each(function(C){this.addButton(C)},this);A.list.addEvent("add",this.addButton)},detach:function(){this.parent()},addButton:function(D){var C;C=(D instanceof Jx.Tab)?D:document.id(D).getFirst().retrieve("jxTab");var A=C.getLabel();if(!$defined(A)){A=""}var B=new Jx.Menu.Item({label:A,image:C.options.image,onClick:function(){if(C.isActive()){this.container.scrollIntoView(C)}else{C.setActive(true)}}.bind(this)});document.id(C).store("menuItem",B);C.addEvent("close",function(){this.menu.remove(B)}.bind(this));this.menu.add([B])}});Jx.Adaptor=new Class({Family:"Jx.Adaptor",Extends:Jx.Plugin,name:"Jx.Adaptor",options:{template:"",useTemplate:true,store:null},columnsNeeded:null,init:function(){this.parent();this.store=this.options.store;if(this.options.useTemplate){this.columnsNeeded=this.store.parseTemplate(this.options.template)}},attach:function(A){this.parent(A);this.widget=A},detach:function(){this.parent()}});Jx.Adaptor.Tree=new Class({Family:"Jx.Adaptor.Tree",Extends:Jx.Adaptor,Binds:["fill","checkFolder"],options:{monitorFolders:false,startingNodeKey:-1,folderOptions:null,itemOptions:null},folders:new Hash(),currentRecord:-1,attach:function(A){this.parent(A);this.tree=A;if(this.options.monitorFolders){this.strategy=this.store.getStrategy("progressive");if(!$defined(this.strategy)){this.strategy=new Jx.Store.Strategy.Progressive({dropRecords:false,getPaginationParams:function(){return{}}});this.store.addStrategy(this.strategy)}else{this.strategy.options.dropRecords=false;this.strategy.options.getPaginationParams=function(){return{}}}}this.store.addEvent("storeDataLoaded",this.fill)},detach:function(){this.parent();this.store.removeEvent("storeDataLoaded",this.fill)},firstLoad:function(){this.busy="tree";this.tree.setBusy(true);this.store.load({node:this.options.startingNodeKey})},fill:function(){if(this.busy=="tree"){this.tree.setBusy(false);this.busy="none"}else{if(this.busy=="folder"){this.busyFolder.setBusy(false);this.busy="none"}}var A=this.store.count()-1;for(var B=this.currentRecord+1;B<=A;B++){var C=this.store.fillTemplate(B,this.options.template,this.columnsNeeded);var E;if(this.hasChildren(B)){var E=new Jx.TreeFolder($merge(this.options.folderOptions,{label:C}));if(this.options.monitorFolders){E.addEvent("disclosed",this.checkFolder)}this.folders.set(B,E)}else{var E=new Jx.TreeItem($merge(this.options.itemOptions,{label:C}))}document.id(E).store("index",B);document.id(E).store("jxAdaptor",this);if(this.hasParent(B)){var F=this.getParentIndex(B);var D=this.folders.get(F);D.add(E)}else{this.tree.add(E)}}this.currentRecord=A},checkFolder:function(D){var A=D.items();if(!$defined(A)||A.length===0){var B=document.id(D).retrieve("index");var C=this.store.get("primaryKey",B);this.busyFolder=D;this.busyFolder.setBusy(true);this.busy="folder";this.store.load({node:C})}},hasChildren:$empty,hasParent:$empty,getParentIndex:$empty});Jx.Adaptor.Tree.Mptt=new Class({Family:"Jx.Adaptor.Tree.Mptt",Extends:Jx.Adaptor.Tree,name:"tree.mptt",options:{left:"left",right:"right"},hasChildren:function(B){var A=this.store.get(this.options.left,B).toInt();var C=this.store.get(this.options.right,B).toInt();return(A+1!==C)},hasParent:function(A){var B=this.getParentIndex(A);if($defined(B)){return true}return false},getParentIndex:function(B){var A=this.store.get(this.options.left,B).toInt();var E=this.store.get(this.options.right,B).toInt();for(var C=B-1;C>=0;C--){var D=this.store.get(this.options.left,C).toInt();var F=this.store.get(this.options.right,C).toInt();if(D<A&&F>E){return C}}return null}});Jx.Adaptor.Tree.Parent=new Class({Family:"Jx.Adaptor.Tree.Parent",Extends:Jx.Adaptor.Tree,options:{parentColumn:"parent",folderColumn:"folder"},hasChildren:function(A){return this.store.get(this.options.folderColumn,A)},hasParent:function(A){if(this.store.get(this.options.parentColumn,A).toInt()!==-1){return true}return false},getParentIndex:function(A){var B=this.store.get(this.options.parentColumn,A);return this.store.findByColumn("primaryKey",B)}});Jx.Adaptor.Combo={};Jx.Adaptor.Combo.Fill=new Class({Family:"Jx.Adaptor.Combo.Fill",Extends:Jx.Adaptor,name:"combo.fill",Binds:["fill"],options:{imagePathColumn:null,imageClassColumn:null,selectedFn:null,noRepeats:false},labels:null,init:function(){this.parent();if(this.options.noRepeat){this.labels=[]}},attach:function(A){this.parent(A);this.store.addEvent("storeDataLoaded",this.fill);if(this.store.loaded){this.fill()}},detach:function(){},fill:function(){this.widget.empty();this.store.first();var A=[];this.store.each(function(B){var D=this.store.fillTemplate(B,this.options.template,this.columnsNeeded);if(!this.options.noRepeat||(this.options.noRepeat&&!this.labels.contains(D))){var C=false;if($type(this.options.selectedFn)=="function"){C=this.options.selectedFn.run(B)}var E={label:D,image:B.get(this.options.imagePathColumn),imageClass:B.get(this.options.imageClassColumn),selected:C};A.push(E);if(this.options.noRepeat){this.labels.push(D)}}},this);this.widget.add(A)}});Jx.Menu.Context=new Class({Family:"Jx.Menu.Context",Extends:Jx.Menu,parameters:["id"],render:function(){this.id=document.id(this.options.id);if(this.id){this.id.addEvent("contextmenu",this.show.bindWithEvent(this))}this.parent()},show:function(A){if(this.list.count()==0){return }this.target=A.target;this.contentContainer.setStyle("visibility","hidden");this.contentContainer.setStyle("display","block");document.id(document.body).adopt(this.contentContainer);this.contentContainer.setContentBoxSize(this.subDomObj.getMarginBoxSize());this.position(this.contentContainer,document.body,{horizontal:[A.page.x+" left"],vertical:[A.page.y+" top",A.page.y+" bottom"],offsets:this.chromeOffsets});this.contentContainer.setStyle("visibility","");this.showChrome(this.contentContainer);document.addEvent("mousedown",this.hide);document.addEvent("keyup",this.keypressHandler);A.stop()}});Jx.Menu.Separator=new Class({Family:"Jx.Menu.Separator",Extends:Jx.Widget,domObj:null,owner:null,options:{template:"<li class='jxMenuItemContainer jxMenuItem'><span class='jxMenuSeparator'>&nbsp;</span></li>"},classes:new Hash({domObj:"jxMenuItem"}),render:function(){this.parent();this.domObj.store("jxMenuItem",this)},setOwner:function(A){this.owner=A},hide:$empty,show:$empty});Jx.Menu.SubMenu=new Class({Family:"Jx.Menu.SubMenu",Extends:Jx.Menu.Item,subDomObj:null,owner:null,visibleItem:null,list:null,options:{template:'<li class="jxMenuItemContainer"><a class="jxMenuItem jxButtonSubMenu"><span class="jxMenuItemContent"><img class="jxMenuItemIcon" src="'+Jx.aPixel.src+'"><span class="jxMenuItemLabel"></span></span></a></li>',position:{horizontal:["right left","left right"],vertical:["top top"]}},render:function(){this.parent();this.open=false;this.menu=new Jx.Menu(null,{position:this.options.position});this.menu.domObj=this.domObj},setOwner:function(A){this.owner=A},show:function(){if(this.open||this.menu.list.count()==0){return }this.menu.show();this.open=true;this.setActive(true)},eventInMenu:function(A){if(this.visibleItem&&this.visibleItem.eventInMenu&&this.visibleItem.eventInMenu(A)){return true}return document.id(A.target).descendantOf(this.domObj)||this.menu.eventInMenu(A)},hide:function(){if(!this.open){return }this.open=false;this.menu.hide();this.visibleItem=null},add:function(B,A){this.menu.add(B,A,this);return this},remove:function(A){this.menu.remove(A);return this},replace:function(B,A){this.menu.replace(B,A);return this},empty:function(){this.menu.empty()},deactivate:function(A){if(this.owner){this.owner.deactivate(A)}},isActive:function(){if(this.owner){return this.owner.isActive()}else{return false}},setActive:function(A){if(this.owner&&this.owner.setActive){this.owner.setActive(A)}},setVisibleItem:function(A){if(this.visibleItem!=A){if(this.visibleItem&&this.visibleItem.hide){this.visibleItem.hide()}this.visibleItem=A;this.visibleItem.show()}}});Jx.Splitter.Snap=new Class({Family:"Jx.Splitter.Snap",Extends:Jx.Object,snap:null,element:null,splitter:null,layout:"vertical",parameters:["snap","element","splitter","events"],init:function(){this.snap=this.options.snap;this.element=this.options.element;this.splitter=this.options.splitter;this.events=this.options.events;var C=this.element.retrieve("jxLayout");C.addEvent("sizeChange",this.sizeChange.bind(this));this.layout=this.splitter.options.layout;var A=C.options;var B=this.element.getContentBoxSize();if(this.layout=="vertical"){this.originalSize=B.height;this.minimumSize=A.minHeight?A.minHeight:0}else{this.originalSize=B.width;this.minimumSize=A.minWidth?A.minWidth:0}this.events.each(function(D){this.snap.addEvent(D,this.toggleElement.bind(this))},this)},toggleElement:function(){var B=this.element.getContentBoxSize();var A={};if(this.layout=="vertical"){if(B.height==this.minimumSize){A.height=this.originalSize}else{this.originalSize=B.height;A.height=this.minimumSize}}else{if(B.width==this.minimumSize){A.width=this.originalSize}else{this.originalSize=B.width;A.width=this.minimumSize}}this.element.resize(A);this.splitter.sizeChanged()},sizeChange:function(){var A=this.element.getContentBoxSize();if(this.layout=="vertical"){if(A.height==this.minimumSize){this.snap.addClass("jxSnapClosed");this.snap.removeClass("jxSnapOpened")}else{this.snap.addClass("jxSnapOpened");this.snap.removeClass("jxSnapClosed")}}else{if(A.width==this.minimumSize){this.snap.addClass("jxSnapClosed");this.snap.removeClass("jxSnapOpened")}else{this.snap.addClass("jxSnapOpened");this.snap.removeClass("jxSnapClosed")}}}});Jx.Tab=new Class({Family:"Jx.Tab",Extends:Jx.Button,content:null,options:{toggleClass:"jxTabToggle",pressedClass:"jxTabPressed",activeClass:"jxTabActive",activeTabClass:"tabContentActive",template:'<span class="jxTabContainer"><a class="jxTab"><span class="jxTabContent"><img class="jxTabIcon" src="'+Jx.aPixel.src+'"><span class="jxTabLabel"></span></span></a><a class="jxTabClose"></span>',contentTemplate:'<div class="tabContent"></div>',close:false,shouldClose:true},classes:new Hash({domObj:"jxTabContainer",domA:"jxTab",domImg:"jxTabIcon",domLabel:"jxTabLabel",domClose:"jxTabClose",content:"tabContent"}),render:function(){this.options=$merge(this.options,{toggle:true});this.parent();this.domObj.store("jxTab",this);this.processElements(this.options.contentTemplate,this.classes);new Jx.Layout(this.content,this.options);if(!this.options.loadOnDemand){this.loadContent(this.content)}this.addEvent("down",function(){this.content.addClass(this.options.activeTabClass)}.bind(this));this.addEvent("up",function(){this.content.removeClass(this.options.activeTabClass)}.bind(this));if(this.domClose){if(this.options.close){this.domObj.addClass("jxTabClose");this.domClose.addEvent("click",(function(){var A=true;if($defined(this.options.shouldClose)){if(typeof this.options.shouldClose=="function"){A=this.options.shouldClose()}else{A=this.options.shouldClose}}if(A){this.fireEvent("close")}}).bind(this))}else{this.domClose.dispose()}}},clicked:function(A){if(this.options.enabled){if(this.contentIsLoaded&&this.options.cacheContent){this.setActive(true)}else{if(this.options.loadOnDemand||!this.options.cacheContent){this.loadContent(this.content);this.addEvent("contentLoaded",function(B){this.setActive(true)}.bind(this))}else{this.setActive(true)}}}}});Jx.Button.Tab=new Class({Extends:Jx.Tab,init:function(){if(console.warn){console.warn("WARNING: Jx.Button.Tab has been renamed to Jx.Tab")}else{console.log("WARNING: Jx.Button.Tab has been renamed to Jx.Tab")}this.parent()}});Jx.TabSet=new Class({Family:"Jx.TabSet",Extends:Jx.Object,tabs:null,domObj:null,parameters:["domObj","options"],init:function(){this.tabs=[];this.domObj=document.id(this.options.domObj);if(!this.domObj.hasClass("jxTabSetContainer")){this.domObj.addClass("jxTabSetContainer")}this.setActiveTabFn=this.setActiveTab.bind(this)},resizeTabBox:function(){if(this.activeTab&&this.activeTab.content.resize){this.activeTab.content.resize({forceResize:true})}},add:function(){$A(arguments).flatten().each(function(A){if(A instanceof Jx.Tab){A.addEvent("down",this.setActiveTabFn);A.tabSet=this;this.domObj.appendChild(A.content);this.tabs.push(A);if((!this.activeTab||A.options.active)&&A.options.enabled){A.options.active=false;A.setActive(true)}}},this);return this},remove:function(A){if(A instanceof Jx.Tab&&this.tabs.indexOf(A)!=-1){this.tabs.erase(A);if(this.activeTab==A){if(this.tabs.length){this.tabs[0].setActive(true)}}A.removeEvent("down",this.setActiveTabFn);A.content.dispose()}},setActiveTab:function(A){if(this.activeTab&&this.activeTab!=A){this.activeTab.setActive(false)}this.activeTab=A;if(this.activeTab.content.resize){this.activeTab.content.resize({forceResize:true})}this.fireEvent("tabChange",[this,A])}});Jx.TabBox=new Class({Family:"Jx.TabBox",Extends:Jx.Widget,options:{parent:null,position:"top",height:null,width:null,scroll:true},tabBar:null,tabSet:null,render:function(){this.parent();this.tabBar=new Jx.Toolbar({position:this.options.position,scroll:this.options.scroll});this.panel=new Jx.Panel({toolbars:[this.tabBar],hideTitle:true,height:this.options.height,width:this.options.width});this.panel.domObj.addClass("jxTabBox");this.tabSet=new Jx.TabSet(this.panel.content);this.tabSet.addEvent("tabChange",function(A,B){this.showItem(B)}.bind(this.tabBar));this.domObj=this.panel.domObj;this.panel.addEvent("sizeChange",(function(){this.tabSet.resizeTabBox();this.tabBar.domObj.getParent(".jxBarContainer").retrieve("jxBarContainer").update();this.tabBar.domObj.getParent(".jxBarContainer").addClass("jxTabBar"+this.options.position.capitalize())}).bind(this));this.tabBar.addEvents({add:(function(){this.domObj.resize({forceResize:true})}).bind(this),remove:(function(){this.domObj.resize({forceResize:true})}).bind(this)});this.addEvent("addTo",function(){this.domObj.resize({forceResize:true})});if(this.options.parent){this.addTo(this.options.parent)}},add:function(){this.tabBar.add.apply(this.tabBar,arguments);this.tabSet.add.apply(this.tabSet,arguments);$A(arguments).flatten().each(function(A){A.addEvents({close:(function(){this.tabBar.remove(A);this.tabSet.remove(A)}).bind(this)})},this);return this},remove:function(A){this.tabBar.remove(A);this.tabSet.remove(A)}});Jx.Toolbar.Separator=new Class({Family:"Jx.Toolbar.Separator",Extends:Jx.Widget,render:function(){this.domObj=new Element("li",{"class":"jxToolItem"});this.domSpan=new Element("span",{"class":"jxBarSeparator"});this.domObj.appendChild(this.domSpan)}});Jx.Tree=new Class({Family:"Jx.Tree",Extends:Jx.Widget,parameters:["options","container","selection"],pluginNamespace:"Tree",selection:null,ownsSelection:false,list:null,domObj:null,options:{select:true,template:'<ul class="jxTreeRoot"></ul>'},classes:new Hash({domObj:"jxTreeRoot"}),render:function(){this.parent();if($defined(this.options.container)&&document.id(this.options.container)){this.domObj=this.options.container}if(this.options.selection){this.selection=this.options.selection}else{if(this.options.select){this.selection=new Jx.Selection(this.options);this.ownsSelection=true}}this.bound={select:function(A){this.fireEvent("select",A.retrieve("jxTreeItem"))}.bind(this),unselect:function(A){this.fireEvent("unselect",A.retrieve("jxTreeItem"))}.bind(this)};if(this.selection&&this.ownsSelection){this.selection.addEvents({select:this.bound.select,unselect:this.bound.unselect})}this.list=new Jx.List(this.domObj,{hover:true,press:true,select:true,onAdd:function(A){this.update()}.bind(this),onRemove:function(A){this.update()}.bind(this)},this.selection);if(this.options.parent){this.addTo(this.options.parent)}},add:function(B,A){if($type(B)=="array"){B.each(function(C){this.add(C,A)}.bind(this));return }B.addEvents({add:function(C){this.fireEvent("add",C).bind(this)},remove:function(C){this.fireEvent("remove",C).bind(this)},disclose:function(C){this.fireEvent("disclose",C).bind(this)}});B.setSelection(this.selection);B.owner=this;this.list.add(B,A);return this},remove:function(A){A.removeEvents("add");A.removeEvents("remove");A.removeEvents("disclose");A.owner=null;this.list.remove(A);A.setSelection(null);return this},replace:function(B,A){B.owner=null;A.owner=this;this.list.replace(B,A);A.setSelection(this.selection);B.setSelection(null);return this},cleanup:function(){if(this.ownsSelection){this.selection.destroy()}this.list.destroy();this.domObj.dispose()},update:function(C,B){if($defined(B)){if(B){this.domObj.removeClass("jxTreeNest")}else{this.domObj.addClass("jxTreeNest")}}var A=this.list.count()-1;this.list.each(function(F,D){var E=D==A;if(F.retrieve("jxTreeFolder")){F.retrieve("jxTreeFolder").update(C,E)}if(F.retrieve("jxTreeItem")){F.retrieve("jxTreeItem").update(E)}})},items:function(){return this.list.items().map(function(A){return A.retrieve("jxTreeItem")})},empty:function(){this.list.items().each(function(A){if(A.retrieve("jxTreeFolder")){A.retrieve("jxTreeFolder").empty()}if(A.retrieve("jxTreeItem")){this.remove(A.retrieve("jxTreeItem"))}},this)},findChild:function(C){if(C.length==0){return false}var B=C.shift();var A=false;this.list.items().some(function(E){var F=E.retrieve("jxTreeItem");if(F&&F.getLabel()==B){if(C.length>0){var D=E.retrieve("jxTreeFolder");if(D){A=D.findChild(C)}}else{A=F}}return A});return A},setSelection:function(A){if(this.selection&&this.ownsSelection){this.selection.removeEvents(this.bound);this.selection.destroy();this.ownsSelection=false}this.selection=A;this.list.setSelection(A);this.list.each(function(B){B.retrieve("jxTreeItem").setSelection(A)});return this}});Jx.TreeItem=new Class({Family:"Jx.TreeItem",Extends:Jx.Widget,selection:null,domObj:null,owner:null,options:{label:"",contextMenu:null,enabled:true,selectable:true,image:null,imageClass:"",lastLeafClass:"jxTreeLeafLast",template:'<li class="jxTreeContainer jxTreeLeaf"><img class="jxTreeImage" src="'+Jx.aPixel.src+'" alt="" title=""><a class="jxTreeItem" href="javascript:void(0);"><img class="jxTreeIcon" src="'+Jx.aPixel.src+'" alt="" title=""><span class="jxTreeLabel"></span></a></li>',busyMask:{message:null}},classes:new Hash({domObj:"jxTreeContainer",domA:"jxTreeItem",domImg:"jxTreeImage",domIcon:"jxTreeIcon",domLabel:"jxTreeLabel"}),render:function(){this.parent();this.domObj=this.elements.get("jxTreeContainer");this.domObj.store("jxTreeItem",this);this.domA.store("jxTreeItem",this);if(this.options.contextMenu){this.domA.store("jxContextMenu",this.options.contextMenu)}this.domObj.store("jxListTarget",this.domA);if(!this.options.selectable){this.domObj.addClass("jxUnselectable")}if(this.domObj){if(this.options.id){this.domObj.id=this.options.id}this.domObj.store("jxTreeItem",this);if(!this.options.enabled){this.domObj.addClass("jxDisabled")}}if(this.options.image&&this.domIcon){this.domIcon.setStyle("backgroundImage","url("+this.options.image+")");if(this.options.imageClass){this.domIcon.addClass(this.options.imageClass)}}if(this.options.label&&this.domLabel){this.setLabel(this.options.label)}if(this.domA){this.domA.addEvents({click:this.click.bind(this),dblclick:this.dblclick.bind(this),drag:function(A){A.stop()}});if(typeof Drag!="undefined"){new Drag(this.domA,{onStart:function(){this.stop()}})}}if($defined(this.options.enabled)){this.enable(this.options.enabled,true)}},finalize:function(){this.finalizeItem()},finalizeItem:function(){if(!this.domObj){return }this.options=null;this.domObj.dispose();this.domObj=null;this.owner=null},update:function(A){if(A){this.domObj.addClass(this.options.lastLeafClass)}else{this.domObj.removeClass(this.options.lastLeafClass)}},click:function(){if(this.options.enabled){this.fireEvent("click",this)}},dblclick:function(){if(this.options.enabled){this.fireEvent("dblclick",this)}},select:function(){if(this.selection&&this.options.enabled){this.selection.select(this.domA)}},getLabel:function(){return this.options.label},setLabel:function(A){this.options.label=A;if(this.domLabel){this.domLabel.set("html",this.getText(A))}},setImage:function(A,B){if(this.domIcon&&$defined(A)){this.options.image=A;this.domIcon.setStyle("backgroundImage","url("+this.options.image+")")}if(this.domIcon&&$defined(B)){this.domIcon.removeClass(this.options.imageClass);this.options.imageClass=B;this.domIcon.addClass(B)}},enable:function(B,A){if(this.options.enabled!=B||A){this.options.enabled=B;if(this.options.enabled){this.domObj.removeClass("jxDisabled");this.fireEvent("enabled",this)}else{this.domObj.addClass("jxDisabled");this.fireEvent("disabled",this);if(this.selection){this.selection.unselect(document.id(this))}}}},propertyChanged:function(A){this.options.enabled=A.isEnabled();if(this.options.enabled){this.domObj.removeClass("jxDisabled")}else{this.domObj.addClass("jxDisabled")}},setSelection:function(A){this.selection=A},setBusy:function(A){if(this.busy==A){return }this.busy=A;this.fireEvent("busy",this.busy);if(this.busy){this.domImg.addClass(this.options.busyClass)}else{if(this.options.busyClass){this.domImg.removeClass(this.options.busyClass)}}},changeText:function(A){this.parent();this.setLabel(this.options.label)}});Jx.TreeFolder=new Class({Family:"Jx.TreeFolder",Extends:Jx.TreeItem,tree:null,options:{open:false,select:false,template:'<li class="jxTreeContainer jxTreeBranch"><img class="jxTreeImage" src="'+Jx.aPixel.src+'" alt="" title=""><a class="jxTreeItem" href="javascript:void(0);"><img class="jxTreeIcon" src="'+Jx.aPixel.src+'" alt="" title=""><span class="jxTreeLabel"></span></a><ul class="jxTree"></ul></li>'},classes:new Hash({domObj:"jxTreeContainer",domA:"jxTreeItem",domImg:"jxTreeImage",domIcon:"jxTreeIcon",domLabel:"jxTreeLabel",domTree:"jxTree"}),render:function(){this.parent();this.domObj.store("jxTreeFolder",this);this.bound={toggle:this.toggle.bind(this)};this.addEvents({click:this.bound.toggle,dblclick:this.bound.toggle});if(this.domImg){this.domImg.addEvent("click",this.bound.toggle)}this.tree=new Jx.Tree({template:this.options.template,onAdd:function(A){this.update();this.fireEvent("add",A)}.bind(this),onRemove:function(A){this.update();this.fireEvent("remove",A)}.bind(this)},this.domTree);if(this.options.open){this.expand()}else{this.collapse()}this.addEvent("postDestroy",function(){this.tree.destroy()}.bind(this))},add:function(B,A){this.tree.add(B,A);return this},remove:function(A){this.tree.remove(A);return this},replace:function(B,A){this.tree.replace(B,A);return this},items:function(){return this.tree.items()},empty:function(){this.tree.empty()},update:function(B,A){if(!this.domObj.parentNode){return }if(!$defined(A)){A=this.domObj.hasClass("jxTreeBranchLastOpen")||this.domObj.hasClass("jxTreeBranchLastClosed")}["jxTreeBranchOpen","jxTreeBranchLastOpen","jxTreeBranchClosed","jxTreeBranchLastClosed"].each(function(D){this.removeClass(D)}.bind(this.domObj));var C="jxTreeBranch";C+=A?"Last":"";C+=this.options.open?"Open":"Closed";this.domObj.addClass(C);this.tree.update(B,A)},toggle:function(){if(this.options.enabled){if(this.options.open){this.collapse()}else{this.expand()}}return this},expand:function(){this.options.open=true;document.id(this.tree).setStyle("display","block");this.update(true);this.fireEvent("disclosed",this);return this},collapse:function(){this.options.open=false;document.id(this.tree).setStyle("display","none");this.update(true);this.fireEvent("disclosed",this);return this},findChild:function(A){if(A.length==0){return this}else{return this.tree.findChild(A)}},setSelection:function(A){this.tree.setSelection(A);return this}});Jx.Slider=new Class({Family:"Jx.Slider",Extends:Jx.Widget,options:{template:'<div class="jxSliderContainer"><div class="jxSliderKnob"></div></div>',max:100,min:0,step:1,mode:"horizontal",wheel:true,snap:true,startAt:0,offset:0,onChange:$empty,onComplete:$empty},classes:new Hash({domObj:"jxSliderContainer",knob:"jxSliderKnob"}),slider:null,knob:null,sliderOpts:null,render:function(){this.parent();this.sliderOpts={range:[this.options.min,this.options.max],snap:this.options.snap,mode:this.options.mode,wheel:this.options.wheel,steps:(this.options.max-this.options.min)/this.options.step,offset:this.options.offset,onChange:this.change.bind(this),onComplete:this.complete.bind(this)}},change:function(A){this.fireEvent("change",[A,this])},complete:function(A){this.fireEvent("complete",[A,this])},start:function(){if(!$defined(this.slider)){this.slider=new Slider(this.domObj,this.knob,this.sliderOpts)}this.slider.set(this.options.startAt)},set:function(A){this.slider.set(A)}});Jx.Notice=new Class({Family:"Jx.Notice",Extends:Jx.ListItem,options:{fx:"fade",chrome:false,enabled:true,template:'<li class="jxNoticeItemContainer"><div class="jxNoticeItem"><span class="jxNotice"></span><a class="jxNoticeClose" href="javascript:void(0);" title="'+MooTools.lang.get("Jx","notice").closeTip+'"></a></div></li>',klass:""},classes:new Hash({domObj:"jxNoticeItemContainer",domItem:"jxNoticeItem",domContent:"jxNotice",domClose:"jxNoticeClose"}),render:function(){this.parent();if(this.options.klass){this.domObj.addClass(this.options.klass)}if(this.domClose){this.domClose.addEvent("click",this.close.bind(this))}},close:function(){this.fireEvent("close",this)},show:function(A,B){if(this.options.chrome){this.showChrome()}if(this.options.fx){document.id(A).adopt(this);if(B){B()}}else{document.id(A).adopt(this);if(B){B()}}},hide:function(A){if(this.options.chrome){this.hideChrome()}if(this.options.fx){document.id(this).dispose();if(A){A()}}else{document.id(this).dispose();if(A){A()}}}});Jx.Notice.Information=new Class({Extends:Jx.Notice,options:{template:'<li class="jxNoticeItemContainer"><div class="jxNoticeItem"><img class="jxNoticeIcon" src="'+Jx.aPixel.src+'" title="Success"><span class="jxNotice"></span><a class="jxNoticeClose" href="javascript:void(0);" title="'+MooTools.lang.get("Jx","notice").closeTip+'"></a></div></li>',klass:"jxNoticeInformation"}});Jx.Notice.Success=new Class({Extends:Jx.Notice,options:{template:'<li class="jxNoticeItemContainer"><div class="jxNoticeItem"><img class="jxNoticeIcon" src="'+Jx.aPixel.src+'" title="Success"><span class="jxNotice"></span><a class="jxNoticeClose" href="javascript:void(0);" title="'+MooTools.lang.get("Jx","notice").closeTip+'"></a></div></li>',klass:"jxNoticeSuccess"}});Jx.Notice.Warning=new Class({Extends:Jx.Notice,options:{template:'<li class="jxNoticeItemContainer"><div class="jxNoticeItem"><img class="jxNoticeIcon" src="'+Jx.aPixel.src+'" title="Warning"><span class="jxNotice"></span><a class="jxNoticeClose" href="javascript:void(0);" title="'+MooTools.lang.get("Jx","notice").closeTip+'"></a></div></li>',klass:"jxNoticeWarning"}});Jx.Notice.Error=new Class({Extends:Jx.Notice,options:{template:'<li class="jxNoticeItemContainer"><div class="jxNoticeItem"><img class="jxNoticeIcon" src="'+Jx.aPixel.src+'" title="Error"><span class="jxNotice"></span><a class="jxNoticeClose" href="javascript:void(0);" title="'+MooTools.lang.get("Jx","notice").closeTip+'"></a></div></li>',klass:"jxNoticeError"}});Jx.Notifier=new Class({Family:"Jx.Notifier",Extends:Jx.ListView,options:{parent:null,template:'<div class="jxNoticeListContainer"><ul class="jxNoticeList"></ul></div>',listOptions:{}},classes:new Hash({domObj:"jxNoticeListContainer",listObj:"jxNoticeList"}),render:function(){this.parent();if(!$defined(this.options.parent)){this.options.parent=document.body}document.id(this.options.parent).adopt(this.domObj);this.addEvent("postRender",function(){if(Jx.type(this.options.items)=="array"){this.options.items.each(function(A){this.add(A)},this)}}.bind(this))},add:function(A){if(!(A instanceof Jx.Notice)){A=new Jx.Notice({content:A})}A.addEvent("close",this.remove.bind(this));A.show(this.listObj)},remove:function(A){if(this.domObj.hasChild(A)){A.removeEvents("close");A.hide()}}});Jx.Notifier.Float=new Class({Family:"Jx.Notifier.Float",Extends:Jx.Notifier,options:{chrome:true,fx:null,width:250,position:{horizontal:"center center",vertical:"top top"}},render:function(){this.parent();this.domObj.setStyle("position","absolute");if($defined(this.options.width)){this.domObj.setStyle("width",this.options.width)}this.position(this.domObj,this.options.parent,this.options.position)},add:function(A){if(!(A instanceof Jx.Notice)){A=new Jx.Notice({content:A})}A.options.chrome=this.options.chrome;this.parent(A)}});Jx.Scrollbar=new Class({Family:"Jx.Scrollbar",Extends:Jx.Widget,Binds:["scrollIt"],options:{direction:"vertical",useMouseWheel:true,useScrollers:true,scrollerInterval:50,template:'<div class="jxScrollbarContainer"><div class="jxScrollLeft"></div><div class="jxSlider"></div><div class="jxScrollRight"></div></div>'},classes:new Hash({domObj:"jxScrollbarContainer",scrollLeft:"jxScrollLeft",scrollRight:"jxScrollRight",sliderHolder:"jxSlider"}),el:null,parameters:["element","options"],render:function(){this.parent();this.el=document.id(this.options.element);if(this.el){this.el.addClass("jxHas"+this.options.direction.capitalize()+"Scrollbar");var D=this.el.getChildren();this.wrapper=new Element("div",{"class":"jxScrollbarChildWrapper"});this.wrapper.setStyles({width:this.el.getStyle("width"),height:this.el.getStyle("height")});D.inject(this.wrapper);this.wrapper.inject(this.el);this.domObj.inject(this.el);var E=this.wrapper.getScrollSize();var C=this.wrapper.getContentBoxSize();this.steps=this.options.direction==="horizontal"?E.x-C.width:E.y-C.height;this.slider=new Jx.Slider({snap:false,min:0,max:this.steps,step:1,mode:this.options.direction,onChange:this.scrollIt});if(!this.options.useScrollers){this.scrollLeft.dispose();this.scrollRight.dispose();if(this.options.direction==="horizontal"){this.sliderHolder.setStyle("width","100%")}else{this.sliderHolder.setStyle("height","100%")}}else{this.scrollLeft.addEvents({mousedown:function(){this.slider.slider.set(this.slider.slider.step-this.options.scrollerInterval);this.pid=function(){this.slider.slider.set(this.slider.slider.step-this.options.scrollerInterval)}.periodical(1000,this)}.bind(this),mouseup:function(){$clear(this.pid)}.bind(this)});this.scrollRight.addEvents({mousedown:function(){this.slider.slider.set(this.slider.slider.step+this.options.scrollerInterval);this.pid=function(){this.slider.slider.set(this.slider.slider.step+this.options.scrollerInterval)}.periodical(1000,this)}.bind(this),mouseup:function(){$clear(this.pid)}.bind(this)});var A,F,B;if(this.options.direction==="horizontal"){F=this.scrollRight.getMarginBoxSize().width;B=this.scrollLeft.getMarginBoxSize().width;A=C.width-F-B;this.sliderHolder.setStyle("width",A+"px")}else{F=this.scrollRight.getMarginBoxSize().height;B=this.scrollLeft.getMarginBoxSize().height;A=C.height-F-B;this.sliderHolder.setStyle("height",A+"px")}}document.id(this.slider).inject(this.sliderHolder);if(this.options.useMouseWheel){$$(this.el,this.domObj).addEvent("mousewheel",function(H){H=new Event(H).stop();var G=this.slider.slider.step-H.wheel*30;this.slider.slider.set(G)}.bind(this))}document.id(document.body).addEvent("mouseleave",function(){this.slider.slider.drag.stop()}.bind(this));this.slider.start()}},scrollIt:function(B){var A=this.options.direction==="horizontal"?B:0;var C=this.options.direction==="horizontal"?0:B;this.wrapper.scrollTo(A,C)}});Jx.Formatter=new Class({Family:"Jx.Formatter",Extends:Jx.Object,format:$empty});Jx.Formatter.Number=new Class({Extends:Jx.Formatter,options:{precision:2,useParens:true,useThousands:true},format:function(K){if(Jx.type(K)==="string"){var A=K.split(",");K=A.join("");K=K.toFloat()}K=K.toFixed(this.options.precision);var H=K.split(".");var C=true;if(H.length===1){C=false}var D=false;var F;var J="";if(H[0].contains("-")){D=true;F=H[0].substring(1,H[0].length)}else{F=H[0]}if(this.options.useThousands){var E=F.length;var B=E%3;var G=0;for(var I=0;I<E;I++){J=J+F.charAt(I);if(I===B-1&&I!==E-1){J=J+MooTools.lang.get("Jx","formatter.number").thousandsSeparator}else{if(I>=B){G++;if(G===3&&I!==E-1){J=J+MooTools.lang.get("Jx","formatter.number").thousandsSeparator;G=0}}}}}else{J=H[0]}if(C){J=J+MooTools.lang.get("Jx","formatter.number").decimalSeparator+H[1]}if(D&&this.options.useParens){J="("+J+")"}else{if(D&&!this.options.useParens){J="-"+J}}return J},changeText:function(A){this.parent()}});Jx.Formatter.Currency=new Class({Extends:Jx.Formatter.Number,options:{},format:function(B){this.options.precision=2;B=this.parent(B);var C=false;if(B.contains("(")||B.contains("-")){C=true}var A;if(C&&!this.options.useParens){A="-"+MooTools.lang.get("Jx","formatter.currency").sign+B.substring(1,B.length)}else{A=MooTools.lang.get("Jx","formatter.currency").sign+B}return A},changeText:function(A){this.parent()}});Jx.Formatter.Date=new Class({Extends:Jx.Formatter,options:{format:"%B %d, %Y"},format:function(A){var B=Date.parse(A);return B.format(this.options.format)}});Jx.Formatter.Uri=new Class({Extends:Jx.Formatter,options:{format:'<a href="{string}" target="_blank">{host}</a>'},format:function(G){var E=new URI(G),C={},F=new Array(),B=this.options.format.match(/\\?\{([^{}]+)\}/g);B.each(function(H){F.push(H.slice(1,H.length-1))});for(var D=0,A=F.length;D<A;D++){switch(F[D]){case"string":C[F[D]]=E.toString();break;default:C[F[D]]=E.get(F[D]);break}}return this.options.format.substitute(C)}});Jx.Formatter.Boolean=new Class({Extends:Jx.Formatter,options:{},format:function(C){var A=false;var B=Jx.type(C);switch(B){case"string":if(C==="true"){A=true}break;case"number":if(C!==0){A=true}break;case"boolean":A=C;break;default:A=true}return A?MooTools.lang.get("Jx","formatter.boolean")["true"]:MooTools.lang.get("Jx","formatter.boolean")["false"]},changeText:function(A){this.parent()}});Jx.Formatter.Phone=new Class({Extends:Jx.Formatter,options:{useParens:true,separator:"-"},format:function(D){var C=this.options.separator;var A=""+D;A=A.replace(/[^0-9]/g,"");var B="";if(A.length===11){B=A.charAt(0);A=A.substring(1)}if(A.length===10){if(this.options.useParens){B=B+"("+A.substring(0,3)+")"}else{B=B+C+A.substring(0,3)+C}A=A.substring(3)}B=B+A.substring(0,3)+C+A.substring(3);return B}});Jx.Field.Checkbox=new Class({Extends:Jx.Field,options:{template:'<span class="jxInputContainer"><input class="jxInputCheck" type="checkbox" name="{name}"/><label class="jxInputLabel"></label><span class="jxInputTag"></span></span>',checked:false,labelSeparator:""},type:"Check",render:function(){this.parent();if($defined(this.options.checked)&&this.options.checked){if(Browser.Engine.trident){var B=this.field.getParent();var A;if(B){A=this.field.getPrevious()}this.field.setStyle("visibility","hidden");this.field.inject(document.id(document.body));this.field.checked=true;this.field.defaultChecked=true;this.field.dispose();this.field.setStyle("visibility","visible");if(A){this.field.inject(A,"after")}else{if(B){this.field.inject(B,"top")}}}else{this.field.set("checked","checked");this.field.set("defaultChecked","checked")}}if(this.label){this.label.addEvent("click",function(C){this.setValue(this.getValue()!=null?false:true)}.bind(this))}},setValue:function(A){if(!this.options.readonly){if(A==="checked"||A==="true"||A===true){this.field.set("checked","checked")}else{this.field.erase("checked")}}},getValue:function(){if(this.field.get("checked")){return this.field.get("value")}else{return null}},reset:function(){if(this.options.checked){this.field.set("checked","checked")}else{this.field.erase("checked")}},getChecked:function(){return this.field.get("checked")}});Jx.Field.Radio=new Class({Extends:Jx.Field,options:{template:'<span class="jxInputContainer"><input class="jxInputRadio" type="radio" name="{name}"/><label class="jxInputLabel"></label><span class="jxInputTag"></span></span>',checked:false,labelSeparator:""},type:"Radio",render:function(){this.parent();if($defined(this.options.checked)&&this.options.checked){if(Browser.Engine.trident){var B=this.field.getParent();var A;if(B){A=this.field.getPrevious()}this.field.setStyle("visibility","hidden");this.field.inject(document.id(document.body));this.field.checked=true;this.field.defaultChecked=true;this.field.dispose();this.field.setStyle("visibility","visible");if(A){this.field.inject(A,"after")}else{if(B){this.field.inject(B,"top")}}}else{this.field.set("checked","checked");this.field.set("defaultChecked","checked")}}},setValue:function(A){if(!this.options.readonly){if(A==="checked"||A==="true"||A===true){this.field.set("checked","checked")}else{this.field.erase("checked")}}},getValue:function(){if(this.field.get("checked")){return this.field.get("value")}else{return null}},reset:function(){if(this.options.checked){this.field.set("checked","checked")}else{this.field.erase("checked")}}});Jx.Field.Select=new Class({Extends:Jx.Field,options:{mulitple:false,size:1,comboOpts:null,optGroups:null,template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><select class="jxInputSelect" name="{name}"></select><span class="jxInputTag"></span></span>'},type:"Select",render:function(){this.parent();this.field.addEvent("change",function(){this.fireEvent("change",this)}.bind(this));if($defined(this.options.multiple)){this.field.set("multiple",this.options.multiple)}if($defined(this.options.size)){this.field.set("size",this.options.size)}if($defined(this.options.optGroups)){this.options.optGroups.each(function(B){var A=new Element("optGroup");A.set("label",B.name);B.options.each(function(D){var C=new Element("option",{value:D.value,html:D.text});if($defined(D.selected)&&D.selected){C.set("selected","selected")}A.grab(C)},this);this.field.grab(A)},this)}else{if($defined(this.options.comboOpts)){this.options.comboOpts.each(function(A){this.addOption(A)},this)}}},addOption:function(D,A){var C=new Element("option",{value:D.value,html:D.text});if($defined(D.selected)&&D.selected){C.set("selected","selected")}var B="bottom";var E=this.field;if($defined(A)){if(Jx.type(A)=="integer"&&(A>=0&&A<E.options.length)){E=this.field.options[A];B="before"}else{if(A=="top"){B="top"}}}C.inject(E,B)},removeOption:function(A){},setValue:function(A){if(!this.options.readonly){$$(this.field.options).each(function(B){if(B.get("value")===A){document.id(B).set("selected",true)}},this)}},getValue:function(){var B=this.field.selectedIndex;if(B>-1){var A=this.field.options[B].get("value");if(!$defined(A)){A=this.field.options[B].get("text")}return A}},empty:function(){if($defined(this.field.options)){$A(this.field.options).each(function(A){this.field.remove(A)},this)}}});Jx.Field.Textarea=new Class({Extends:Jx.Field,options:{rows:null,columns:null,template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><textarea class="jxInputTextarea" name="{name}"></textarea><span class="jxInputTag"></span></span>'},type:"Textarea",errorClass:"jxFormErrorTextarea",render:function(){this.parent();if($defined(this.options.rows)){this.field.set("rows",this.options.rows)}if($defined(this.options.columns)){this.field.set("cols",this.options.columns)}}});Jx.Field.Button=new Class({Extends:Jx.Field,options:{buttonClass:Jx.Button,buttonOptions:{},template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><div class="jxInputButton"></div><span class="jxInputTag"></span></span>'},button:null,type:"Button",processTemplate:function(D,B,A){var C=this.parent(D,B,A);this.button=new this.options.buttonClass(this.options.buttonOptions);var E=C.get("jxInputButton");if(E){this.button.domObj.replaces(E)}return C},click:function(){this.button.clicked()}});Jx.Field.Combo=new Class({Family:"Jx.Field.Combo",Extends:Jx.Field,pluginNamespace:"Combo",options:{buttonTemplate:'<a class="jxButtonContainer jxButton" href="javascript:void(0);"><img class="jxButtonIcon" src="'+Jx.aPixel.src+'"></a>',template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><span class="jxInputWrapper"><input type="text" class="jxInputCombo"  name="{name}"><img class="jxInputIcon" src="'+Jx.aPixel.src+'"><span class="jxInputRevealer"></span></span><span class="jxInputTag"></span></span>'},type:"Combo",render:function(){this.classes.combine({wrapper:"jxInputWrapper",revealer:"jxInputRevealer",icon:"jxInputIcon"});this.parent();var A=new Jx.Button({template:this.options.buttonTemplate,imageClass:"jxInputRevealerIcon"}).addTo(this.revealer);this.menu=new Jx.Menu();this.menu.button=A;this.buttonSet=new Jx.ButtonSet();this.buttonSet=new Jx.ButtonSet({onChange:(function(E){var D=E.activeButton;var B=D.options.label;if(B=="&nbsp;"){B=""}this.setLabel(B);var C=D.options.image;if(C.indexOf("a_pixel")!=-1){C=""}this.setImage(C,D.options.imageClass);this.fireEvent("change",this)}).bind(this)});if(this.options.items){this.add(this.options.items)}A.addEvent("click",function(B){if(this.list.count()===0){return }if(!A.options.enabled){return }this.contentContainer.setStyle("visibility","hidden");this.contentContainer.setStyle("display","block");document.id(document.body).adopt(this.contentContainer);this.contentContainer.setContentBoxSize(this.subDomObj.getMarginBoxSize());this.showChrome(this.contentContainer);this.position(this.contentContainer,this.button.domObj,{horizontal:["right right"],vertical:["bottom top","top bottom"],offsets:this.chromeOffsets});this.contentContainer.setStyle("visibility","");document.addEvent("mousedown",this.hide);document.addEvent("keyup",this.keypressHandler);this.fireEvent("show",this)}.bindWithEvent(this.menu));this.menu.addEvents({show:(function(){}).bind(this),hide:(function(){}).bind(this)});this.addEvent("change",function(){window.console?console.log("on change detected"):false})},setLabel:function(A){if($defined(this.field)){this.field.value=this.getText(A)}},setImage:function(A,B){if($defined(this.icon)){this.icon.setStyle("background-image","url("+A+")");this.icon.setStyle("background-repeat","no-repeat");if(this.options.imageClass){this.icon.removeClass(this.options.imageClass)}if(B){this.options.imageClass=B;this.icon.addClass(B);this.icon.setStyle("background-position","")}else{this.options.imageClass=null;this.icon.setStyle("background-position","center center")}}if(!A){this.wrapper.addClass("jxInputIconHidden")}else{this.wrapper.removeClass("jxInputIconHidden")}},valueChanged:function(){this.fireEvent("change",this)},setValue:function(A){this.field.set("value",A);this.buttonSet.buttons.each(function(B){B.setActive(B.options.label===A)},this)},onKeyPress:function(A){if(A.key=="enter"){this.valueChanged()}},add:function(){$A(arguments).flatten().each(function(B){var A=new Jx.Menu.Item($merge(B,{toggle:true}));this.menu.add(A);this.buttonSet.add(A);if(B.selected){this.buttonSet.setActiveButton(A)}},this)},remove:function(A){var B;if($type(A)=="number"&&A<this.buttonSet.buttons.length){B=this.buttonSet.buttons[A]}else{if($type(A)=="string"){this.buttonSet.buttons.some(function(C){if(C.options.label===A){B=C;return true}return false},this)}}if(B){this.buttonSet.remove(B);this.menu.remove(B)}},empty:function(){this.menu.empty();this.buttonSet.empty();this.setLabel("");this.setImage(Jx.aPixel.src)}});Jx.Field.Password=new Class({Extends:Jx.Field,options:{template:'<span class="jxInputContainer"><label class="jxInputLabel" ></label><input class="jxInputPassword" type="password" name="{name}"/><span class="jxInputTag"></span></span>'},type:"Password"});Jx.Field.Color=new Class({Extends:Jx.Field,Binds:["changed","hide","keyup","changeText"],type:"Color",options:{buttonTemplate:'<a class="jxButtonContainer jxButton" href="javascript:void(0);"><img class="jxButtonIcon" src="'+Jx.aPixel.src+'"></a>',template:'<span class="jxInputContainer"><label class="jxInputLabel"></label><span class="jxInputWrapper"><input type="text" class="jxInputColor"  name="{name}"><img class="jxInputIcon" src="'+Jx.aPixel.src+'"><span class="jxInputRevealer"></span></span><span class="jxInputTag"></span></span>',showOnHover:false,showDelay:250,errorMsg:"Invalid Web-Color",color:"#000000"},button:null,validator:null,render:function(){this.classes.combine({wrapper:"jxInputWrapper",revealer:"jxInputRevealer",icon:"jxInputIcon"});this.parent();var A=this;if(!Jx.Field.Color.ColorPalette){Jx.Field.Color.ColorPalette=new Jx.ColorPalette(this.options)}this.button=new Jx.Button.Flyout({template:this.options.buttonTemplate,imageClass:"jxInputRevealerIcon",onBeforeOpen:function(){if(Jx.Field.Color.ColorPalette.currentButton){Jx.Field.Color.ColorPalette.currentButton.hide()}Jx.Field.Color.ColorPalette.currentButton=this;Jx.Field.Color.ColorPalette.addEvent("change",A.changed);Jx.Field.Color.ColorPalette.addEvent("click",A.hide);this.content.appendChild(Jx.Field.Color.ColorPalette.domObj);Jx.Field.Color.ColorPalette.domObj.setStyle("display","block")},onOpen:function(){Jx.Field.Color.ColorPalette.options.color=A.options.color;Jx.Field.Color.ColorPalette.updateSelected()}}).addTo(this.revealer);this.validator=new Jx.Plugin.Field.Validator({validators:[{validatorClass:"colorHex",validator:{name:"colorValidator",options:{validateOnChange:false,errorMsg:A.options.errorMsg,test:function(E,C){try{var F=E.get("value").hexToRgb(true);if(F==null){return false}for(var B=0;B<3;B++){if(F[B].toString()=="NaN"){return false}}}catch(D){return false}F=F.rgbToHex().toUpperCase();A.setColor(F);return true}}}}],validateOnBlur:true,validateOnChange:true});this.validator.attach(this);this.field.addEvent("keyup",this.onKeyUp.bind(this));if(this.options.showOnHover){this.field.addEvent("mouseenter",function(B){A.button.clicked.delay(A.options.showDelay,A.button)})}this.setValue(this.options.color);this.icon.setStyle("background-color",this.options.color)},onKeyUp:function(B){var A=this.getValue();if(A.substring(0,1)=="#"){A=A.substring(1)}if(A.toLowerCase().match(/^[0-9a-f]{6}$/)){this.options.color="#"+A.toUpperCase();this.setColor(this.options.color)}},setColor:function(A){this.options.color=A;this.setValue(A);this.icon.setStyle("background-color",A)},changed:function(){var A=Jx.Field.Color.ColorPalette.options.color;this.setColor(A)},hide:function(){this.button.setActive(false);Jx.Field.Color.ColorPalette.removeEvent("change",this.changed);Jx.Field.Color.ColorPalette.removeEvent("click",this.hide);this.button.hide();Jx.Field.Color.ColorPalette.currentButton=null},changeText:function(A){this.parent()}});